<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>OWY Play</title>
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    }

    body {
      background: #05060a;
      color: #f5f5f5;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      -webkit-text-size-adjust: 100%;
      transition: background 0.25s ease;
    }

    body.theme-neon {
      background: radial-gradient(circle at top, #061318, #040308 60%, #020105);
    }

    .app {
      max-width: 420px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      border-left: 1px solid #14151a;
      border-right: 1px solid #14151a;
      position: relative;
      overflow-x: hidden;
    }

    body.theme-neon .app {
      border-color: rgba(29,219,111,0.35);
      box-shadow: 0 0 20px rgba(29,219,111,0.2);
    }

    /* SPLASH */

    .splash {
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #050608, #020205);
      color: #fff;
      font-size: 15px;
      letter-spacing: 0.02em;
      opacity: 1;
      pointer-events: auto;
      transition: none;
      animation: owySplashHide 0.6s ease-out 0.8s forwards;
    }

    @keyframes owySplashHide {
      to {
        opacity: 0;
      }
    }

    .splash-hide {
      opacity: 0;
      pointer-events: none;
      display: none;
    }

    /* сама карточка */
    .splash-inner {
      position: relative;
      width: calc(100% - 40px);
      max-width: 360px;
      padding: 22px 20px 18px;
      border-radius: 22px;
      background: radial-gradient(circle at top left, #151b24, #06070c 70%);
      border: 1px solid rgba(29, 219, 111, 0.28);
      box-shadow:
        0 0 25px rgba(29, 219, 111, 0.25),
        0 18px 34px rgba(0, 0, 0, 0.8);
      overflow: hidden;
    }

    /* мягкое свечение под картой */
    .splash-glow {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top, rgba(29, 219, 111, 0.32), transparent 60%);
      opacity: 0.7;
      filter: blur(18px);
      pointer-events: none;
    }

    /* логотип */
    .splash-logo-row {
      position: relative;
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .splash-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #1ddb6f;
      box-shadow: 0 0 18px rgba(29, 219, 111, 0.95);
    }

    .splash-logo-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .splash-title {
      font-size: 22px;
      font-weight: 700;
    }

    .splash-tagline {
      font-size: 12px;
      color: #9ea2b0;
    }

    /* подписи / статус */
    .splash-sub {
      position: relative;
      font-size: 12px;
      color: #c2c6d3;
      margin-top: 4px;
    }

    /* прогресс-бар */
    .splash-bar {
      position: relative;
      margin-top: 14px;
      width: 100%;
      height: 4px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.06);
      overflow: hidden;
    }

    .splash-bar-fill {
      width: 40%;
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, #1ddb6f, #16a451);
      animation: splash-bar-move 1.2s ease-in-out infinite;
    }

    @keyframes splash-bar-move {
      0%   { transform: translateX(-110%); }
      50%  { transform: translateX(0%); }
      100% { transform: translateX(120%); }
    }

    /* === TOP HEADER (логотип + баланс + профиль) === */

    .header {
      width: 100%;
      background: transparent;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .header-row {
      width: 100%;
      max-width: 400px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 14px;
    }

    /* === ЛОГОТИП === */
    .header-logo img {
      height: 22px;
      width: auto;
      display: block;
      filter: brightness(1.2);
    }

    /* === БАЛАНС === */
    .header-balance {
      text-align: center;
      flex-grow: 1;
      color: #e9e9e9;
      line-height: 1.2;
    }

    .header-balance-amount {
      font-size: 14px;
      font-weight: 600;
      color: #1ddb6f; /* фирменный зелёный OWY */
    }

    .header-balance-sub {
      font-size: 10px;
      opacity: 0.7;
      margin-top: 2px;
    }

    /* === ПРОФИЛЬ (АВАТАР) === */
    .header-profile {
      background: radial-gradient(circle at top, #1ddb6f, #0d6e3f);
      color: #05060a;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      box-shadow: 0 0 8px rgba(29, 219, 111, 0.45);
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .header-profile:hover {
      transform: scale(1.05);
      box-shadow: 0 0 10px rgba(29, 219, 111, 0.6);
    }

    /* === CASINO / MINI GAMES (зелёная тема) === */

    .casino-banner {
      margin: 6px 0 12px;
      padding: 12px 14px;
      border-radius: 20px;
      background: radial-gradient(
        circle at top left,
        rgba(29, 219, 111, 0.26),
        rgba(5, 6, 10, 0.98)
      );
      border: 1px solid rgba(29, 219, 111, 0.55);
      box-shadow: 0 18px 36px rgba(0, 0, 0, 0.9);
    }

    html, body {
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }

    .app {
      max-width: 420px;
      margin: 0 auto;
      overflow-x: hidden;
    }

    /* чтобы скроллилась только полоса игр, а не вся страница */
    .casino-games-scroll {
      display: flex;
      gap: 12px;
      padding: 12px 16px 24px;
      margin: 0 -16px 0;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .casino-game-card {
      flex: 0 0 160px;
    }

    .casino-banner-title {
      font-size: 15px;
      font-weight: 600;
    }

    .casino-banner-sub {
      font-size: 12px;
      color: #cfd2de;
      margin-top: 4px;
    }

    /* табы над списком игр (сейчас только Mini games) */

    .casino-tabs {
      margin: 4px 0 8px;
      display: flex;
      gap: 6px;
    }

    .casino-tab-pill {
      border-radius: 999px;
      padding: 6px 12px 7px;
      font-size: 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(7, 9, 14, 0.96);
      color: #cfd2de;
    }

    .casino-tab-pill-active {
      background: linear-gradient(135deg, #1ddb6f, #16a451);
      border-color: rgba(29, 219, 111, 0.9);
      color: #05060a;
      box-shadow: 0 6px 14px rgba(29, 219, 111, 0.6);
    }

    /* заголовок секции игр */
    .casino-section-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    /* горизонтальный скролл мини-игр */

    .casino-games-scroll {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      padding-bottom: 6px;
      margin: 4px -18px 0;
      padding-inline: 18px;
      -webkit-overflow-scrolling: touch;
    }

    /* отдельная карточка игры */
    .casino-game-card {
      flex: 0 0 150px;
      border-radius: 18px;
      padding: 10px 10px 12px;
      background: radial-gradient(circle at top, #161a23, #05060a);
      border: 1px solid rgba(255, 255, 255, 0.04);
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.85);
      display: flex;
      flex-direction: column;
      gap: 6px;
      text-align: left;
      cursor: pointer;
    }

    .casino-game-card:active {
      transform: translateY(1px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.9);
      border-color: rgba(29, 219, 111, 0.5);
    }

    /* заглушка вместо картинки */
    .casino-game-thumb {
      width: 100%;
      aspect-ratio: 4 / 3;
      border-radius: 14px;
      background: radial-gradient(circle at top, #171b24, #05060a);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 4px;
    }

    .casino-game-thumb-placeholder {
      width: 44px;
      height: 44px;
      border-radius: 16px;
      border: 1px dashed rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: #5f6370;
    }

    /* подписи */
    .casino-game-name {
      font-size: 13px;
      font-weight: 600;
      color: #1ddb6f;
    }

    .casino-game-sub {
      font-size: 11px;
      color: #9ea2b0;
    }

    /* MAIN */

    .content {
      flex: 1;
      padding: 14px 18px 80px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .cards {
      display: flex;
      flex-direction: column;
      gap: 18px;
      margin-bottom: 16px;
    }

    .card {
      border-radius: 18px;
      padding: 26px 20px;
      background: radial-gradient(circle at top left, #182728, #090b0f);
      border: 1px solid rgba(255, 255, 255, 0.02);
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.5);
      min-height: 120px;
      transition: transform 0.08s ease, box-shadow 0.08s ease, border-color 0.15s ease;
    }

    body.theme-neon .card {
      background: radial-gradient(circle at top left, #10231e, #050309);
      border-color: rgba(29,219,111,0.18);
    }

    .card:active {
      transform: scale(0.98);
      box-shadow: 0 8px 20px rgba(29,219,111,0.35);
      border-color: rgba(29,219,111,0.4);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: #cfd2de;
    }

    .card-title {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .card-sub {
      font-size: 13px;
      color: #9ea2b0;
    }

    .card-footer {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 10px;
    }

    .btn {
      border: none;
      outline: none;
      padding: 10px 16px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: transform 0.06s ease, box-shadow 0.06s ease, background 0.1s ease;
      touch-action: manipulation;
    }

    .btn-primary {
      background: linear-gradient(135deg, #1ddb6f, #16a451);
      color: #05060a;
      box-shadow: 0 6px 16px rgba(29, 219, 111, 0.4);
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 3px 10px rgba(29, 219, 111, 0.3);
    }

    .btn-ghost {
      background: transparent;
      color: #cfd2de;
    }

    .hint-text {
      font-size: 11px;
      color: #9ea2b0;
      margin: 6px 0 12px;
    }

    .bottom-hint {
      text-align: center;
      font-size: 11px;
      color: #8c909a;
      margin-top: 10px;
      margin-bottom: 20px;
    }

    .big-cards {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .big-card {
      display: flex;
      flex-direction: column;
      justify-content: center;
      text-align: center;
      padding: 26px 20px;
    }

    /* PET / FLUFFIE */

    .pet-xp-row {
      margin: 6px 0 4px;
    }

    .pet-xp-label {
      font-size: 11px;
      color: #9ea2b0;
      margin-bottom: 4px;
    }

    .pet-xp-fill {
      background: linear-gradient(90deg,#8a66ff,#1ddb6f);
    }

    .pet-bonus-badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: radial-gradient(circle at left, rgba(29,219,111,0.22), rgba(6,10,18,0.95));
      border: 1px solid rgba(29,219,111,0.5);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 5px;
      color: #e7fdf0;
      box-shadow: 0 0 10px rgba(29,219,111,0.35);
    }

    .pet-coins-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
      font-size: 12px;
      color: #cfd2de;
    }

    .pet-coins-value {
      font-weight: 600;
    }

    .pet-card {
      border-radius: 22px;
      padding: 18px 14px 16px;
      background: radial-gradient(circle at top, #121722, #05070b);
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 18px 40px rgba(0,0,0,0.9);
      margin-top: 6px;
      min-height: calc(100vh - 170px); /* почти весь экран в колонке приложения */
      display: flex;
      flex-direction: column;
    }

    #pet-screen .section-title {
      margin-bottom: 6px;
    }

    .pet-text {
      font-size: 13px;
      color: #cfd2de;
      margin-bottom: 12px;
    }

    .pet-field {
      margin-bottom: 10px;
    }

    .pet-field label {
      font-size: 12px;
      color: #9ea2b0;
      display: block;
      margin-bottom: 4px;
    }

    .pet-field input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #20232b;
      background: #080a0f;
      color: #f5f5f5;
      font-size: 14px;
      outline: none;
    }

    .pet-error {
      font-size: 11px;
      color: #ff7676;
      margin-top: 4px;
      min-height: 13px;
    }

    .pet-field input:focus {
      border-color: #1ddb6f;
    }

    .pet-gender-row {
      display: flex;
      gap: 8px;
    }

    .pet-gender-btn {
      flex: 1;
      font-size: 13px;
    }

    .pet-gender-active {
      background: rgba(29,219,111,0.14);
      border: 1px solid rgba(29,219,111,0.7);
      color: #e7fdf0;
    }

    .pet-color-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .pet-color-pill {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #20232b;
      background: rgba(6,8,12,0.95);
      padding: 6px 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #cfd2de;
      cursor: pointer;
      outline: none;
    }

    .pet-color-pill:active {
      transform: scale(0.98);
    }

    .pet-color-active {
      border-color: #1ddb6f;
      background: radial-gradient(circle at left, rgba(29,219,111,0.2), #05070c);
      color: #e7fdf0;
    }

    .pet-color-dot {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      box-shadow: 0 0 10px rgba(0,0,0,0.7);
      flex-shrink: 0;
    }

    .pet-color-purple {
      background: #8a66ff;
      box-shadow: 0 0 12px rgba(138,102,255,0.9);
    }

    .pet-color-green {
      background: #1ddb6f;
      box-shadow: 0 0 12px rgba(29,219,111,0.9);
    }

    .pet-color-black {
      background: #11131b;
      box-shadow: 0 0 12px rgba(0,0,0,0.9);
    }

    .pet-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .pet-name {
      font-size: 20px;
      font-weight: 600;
    }

    .pet-sub {
      font-size: 12px;
      color: #b1b6c4;
    }

    .pet-chip {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(11,24,19,0.9);
      border: 1px solid rgba(29,219,111,0.35);
      box-shadow: 0 0 10px rgba(29,219,111,0.35);
    }

    .pet-image-wrap {
      margin: 4px 0 6px;
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .pet-image-wrap img {
      width: 230px;
      height: 230px;
      transition: transform 0.25s ease;
      object-fit: contain;
      filter: drop-shadow(0 18px 40px rgba(0,0,0,0.95));
    }

    @keyframes pet-bounce {
      0%   { transform: translateY(0) scale(1); }
      30%  { transform: translateY(-8px) scale(1.04); }
      60%  { transform: translateY(2px) scale(0.98); }
      100% { transform: translateY(0) scale(1); }
    }

    .pet-bounce {
      animation: pet-bounce 0.45s ease-out;
    }

    .pet-bars {
      margin-bottom: 10px;
    }

    .pet-bar-row {
      font-size: 11px;
      color: #cfd2de;
      margin-bottom: 6px;
    }

    .pet-bar {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      overflow: hidden;
      margin-top: 3px;
    }

    .pet-bar-fill {
      width: 100%;
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg,#1ddb6f,#16a451);
      transition: width 0.2s ease;
    }

    .pet-actions {
      display: flex;
      gap: 6px;
      margin: 8px 0 6px;
    }

    .pet-action-btn {
      flex: 1;
      font-size: 13px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.06);
      background: rgba(9,11,18,0.95);
    }

    .pet-action-btn:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.7);
    }

    .pet-note {
      font-size: 11px;
      color: #a1a6b5;
      text-align: center;
    }

    .pet-reset-btn {
      margin-top: 8px;
      font-size: 11px;
      opacity: 0.6;
    }

    .pet-shop-btn {
      margin-top: 6px;
      font-size: 12px;
    }

    /* Магазин Fluffie */

    .pet-shop-card {
      padding-bottom: 14px;
    }

    .pet-shop-balance {
      font-size: 12px;
      color: #cfd2de;
      margin-top: 10px;
    }

    .pet-shop-balance span {
      font-weight: 600;
    }

    .pet-shop-items {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 12px;
    }

    .pet-shop-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 10px;
      border-radius: 12px;
      background: rgba(6, 8, 14, 0.9);
      border: 1px solid rgba(255,255,255,0.06);
    }

    .pet-shop-item-main {
      max-width: 65%;
    }

    .pet-shop-item-name {
      font-size: 14px;
      font-weight: 500;
    }

    .pet-shop-item-desc {
      font-size: 11px;
      color: #9ea2b0;
      margin-top: 2px;
    }

    .pet-shop-item-side {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }

    .pet-shop-price {
      font-size: 12px;
      color: #e7fdf0;
    }

    .pet-shop-note {
      font-size: 11px;
      color: #9ea2b0;
      margin-top: 10px;
    }

    /* === PET MATCH-3 GAME === */

    .pet-game-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      color: #cfd2de;
      margin-bottom: 10px;
    }

    .pet-game-score,
    .pet-game-timer {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(6, 8, 12, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .pet-game-grid {
      margin-top: 10px;
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 6px;
      justify-items: center;
    }

    .pet-game-tile {
      width: 44px;
      height: 44px;
      border-radius: 14px;
      box-shadow: 0 6px 14px rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.08s ease, border-color 0.1s ease;
    }

    .pet-game-tile:active {
      transform: scale(0.95);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.8);
    }

    .pet-game-tile-selected {
      border-color: #1ddb6f;
      box-shadow: 0 0 12px rgba(29, 219, 111, 0.7);
    }

    /* цвета "камней" */
    .pet-game-gem-0 {
      background: linear-gradient(135deg, #8a66ff, #c29dff);
    }
    .pet-game-gem-1 {
      background: linear-gradient(135deg, #1ddb6f, #40f7a0);
    }
    .pet-game-gem-2 {
      background: linear-gradient(135deg, #ffb943, #ff8a3b);
    }
    .pet-game-gem-3 {
      background: linear-gradient(135deg, #ff5a7a, #ff9ab0);
    }
    .pet-game-gem-4 {
      background: linear-gradient(135deg, #46a2ff, #8ec8ff);
    }

    #pet-game-note {
      margin-top: 12px;
    }

    /* PROFILE */

    .profile-card {
      border-radius: 16px;
      padding: 16px 14px 16px;
      background: radial-gradient(circle at top left, #151923, #090b0f);
      border: 1px solid rgba(255, 255, 255, 0.02);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.5);
      margin-top: 10px;
    }

    body.theme-neon .profile-card {
      background: radial-gradient(circle at top left, #101725, #05030a);
      border-color: rgba(29,219,111,0.25);
    }

    .profile-line {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-bottom: 6px;
      color: #cfd2de;
    }

    .profile-line span:first-child {
      color: #8c8f9a;
    }

    .profile-balance {
      font-size: 15px;
      font-weight: 600;
    }

    .rank-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 6px 0 8px;
      font-size: 12px;
    }

    .xp-bar {
      margin-top: 4px;
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(255,255,255,0.05);
      overflow: hidden;
    }

    .xp-bar-fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #1ddb6f, #16a451);
      transition: width 0.2s ease;
    }

    .profile-section-title {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      font-weight: 600;
      margin: 14px 0 8px;
    }

    .profile-section-title .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #1ddb6f;
    }

    .profile-field {
      margin-bottom: 10px;
    }

    .profile-field label {
      font-size: 12px;
      color: #9ea2b0;
      display: block;
      margin-bottom: 4px;
    }

    .profile-field input,
    .profile-field select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #20232b;
      background: #080a0f;
      color: #f5f5f5;
      font-size: 14px;
      outline: none;
    }

    .profile-field input:focus,
    .profile-field select:focus {
      border-color: #1ddb6f;
    }

    .profile-buttons {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 6px;
    }

    .profile-note {
      font-size: 11px;
      color: #7f8491;
      margin-top: 6px;
    }

    .stats-row {
      font-size: 11px;
      color: #9ea2b0;
      margin-top: 4px;
    }

    .missions-list {
      font-size: 11px;
      color: #9ea2b0;
      list-style: none;
      padding-left: 0;
    }

    .missions-list li {
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .mission-done {
      color: #1ddb6f;
    }

    /* ——— MINI LIQUID GLASS NAV (стиль как в Major) ——— */

    .bottom-nav {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 18px;                    /* отступ снизу */
      width: 100%;
      max-width: 420px;
      display: flex;
      justify-content: center;
      pointer-events: none;            /* чтобы клики шли только по кнопкам */
      z-index: 40;
    }

    .bottom-nav-inner {
      pointer-events: auto;
      display: flex;
      justify-content: space-around;
      align-items: center;

      /* компактная капсула */
      width: 88%;
      max-width: 300px;
      padding: 6px 10px;

      background: rgba(10, 12, 19, 0.6);
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow:
        0 8px 24px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(255, 255, 255, 0.04) inset;
      backdrop-filter: blur(18px) saturate(140%);
      -webkit-backdrop-filter: blur(18px) saturate(140%);
    }

    /* Иконки и подписи */

    .nav-item {
      flex: 1;
      text-align: center;
      color: #9094a5;
      font-size: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
      cursor: pointer;
      border-radius: 12px;
      transition: color 0.2s ease;
    }

    .nav-item span:first-child {
      font-size: 18px;
      transition: all 0.2s ease;
    }

    /* активный таб — светится только иконка */

    .nav-item.active span:first-child {
      color: #1ddb6f; /* фирменный зелёный OWY */
      text-shadow: 0 0 10px rgba(29, 219, 111, 0.9);
      transform: translateY(-1px);
    }

    .nav-item.active {
      color: #e5fff2;
    }

    /* чуть приглушаем фон (Major-style blur) */
    html, body {
      background-color: #05060a;
      overflow-x: hidden;
    }

    /* OVERLAYS */

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(5, 6, 10, 0.96);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 50;
    }

    .overlay-inner {
      width: 100%;
      max-width: 420px;
      padding: 18px 18px 90px;
    }

    .overlay-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .overlay-title {
      font-size: 18px;
      font-weight: 600;
    }

    /* RUSH */

    .rush-multiplier {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .rush-scene {
      position: relative;
      width: 100%;
      height: 120px;
      margin: 10px 0 6px;
      border-radius: 16px;
      background: radial-gradient(circle at bottom, #16352c, #05070a);
      overflow: hidden;
      border: 1px solid rgba(29, 219, 111, 0.25);
    }

    .rush-slope {
      position: absolute;
      left: -20%;
      bottom: -30px;
      width: 160%;
      height: 80px;
      background: linear-gradient(135deg, #124233, #050708);
      border-radius: 40px;
      box-shadow: 0 -6px 24px rgba(0, 0, 0, 0.7);
      transform: rotate(-18deg);
    }

    #rush-owy {
      position: absolute;
      width: 60px;
      height: 60px;
      left: 4%;
      bottom: 6px;

      background-image: url("owy.png");
      background-size: contain;
      background-repeat: no-repeat;
      background-position: bottom center;

      transform-origin: center bottom;
      transform: translate(0px, 0px) rotate(0deg);
      transition: transform 0.07s linear;
    }

    @keyframes rush-run {
      0%   { bottom: 6px; }
      50%  { bottom: 10px; }
      100% { bottom: 6px; }
    }

    #rush-owy.rush-running {
      animation: rush-run 0.22s linear infinite;
    }

    /* линия и ракета сейчас не используются, просто скрываем */
    .rush-track-line {
      display: none !important;
    }

    .rush-status {
      font-size: 12px;
      color: #9ea2b0;
      margin: 12px 0;
      min-height: 32px;
    }

    .rush-timer {
      font-size: 11px;
      color: #7f8491;
      margin-top: -4px;
    }

    .rush-history {
      font-size: 11px;
      color: #7f8491;
      margin-bottom: 10px;
      min-height: 14px;
    }

    .rush-input {
      margin-bottom: 10px;
    }

    .rush-input label {
      font-size: 12px;
      color: #9ea2b0;
      display: block;
      margin-bottom: 4px;
    }

    .rush-input input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #20232b;
      background: #080a0f;
      color: #f5f5f5;
      font-size: 14px;
      outline: none;
    }

    .rush-input input:focus {
      border-color: #1ddb6f;
    }

    .rush-buttons {
      display: flex;
      gap: 8px;
      margin-top: 4px;
      flex-wrap: wrap;
    }

    #rush-cashout[disabled] {
      opacity: 0.4;
      cursor: default;
    }

    .auto-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-size: 12px;
      color: #9ea2b0;
      margin-bottom: 6px;
      user-select: none;
    }

    .auto-checkbox input {
      display: none;
    }

    .checkmark {
      width: 16px;
      height: 16px;
      display: inline-block;
      flex-shrink: 0;
      border-radius: 4px;
      border: 1px solid #3a3d44;
      background: #080a0f;
      position: relative;
      transition: all 0.15s ease;
    }

    .auto-checkbox input:checked + .checkmark {
      border-color: #1ddb6f;
      background: #1ddb6f;
      box-shadow: 0 0 10px rgba(29, 219, 111, 0.6);
    }

    .auto-checkbox input:checked + .checkmark::after {
      content: "✓";
      position: absolute;
      left: 3px;
      top: -1px;
      font-size: 13px;
      color: #05060a;
      font-weight: bold;
    }

    .auto-label-text {
      font-size: 12px;
      color: #cfd2de;
    }

    /* маленькие цветные табы истории */

    .rush-history-chip {
      display: inline-block;
      padding: 1px 5px;
      margin-right: 4px;
      margin-top: 2px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 500;
      background: rgba(255, 255, 255, 0.03);
    }

    .rush-history-chip.low {
      color: #ff7676;
      background: rgba(255, 118, 118, 0.12);
    }

    .rush-history-chip.mid {
      color: #ffd27f;
      background: rgba(255, 210, 127, 0.14);
    }

    .rush-history-chip.high {
      color: #c4ffd9;
      background: rgba(29, 219, 111, 0.2);
    }

    /* вспышка при краше */

    .rush-scene::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(circle at center, rgba(255,255,255,0.65), transparent 60%);
      opacity: 0;
    }

    @keyframes crash-flash {
      0%   { opacity: 0; }
      25%  { opacity: 1; }
      100% { opacity: 0; }
    }

    .rush-scene.flash::after {
      animation: crash-flash 0.35s ease-out;
    }

    /* PLINKO */

    .plinko-board {
      position: relative;
      border-radius: 20px;
      padding: 18px 16px 28px;
      background: radial-gradient(circle at top, #141922, #06070b 70%);
      border: 1px solid rgba(255, 255, 255, 0.04);
      box-shadow: 0 14px 28px rgba(0, 0, 0, 0.75);
      margin-bottom: 10px;
      height: 320px;
      overflow: hidden;
    }

    .plinko-board.low {
      background: radial-gradient(circle at top, #151d23, #05060a 70%);
    }

    .plinko-board.mid {
      background: radial-gradient(circle at top, #101f19, #05060a 70%);
    }

    .plinko-board.high {
      background: radial-gradient(circle at top, #231318, #05060a 70%);
    }

    .plinko-pegs-layer {
      position: absolute;
      inset: 10px 16px 56px 16px;
      pointer-events: none;
      z-index: 1;
    }

    .plinko-peg {
      position: absolute;
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #dde2ec;
      box-shadow: 0 0 4px rgba(0, 0, 0, 0.9);
      opacity: 0.95;
    }

    .plinko-balls-layer {
      position: absolute;
      inset: 0 0 60px 0;
      pointer-events: none;
      z-index: 2;
    }

    .plinko-ball {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #1ddb6f;
      box-shadow: 0 0 8px rgba(29, 219, 111, 0.9);
      top: 0;
      left: 50%;
      margin-left: -5px;
      transition: top 0.2s linear, left 0.2s linear;
    }

    .plinko-slots {
      display: flex;
      justify-content: space-between;
      gap: 4px;
      position: absolute;
      left: 16px;
      right: 16px;
      bottom: 18px;
      z-index: 3;
    }

    .plinko-slot {
      flex: 1;
      min-width: 28px;
      padding: 4px 0 3px;
      border-radius: 9px;
      text-align: center;
      font-size: 11px;
      font-weight: 600;
      color: #fff7eb;
      background: linear-gradient(180deg, #2b2622, #171310);
      border: 1px solid #332822;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.7);
      transform: translateY(0);
      transition: transform 0.06s ease,
                  box-shadow 0.06s ease,
                  border-color 0.1s ease,
                  background 0.1s ease;
    }

    /* градации "горячести" слота по иксу */
    .plinko-slot-hot {
      background: linear-gradient(180deg, #ff6a34, #d9362b);
      border-color: #ff8a3c;
    }

    .plinko-slot-warm {
      background: linear-gradient(180deg, #ffb943, #ff8531);
      border-color: #ffc659;
    }

    .plinko-slot-cool {
      background: linear-gradient(180deg, #252932, #1a1e26);
      border-color: #353a47;
      color: #d2d7e4;
    }

    .plinko-slot.active {
      transform: translateY(-2px);
      box-shadow:
        0 0 16px rgba(29, 219, 111, 0.5),
        0 10px 20px rgba(0, 0, 0, 0.9);
      border-color: #1ddb6f;
    }

    .plinko-risk-active {
      background: rgba(29, 219, 111, 0.15);
      border-color: #1ddb6f;
      color: #e7fdf0;
    }

    .plinko-history {
      font-size: 11px;
      color: #7f8491;
      margin-top: 4px;
      min-height: 14px;
    }

    /* HILO BANNER */

    .hilo-banner {
      border-radius: 18px;
      padding: 16px 16px 14px;
      background: radial-gradient(circle at top, #181f2c, #05060a 70%);
      border: 1px solid rgba(70, 162, 255, 0.45);
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 14px;
      cursor: pointer;
      overflow: hidden;
    }

    .hilo-odd {
      font-size: 11px;
      opacity: 0.8;
      display: block;
      margin-top: 2px;
    }

    .hilo-banner:active {
      transform: scale(0.98);
      box-shadow: 0 8px 20px rgba(70,162,255,0.5);
      border-color: rgba(70,162,255,0.8);
    }

    .hilo-banner-left {
      flex: 1;
      min-width: 0;
    }

    .hilo-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: #dbe7ff;
      background: rgba(70,162,255,0.1);
      border: 1px solid rgba(70,162,255,0.4);
      margin-bottom: 6px;
    }

    .hilo-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .hilo-subtitle {
      font-size: 12px;
      color: #9ea2b0;
      max-width: 210px;
    }

    .hilo-banner-right {
      position: relative;
      width: 80px;
      height: 70px;
      flex-shrink: 0;
    }

    .hilo-card-mini {
      position: absolute;
      width: 60px;
      height: 80px;
      border-radius: 12px;
      background: #f5f5f5;
      color: #1b1d22;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 700;
      box-shadow: 0 10px 24px rgba(0,0,0,0.9);
    }

    .hilo-card-mini.prev {
      left: 0;
      top: 8px;
      transform: rotate(-8deg);
      background: #fdf4f4;
      color: #d64545;
    }

    .hilo-card-mini.next {
      right: 0;
      top: -2px;
      transform: rotate(10deg);
      background: linear-gradient(135deg,#142334,#3354a8);
      color: #f5f5f5;
    }

    .hilo-card-mini.next span {
      opacity: 0.85;
    }

    /* RUSH BANNER */

    .rush-banner {
      border-radius: 18px;
      overflow: hidden;
      cursor: pointer;
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.5);
      margin-bottom: 18px;
    }

    .rush-banner img {
      display: block;
      width: 100%;
      height: auto;
    }

    .match3-board {
      margin-top: 12px;
      margin-bottom: 12px;
      width: 100%;
      max-width: 320px;
      aspect-ratio: 1 / 1;
      border-radius: 18px;
      background: radial-gradient(circle at top, #171b24, #05060a);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 14px 30px rgba(0,0,0,0.8);
      margin-inline: auto;
      position: relative;
      overflow: hidden;
      touch-action: none; /* чтобы свайпы не скроллили страницу */
    }

    .match3-cell {
      position: absolute;
      width: calc(100% / 7);
      height: calc(100% / 7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 700;
      color: #f5f5f5;
      transition: transform 0.16s ease, opacity 0.16s ease;
    }

    .match3-gem {
      width: 70%;
      height: 70%;
      border-radius: 14px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.7);
    }

    /* Цвета камней */
    .match3-gem-0 { background: linear-gradient(135deg,#8a66ff,#c69dff); }
    .match3-gem-1 { background: linear-gradient(135deg,#1ddb6f,#46f0a0); }
    .match3-gem-2 { background: linear-gradient(135deg,#ff9a3b,#ffc86a); }
    .match3-gem-3 { background: linear-gradient(135deg,#46a2ff,#8bc7ff); }
    .match3-gem-4 { background: linear-gradient(135deg,#ff5a7a,#ff9bb0); }

    .match3-cell--pop {
      animation: match3-pop 0.18s ease-out forwards;
    }

    @keyframes match3-pop {
      0%   { transform: scale(1);   opacity: 1; }
      100% { transform: scale(1.3); opacity: 0; }
    }

    /* во время свайпа слегка поднимаем */
    .match3-cell--active {
      transform: translateY(-4px);
    }

    /* === TAP-TAP GAME === */

    .taptap-board {
      margin-top: 12px;
      margin-bottom: 12px;
      width: 100%;
      max-width: 320px;
      aspect-ratio: 1 / 1;
      border-radius: 18px;
      background: radial-gradient(circle at top, #171b24, #05060a);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 14px 30px rgba(0,0,0,0.8);
      margin-inline: auto;
      position: relative;
      overflow: hidden;
    }

    .taptap-target {
      position: absolute;
      width: 54px;
      height: 54px;
      border-radius: 999px;
      background: radial-gradient(circle at top, #1ddb6f, #0f7b45);
      box-shadow: 0 0 14px rgba(29,219,111,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: #05060a;
      cursor: pointer;
      transform: scale(0.4);
      opacity: 0;
      transition: transform 0.12s ease-out, opacity 0.12s ease-out;
    }

    .taptap-target--alive {
      transform: scale(1);
      opacity: 1;
    }

    .taptap-target--hit {
      transform: scale(0.2);
      opacity: 0;
    }

    /* === DOUBLE WHEEL === */

    .double-wheel-wrap {
      margin: 10px 0 16px;
      padding: 14px 10px 18px;
      border-radius: 18px;
      background: radial-gradient(circle at top, #151a22, #05070a);
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 10px 24px rgba(0,0,0,0.7);
      position: relative;
      overflow: hidden;
    }

    .double-wheel-window {
      position: relative;
      height: 70px;
      overflow: hidden;
    }

    .double-wheel-strip {
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      gap: 6px;
      /* без transition, двигаем только из JS */
    }

    .double-cell {
      min-width: 60px;
      padding: 6px 6px 8px;
      border-radius: 14px;
      font-size: 13px;
      font-weight: 600;
      text-align: center;
      color: #f5f5f5;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
      border: 1px solid rgba(0,0,0,0.4);
      white-space: nowrap;
    }

    .double-cell.blue {
      background: linear-gradient(135deg, #254dff, #46a2ff);
      border-color: rgba(70,162,255,0.85);
    }

    .double-cell.green {
      background: linear-gradient(135deg, #19c86e, #25e3a9);
      border-color: rgba(31,215,117,0.9);
    }

    .double-cell.orange {
      background: linear-gradient(135deg, #ff9a3b, #ff5a3b);
      border-color: rgba(255,154,59,0.95);
    }

    .double-pointer {
      position: absolute;
      top: 2px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 7px solid transparent;
      border-right: 7px solid transparent;
      border-bottom: 10px solid #f5f5f5;
      filter: drop-shadow(0 0 6px rgba(0,0,0,0.9));
      z-index: 3;
    }

    .double-round-label {
      font-size: 13px;
      margin-bottom: 4px;
    }

    .double-sub {
      font-size: 12px;
      color: #9ea2b0;
      margin-bottom: 6px;
    }

    .double-timer {
      font-size: 11px;
      color: #7f8491;
      margin-bottom: 4px;
    }

    .double-colors-row {
      display: flex;
      gap: 6px;
      margin: 8px 0 6px;
      flex-wrap: nowrap;
    }

    .double-color-btn {
      flex: 1;
      min-width: 0;
      border-radius: 14px;
      padding: 6px 10px;
      border: none;
      outline: none;
      font-size: 13px;
      font-weight: 500;
      color: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      cursor: pointer;
      background: #111520;
      border: 1px solid #222738;
      transition: transform 0.05s ease, box-shadow 0.05s ease,
                  border-color 0.1s ease, background 0.1s ease;
    }

    .double-color-btn.blue {
      background: linear-gradient(135deg,#254dff,#46a2ff);
      border-color: rgba(70,162,255,0.9);
    }

    .double-color-btn.green {
      background: linear-gradient(135deg,#19c86e,#25e3a9);
      border-color: rgba(31,215,117,0.9);
    }

    .double-color-btn.orange {
      background: linear-gradient(135deg,#ff9a3b,#ff5a3b);
      border-color: rgba(255,154,59,0.95);
    }

    .double-color-btn.active {
      box-shadow: 0 0 14px rgba(0,0,0,0.9);
      transform: translateY(1px);
    }

    .double-bet-pill {
      margin-top: 2px;
      padding: 0 6px;
      border-radius: 999px;
      font-size: 10px;
      background: rgba(5,6,10,0.35);
      border: 1px solid rgba(255,255,255,0.16);
    }

    .double-history {
      font-size: 11px;
      color: #7f8491;
      margin-top: 6px;
      min-height: 16px;
    }

    .double-history-chip {
      display: inline-block;
      padding: 1px 5px;
      margin-right: 4px;
      margin-top: 2px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 500;
      background: rgba(255,255,255,0.03);
    }

    .double-history-chip.blue {
      color: #8ec2ff;
      background: rgba(142,194,255,0.14);
    }

    .double-history-chip.green {
      color: #c2ffe1;
      background: rgba(31,215,117,0.16);
    }

    .double-history-chip.orange {
      color: #ffddb3;
      background: rgba(255,164,81,0.18);
    }

    /* === CASINO MAIN SCREEN === */

    .casino-promo {
      margin: 6px 0 10px;
      padding: 12px 14px;
      border-radius: 18px;
      background: radial-gradient(circle at top left, #26203a, #0b0614);
      border: 1px solid rgba(142, 194, 255, 0.5);
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.8);
    }

    .casino-promo-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .casino-promo-sub {
      font-size: 11px;
      color: #cfd2de;
    }

    .casino-tabs-row {
      display: flex;
      gap: 8px;
      margin: 10px 0 4px;
    }

    .casino-tab {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.06);
      background: rgba(8,10,16,0.95);
      font-size: 12px;
      color: #cfd2de;
    }

    .casino-tab-active {
      background: #2563eb;
      border-color: rgba(37,99,235,0.9);
      color: #f5f5f5;
      box-shadow: 0 0 14px rgba(37,99,235,0.7);
    }

    .casino-row-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }

    /* горизонтальный скролл игр */
    .casino-games-scroll {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      padding: 4px 0 10px;
      margin: 4px 0 10px;
      -webkit-overflow-scrolling: touch;
    }

    .casino-games-scroll::-webkit-scrollbar {
      display: none;
    }

    .casino-game-card {
      min-width: 140px;
      max-width: 160px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.06);
      background: radial-gradient(circle at top, #151722, #05060a);
      box-shadow: 0 10px 24px rgba(0,0,0,0.8);
      padding: 8px 8px 10px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      cursor: pointer;
    }

    .casino-game-card:active {
      transform: scale(0.97);
    }

    .casino-game-thumb {
      width: 100%;
      aspect-ratio: 4 / 3;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 6px;
      background: #11131b;
    }

    .casino-game-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .casino-game-name {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .casino-game-sub {
      font-size: 10px;
      color: #9ea2b0;
    }

    /* HILO */

    .hilo-sub {
      font-size: 12px;
      color: #9ea2b0;
      margin-bottom: 6px;
    }

    .hilo-round-label {
      font-size: 13px;
      font-weight: 500;
      margin: 6px 0 4px;
      color: #cfd2de;
    }

    .hilo-card-wrap {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 14px;
      margin: 10px 0 6px;
    }

    .hilo-card {
      width: 90px;
      height: 130px;
      border-radius: 14px;
      background: #f5f5f5;
      color: #1b1d22;
      box-shadow: 0 10px 22px rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      font-weight: 700;
    }

    .hilo-card-back {
      background: linear-gradient(135deg,#142334,#3354a8);
      color: #f5f5f5;
    }

    .hilo-buttons {
      display: flex;
      gap: 8px;
      margin: 8px 0 4px;
    }

    .hilo-buttons .btn {
      flex: 1;
      font-size: 13px;
      text-align: center;
      padding-inline: 10px;
    }

    .hilo-status {
      font-size: 12px;
      color: #9ea2b0;
      margin-top: 6px;
      min-height: 36px;
    }

    /* === FINAL HEADER (логотип + баланс + профиль) === */

    .header {
      position: sticky;
      top: 0;
      z-index: 5;
      display: flex;
      justify-content: center;
      background: rgba(5, 6, 10, 0.98);
      padding: 8px 0 4px;
    }

    .header-row {
      width: 100%;
      max-width: 420px;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 0 14px;
    }

    /* логотип слева */
    .header-logo-btn {
      flex: 0 0 auto;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(29, 219, 111, 0.55);
      background: rgba(6, 8, 12, 0.96);
      font-size: 11px;
      color: #e7fdf0;
    }

    /* пилюля баланса по центру */
    .header-balance-pill {
      flex: 1 1 auto;
      min-width: 0;
      padding: 5px 10px 6px;
      border-radius: 999px;
      text-align: center;
      background: radial-gradient(circle at top,
        rgba(29, 219, 111, 0.22),
        rgba(3, 4, 8, 0.98)
      );
      border: 1px solid rgba(29, 219, 111, 0.6);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.8);
    }

    .header-balance-label {
      font-size: 10px;
      color: #9ea2b0;
    }

    .header-balance-amount {
      font-size: 14px;
      font-weight: 600;
    }

    .header-balance-sub {
      font-size: 9px;
      color: #6b7080;
      margin-top: 1px;
    }

    /* аватар профиля справа */
    .header-profile-btn {
      flex: 0 0 auto;
      width: 30px;
      height: 30px;
      border-radius: 999px;
      border: none;
      background: radial-gradient(circle at top, #1ddb6f, #0f7b45);
      box-shadow: 0 0 10px rgba(29, 219, 111, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 600;
      color: #05060a;
    }

  </style>
</head>
<body>
  <div class="app">
    <div class="splash" id="splash">
      <div class="splash-inner">
        <div class="splash-glow"></div>

        <div class="splash-logo-row">
          <div class="splash-dot"></div>
          <div class="splash-logo-text">
            <div class="splash-title">OWY Play</div>
            <div class="splash-tagline">Always Await</div>
          </div>
        </div>

        <div class="splash-sub">Загружаем демо-игры, Fluffie и баннеры…</div>

        <div class="splash-bar">
          <div class="splash-bar-fill"></div>
        </div>
      </div>
    </div>

    <header class="header">
      <div class="header-row">
        <!-- слева — логотип, ведёт на главный экран Casino -->
        <button class="header-logo-btn" id="header-logo-btn" type="button">
          OWY Play
        </button>

        <!-- по центру — маленькая пилюля баланса -->
        <div class="header-balance-pill">
          <div class="header-balance-label">Баланс</div>
          <div class="header-balance-amount balance-value" id="header-balance-amount">
            0 OWY
          </div>
          <div class="header-balance-sub">
            Demo режим • без реальных денег
          </div>
        </div>

        <!-- справа — аватар профиля -->
        <button class="header-profile-btn" id="header-profile-btn" type="button">
          EA
        </button>
      </div>
    </header>

    <main class="content">

      <!-- HOME -->
      <section id="home-screen">
        <!-- верхний баннер Casino -->
        <div class="casino-banner">
          <div class="casino-banner-title">OWY Play • mini games</div>
          <div class="casino-banner-sub">
            Играй в демо, качай Fluffie и собирай опыт.
          </div>
        </div>

        <!-- табы над списком игр (пока один) -->
        <div class="casino-tabs">
          <button class="casino-tab-pill casino-tab-pill-active" type="button">
            Mini games
          </button>
          <!-- позже добавим Providers / Live и т.п. -->
        </div>

        <div class="casino-section-title">Mini games</div>

        <!-- горизонтальный список игр — ВАЖНО: ОДИН casino-games-scroll и один </div> -->
        <div class="casino-games-scroll">
          <!-- Rush -->
          <button class="casino-game-card" type="button"
                  onclick="document.getElementById('rush-open')?.click()">
            <div class="casino-game-thumb">
              <div class="casino-game-placeholder">?</div>
            </div>
            <div class="casino-game-name">Rush</div>
            <div class="casino-game-sub">Лови множитель вовремя</div>
          </button>

          <!-- Double -->
          <button class="casino-game-card" type="button"
                  onclick="document.getElementById('double-open')?.click()">
            <div class="casino-game-thumb">
              <div class="casino-game-placeholder">?</div>
            </div>
            <div class="casino-game-name">Double</div>
            <div class="casino-game-sub">Выбери цвет x2 или x14</div>
          </button>

          <!-- Plinko -->
          <button class="casino-game-card" type="button"
                  onclick="document.getElementById('plinko-open')?.click()">
            <div class="casino-game-thumb">
              <div class="casino-game-placeholder">?</div>
            </div>
            <div class="casino-game-name">Plinko</div>
            <div class="casino-game-sub">Шарики и пины</div>
          </button>

          <!-- HiLo -->
          <button class="casino-game-card" type="button"
                  onclick="document.getElementById('hilo-open')?.click()">
            <div class="casino-game-thumb">
              <div class="casino-game-placeholder">?</div>
            </div>
            <div class="casino-game-name">HiLo</div>
            <div class="casino-game-sub">Выше или ниже?</div>
          </button>
        </div>
      </section>

      <!-- дальше сразу идут остальные секции, НИЧЕГО внутрь casino-games-scroll не суём -->
      <section id="bets-screen" style="display:none;">
        <div class="section-title">Bets</div>
        <p class="hint-text">Раздел ставок скоро подключим 😉</p>
      </section>

      <section id="tasks-screen" style="display:none;">
        <div class="section-title">Tasks</div>
        <p class="hint-text">Задания с наградами Fluffie и OWY появятся позже.</p>
      </section>

      <!-- BETS (дубликат id, но оставляю как в отрывке) -->
      <section id="bets-screen" style="display:none;">
        <div class="section-title">Bets</div>
        <p class="hint-text">Раздел ставок скоро подключим 😉</p>
      </section>

      <!-- TASKS (дубликат id, но оставляю как в отрывке) -->
      <section id="tasks-screen" style="display:none;">
        <div class="section-title">Tasks</div>
        <p class="hint-text">Задания с наградами Fluffie и OWY появятся позже.</p>
      </section>

      <!-- PROFILE -->
      <section id="profile-screen" style="display:none;">
        <div class="section-title">Личный профиль</div>
        <div class="profile-card">
          <div class="profile-line">
            <span>OWY ID</span>
            <span id="profile-id">—</span>
          </div>
          <div class="profile-line">
            <span>Баланс</span>
            <span class="profile-balance" id="profile-balance">1 000 OWY</span>
          </div>

          <div class="rank-row">
            <span>Ранг: <span id="rank-label">BRONZE I</span></span>
            <span id="xp-label">0 / 100 XP</span>
          </div>
          <div class="xp-bar">
            <div class="xp-bar-fill" id="xp-bar-fill"></div>
          </div>

          <div class="stats-row" id="stats-row">
            Rush: 0 игр • Plinko: 0 игр • Лучший множитель: x1.00
          </div>

          <div class="profile-section-title">
            <span class="dot"></span>
            <span>Миссии дня (демо)</span>
          </div>
          <ul class="missions-list">
            <li id="mission-1"><span>⬜</span><span>Сыграй Rush 5 раз</span></li>
            <li id="mission-2"><span>⬜</span><span>Сыграй Plinko 3 раза</span></li>
            <li id="mission-3"><span>⬜</span><span>Сыграй обе игры сегодня</span></li>
          </ul>

          <div class="profile-section-title">
            <span class="dot"></span>
            <span>Персональные данные</span>
          </div>

          <div class="profile-field">
            <label for="profile-name">Отображаемое имя</label>
            <input id="profile-name" type="text" placeholder="Как тебя называть в OWY">
          </div>

          <div class="profile-field">
            <label for="profile-username">OWY username</label>
            <input id="profile-username" type="text" placeholder="@nickname">
          </div>

          <div class="profile-field">
            <label for="profile-birthdate">Дата рождения</label>
            <input id="profile-birthdate" type="date">
          </div>

          <div class="profile-field">
            <label for="profile-gender">Пол</label>
            <select id="profile-gender">
              <option value="">Не указывать</option>
              <option value="male">Мужской</option>
              <option value="female">Женский</option>
              <option value="other">Другое</option>
            </select>
          </div>

          <div class="profile-buttons">
            <button class="btn btn-primary" id="profile-save">Сохранить профиль</button>
            <button class="btn btn-ghost" id="profile-topup">+500 OWY (демо)</button>
            <button class="btn btn-ghost" id="profile-reset">Сбросить демо баланс</button>
            <button class="btn btn-ghost" id="profile-feedback">✉ Написать в OWY Hub</button>
          </div>

          <div class="profile-note" id="profile-note">
            Данные и баланс хранятся только у тебя на устройстве (localStorage).
          </div>
        </div>
      </section>

      <!-- PET MATCH-3 OVERLAY -->
      <!-- MATCH-3 OVERLAY -->
      <div id="match3-overlay" class="overlay">
        <div class="overlay-inner">
          <div class="overlay-header">
            <button class="btn btn-ghost" id="match3-back">← Назад</button>
            <div class="overlay-title">Fluffie: 3 в ряд</div>
          </div>

          <div class="rush-status" id="match3-status">
            Сделай как можно больше комбинаций за 60 секунд.
          </div>

          <div class="rush-timer" id="match3-timer">
            Осталось: 60 c
          </div>

          <div class="match3-board" id="match3-board"></div>

          <div class="rush-status" id="match3-score">
            Очки: 0
          </div>
        </div>
      </div>

      <!-- TAP-TAP OVERLAY -->
      <div id="taptap-overlay" class="overlay">
        <div class="overlay-inner">
          <div class="overlay-header">
            <button class="btn btn-ghost" id="taptap-back">← Назад</button>
            <div class="overlay-title">Tap-tap</div>
          </div>

          <div class="rush-status" id="taptap-status">
            Успей тапнуть как можно больше целей за 30 секунд.
          </div>

          <div class="rush-timer" id="taptap-timer">
            Осталось: 30 c
          </div>

          <div class="taptap-board" id="taptap-board"></div>

          <div class="rush-status" id="taptap-score">
            Очки: 0
          </div>
        </div>
      </div>

      <!-- PET -->
      <section id="pet-screen" style="display:none;">
        <div class="section-title">Твой Fluffie</div>

        <div class="pet-card" id="pet-main-card">
          <!-- состояние, когда питомца ещё нет -->
          <div id="pet-empty-state">
            <p class="pet-text">
              Создай своего первого Fluffie-питомца. Он будет жить в OWY Play и
              реагировать на то, как ты играешь.
            </p>

            <div class="pet-field">
              <label for="pet-name-input">Имя питомца</label>
              <input id="pet-name-input" type="text" placeholder="Например, Бусти" />
              <div class="pet-error" id="pet-name-error"></div>
            </div>

            <div class="pet-field">
              <label>Пол питомца</label>
              <div class="pet-gender-row">
                <button class="btn btn-ghost pet-gender-btn pet-gender-active"
                        data-gender="male">Мальчик</button>
                <button class="btn btn-ghost pet-gender-btn"
                        data-gender="female">Девочка</button>
              </div>
            </div>

            <div class="pet-field">
              <label>Цвет Fluffie</label>
              <div class="pet-color-row">
                <button class="pet-color-pill pet-color-active"
                        data-color="purple">
                  <span class="pet-color-dot pet-color-purple"></span>
                  Фиолетовый
                </button>
                <button class="pet-color-pill"
                        data-color="green">
                  <span class="pet-color-dot pet-color-green"></span>
                  Зелёный
                </button>
                <button class="pet-color-pill"
                        data-color="black">
                  <span class="pet-color-dot pet-color-black"></span>
                  Ночной
                </button>
              </div>
            </div>

            <button class="btn btn-primary pet-create-btn" id="pet-create-btn">
              Создать Fluffie
            </button>
          </div>

          <!-- состояние, когда питомец уже создан -->
          <div id="pet-main-state" style="display:none;">
            <div class="pet-header-row">
              <div>
                <div class="pet-name" id="pet-name-label">Fluffie</div>
                <div class="pet-sub" id="pet-sub-label">Фиолетовый Fluffie • LVL 1</div>
              </div>
              <div class="pet-chip" id="pet-mood-chip">Настроение: 😊</div>
            </div>

            <div class="pet-xp-row">
              <div class="pet-xp-label" id="pet-xp-label">
                0 / 40 XP до LVL 2
              </div>
              <div class="pet-bar">
                <div class="pet-bar-fill pet-xp-fill" id="pet-xp-fill"></div>
              </div>
              <div class="pet-bonus-badge" id="pet-bonus-badge">
                Бонус к выигрышу: +0.0%
              </div>
            </div>

            <div class="pet-coins-row">
              <span>Монеты Fluffie</span>
              <span class="pet-coins-value" id="pet-coins-main">0</span>
            </div>

            <div class="pet-image-wrap">
              <img id="pet-image" src="purplefluffie.png" alt="Fluffie" />
            </div>

            <div class="pet-bars">
              <div class="pet-bar-row">
                <span>Настроение</span>
                <div class="pet-bar">
                  <div class="pet-bar-fill" id="pet-mood-fill"></div>
                </div>
              </div>
              <div class="pet-bar-row">
                <span>Энергия</span>
                <div class="pet-bar">
                  <div class="pet-bar-fill" id="pet-energy-fill"></div>
                </div>
              </div>
              <div class="pet-bar-row">
                <span>Сытость</span>
                <div class="pet-bar">
                  <div class="pet-bar-fill" id="pet-hunger-fill"></div>
                </div>
              </div>
            </div>

            <div class="pet-actions">
              <button class="btn btn-ghost pet-action-btn" data-action="feed">Покормить</button>
              <button class="btn btn-ghost pet-action-btn" data-action="play">Поиграть</button>
              <button class="btn btn-ghost pet-action-btn" data-action="rest">Отправить спать</button>
            </div>

            <div class="pet-note" id="pet-note">
              Fluffie чувствует себя отлично ✨
            </div>

            <button class="btn btn-ghost pet-shop-btn" id="pet-shop-open">
              Магазин Fluffie
            </button>

            <button class="btn btn-ghost pet-reset-btn" id="pet-reset-btn">
              Сбросить питомца (начать заново)
            </button>
          </div>
        </div>
      </section>
    </main>

    <nav class="bottom-nav">
      <div class="bottom-nav-inner">
        <div class="nav-item active" id="nav-casino">
          <span>🎰</span>
          <div class="nav-label">Casino</div>
        </div>

        <div class="nav-item" id="nav-bets">
          <span>📈</span>
          <div class="nav-label">Bets</div>
        </div>

        <div class="nav-item" id="nav-tasks">
          <span>📋</span>
          <div class="nav-label">Tasks</div>
        </div>

        <div class="nav-item" id="nav-pet">
          <span>🧿</span>
          <div class="nav-label">Fluffie</div>
        </div>
      </div>
    </nav>

    <!-- MINI GAMES OVERLAY -->
    <div id="mini-overlay" class="overlay">
      <div class="overlay-inner">
        <div class="overlay-header">
          <button class="btn btn-ghost" id="mini-back">← Назад</button>
          <div class="overlay-title">Мини-игры Fluffie</div>
        </div>

        <div class="cards big-cards">

          <!-- Активная игра -->
          <div class="card big-card" id="mini-open-match3">
            <div class="card-title">3 в ряд</div>
            <div class="card-sub">
              Собирай камни, набирай очки и прокачивай Fluffie.
            </div>
            <div class="card-footer">
              <button class="btn btn-primary">Играть</button>
            </div>
          </div>

          <div class="card big-card" id="mini-open-taptap">
            <div class="card-title">Tap-tap</div>
            <div class="card-sub">
              Быстрые тап-челленджи для энергии Fluffie.
            </div>
            <div class="card-footer">
              <button class="btn btn-primary">Играть</button>
            </div>
          </div>

          <div class="card big-card">
            <div class="card-title">Найди пару (скоро)</div>
            <div class="card-sub">
              Мемори-игра на внимательность и настроение.
            </div>
            <div class="card-footer">
              <button class="btn btn-ghost" disabled>Coming soon</button>
            </div>
          </div>

        </div> <!-- /cards -->
      </div>   <!-- /overlay-inner -->
    </div>     <!-- /mini-overlay -->

    <!-- PET SHOP OVERLAY (УЖЕ ОТДЕЛЬНО, НЕ ВНУТРИ mini-overlay) -->
    <div id="pet-shop-overlay" class="overlay">
      <div class="match3-card pet-shop-card">
        <div class="match3-header">
          <div class="match3-title">Магазин Fluffie</div>
          <button class="btn btn-ghost" id="pet-shop-close">Закрыть</button>
        </div>

        <div class="pet-shop-balance">
          Баланс монет Fluffie: <span id="pet-coins-shop">0</span>
        </div>

        <div class="pet-shop-items">
          <!-- ОБМЕН OWY → МОНЕТЫ FLUFFIE -->
          <div class="pet-shop-item">
            <div class="pet-shop-item-main">
              <div class="pet-shop-item-name">+20 монет Fluffie</div>
              <div class="pet-shop-item-desc">Обменяй 50 OWY на монеты для питомца.</div>
            </div>
            <div class="pet-shop-item-side">
              <div class="pet-shop-price">-50 OWY</div>
              <button class="btn btn-primary pet-shop-buy" data-item="coins-20">
                Купить
              </button>
            </div>
          </div>

          <div class="pet-shop-item">
            <div class="pet-shop-item-main">
              <div class="pet-shop-item-name">+60 монет Fluffie</div>
              <div class="pet-shop-item-desc">Чуть выгоднее курс: 120 OWY → 60 монет.</div>
            </div>
            <div class="pet-shop-item-side">
              <div class="pet-shop-price">-120 OWY</div>
              <button class="btn btn-primary pet-shop-buy" data-item="coins-60">
                Купить
              </button>
            </div>
          </div>

          <div class="pet-shop-item">
            <div class="pet-shop-item-main">
              <div class="pet-shop-item-name">+150 монет Fluffie</div>
              <div class="pet-shop-item-desc">Максимально выгодный обмен для гриндеров.</div>
            </div>
            <div class="pet-shop-item-side">
              <div class="pet-shop-price">-250 OWY</div>
              <button class="btn btn-primary pet-shop-buy" data-item="coins-150">
                Купить
              </button>
            </div>
          </div>

          <!-- ТРАТИМ МОНЕТЫ FLUFFIE -->
          <div class="pet-shop-item">
            <div class="pet-shop-item-main">
              <div class="pet-shop-item-name">Корм “Любимчик”</div>
              <div class="pet-shop-item-desc">+сытость, +настроение, немного XP.</div>
            </div>
            <div class="pet-shop-item-side">
              <div class="pet-shop-price">-10 монет</div>
              <button class="btn btn-ghost pet-shop-buy" data-item="cookie">
                Дать
              </button>
            </div>
          </div>

          <div class="pet-shop-item">
            <div class="pet-shop-item-main">
              <div class="pet-shop-item-name">Энергетик</div>
              <div class="pet-shop-item-desc">+энергия, но слегка проголодается.</div>
            </div>
            <div class="pet-shop-item-side">
              <div class="pet-shop-price">-14 монет</div>
              <button class="btn btn-ghost pet-shop-buy" data-item="energy">
                Дать
              </button>
            </div>
          </div>

          <div class="pet-shop-item">
            <div class="pet-shop-item-main">
              <div class="pet-shop-item-name">Подарок Fluffie</div>
              <div class="pet-shop-item-desc">Сильно поднимает настроение и XP.</div>
            </div>
            <div class="pet-shop-item-side">
              <div class="pet-shop-price">-22 монеты</div>
              <button class="btn btn-ghost pet-shop-buy" data-item="gift">
                Подарить
              </button>
            </div>
          </div>
        </div>

        <div class="pet-shop-note" id="pet-shop-note">
          Все покупки только в демо, без реальных денег.
        </div>
      </div>
    </div>

    <!-- RUSH OVERLAY -->
    <div id="rush-overlay" class="overlay">
      <div class="overlay-inner">
        <div class="overlay-header">
          <button class="btn btn-ghost" id="rush-back">← Назад</button>
          <div class="overlay-title">Rush</div>
        </div>

        <div class="rush-multiplier" id="rush-multiplier">x1.00</div>

        <div class="rush-timer" id="rush-timer">До старта: 10 c</div>

        <div class="rush-scene">
          <div class="rush-slope"></div>
          <div id="rush-owy"></div>
        </div>

        <div class="rush-track-line">
          <div class="rush-rocket" id="rush-rocket"></div>
        </div>

        <div class="rush-status" id="rush-status">
          Выбери ставку и жми старт
        </div>

        <div class="rush-history" id="rush-history">
          История: —
        </div>

        <div class="rush-input">
          <label class="auto-checkbox">
            <input type="checkbox" id="rush-auto-enabled" checked>
            <span class="checkmark"></span>
            <span class="auto-label-text">Автовывод, x</span>
          </label>
          <input type="number" id="rush-auto" value="2.0" step="0.1" min="1.01">
        </div>

        <div class="rush-input">
          <label for="rush-bet">Ставка, OWY</label>
          <input type="number" id="rush-bet" value="10" min="10">
        </div>

        <div class="rush-buttons">
          <button class="btn btn-primary" id="rush-start">Старт</button>
          <button class="btn btn-ghost" id="rush-cashout" disabled>Забрать</button>
        </div>
      </div>
    </div>

    <!-- PLINKO OVERLAY -->
    <div id="plinko-overlay" class="overlay">
      <div class="overlay-inner">
        <div class="overlay-header">
          <button class="btn btn-ghost" id="plinko-back">← Назад</button>
          <div class="overlay-title">Plinko</div>
        </div>

        <div class="plinko-board mid" id="plinko-board">
          <div class="plinko-pegs-layer" id="plinko-pegs-layer"></div>
          <div class="plinko-balls-layer" id="plinko-balls-layer"></div>
          <div class="plinko-slots" id="plinko-mults-row"></div>
        </div>

        <div class="rush-status" id="plinko-status">
          Выбирай риск и запускай шар 😉
        </div>

        <div class="plinko-history" id="plinko-history">
          История: —
        </div>

        <div class="rush-input">
          <label>Риск</label>
          <div class="rush-buttons" id="plinko-risk-buttons">
            <button class="btn btn-ghost" data-risk="low">Low</button>
            <button class="btn btn-ghost plinko-risk-active" data-risk="mid">Mid</button>
            <button class="btn btn-ghost" data-risk="high">High</button>
          </div>
        </div>

        <div class="rush-input">
          <label for="plinko-bet">Ставка, OWY</label>
          <input type="number" id="plinko-bet" value="10" min="10">
        </div>

        <div class="rush-buttons">
          <button class="btn btn-primary" id="plinko-start">Запустить шар</button>
        </div>
      </div>
    </div>

    <!-- DOUBLE OVERLAY -->
    <div id="double-overlay" class="overlay">
      <div class="overlay-inner">
        <div class="overlay-header">
          <button class="btn btn-ghost" id="double-back">← Назад</button>
          <div class="overlay-title">Double</div>
        </div>

        <div class="double-timer" id="double-timer">
          До спина: 10 c
        </div>

        <div class="rush-status" id="double-status"></div>

        <div class="double-wheel-wrap">
          <div class="double-pointer"></div>
          <div class="double-wheel-window">
            <div class="double-wheel-strip" id="double-wheel-strip">
              <!-- клетки генерим через JS -->
            </div>
          </div>
        </div>

        <div class="double-colors-row">
          <button class="double-color-btn blue"   data-color="blue"   id="double-btn-blue">2x</button>
          <button class="double-color-btn green"  data-color="green"  id="double-btn-green">2x</button>
          <button class="double-color-btn orange" data-color="orange" id="double-btn-orange">14x</button>
        </div>

        <div class="rush-input">
          <label for="double-bet">Ставка, OWY</label>
          <input type="number" id="double-bet" value="10" min="10">
        </div>

        <div class="double-history" id="double-history">
          История: —
        </div>
      </div>
    </div>

    <!-- HILO OVERLAY -->
    <div id="hilo-overlay" class="overlay">
      <div class="overlay-inner">
        <div class="overlay-header">
          <button class="btn btn-ghost" id="hilo-back">← Назад</button>
          <div class="overlay-title">HiLo</div>
        </div>

        <div class="hilo-sub">
          Сделай ставку один раз, угадывай карты подряд и забери выигрыш кэшаутом.
          Чем длиннее серия — тем больше x-множитель.
        </div>

        <div class="hilo-round-label" id="hilo-round-label">Раунд 1</div>

        <div class="hilo-card-wrap">
          <div class="hilo-card" id="hilo-current-card">7♦</div>
          <div class="hilo-card hilo-card-back" id="hilo-next-card">❔</div>
        </div>

        <div class="hilo-sub" id="hilo-odds-label">
          Шансы и множители обновляются от карты к карте.
        </div>

        <div class="rush-input">
          <label for="hilo-bet">Ставка, OWY (одна на всю серию)</label>
          <input type="number" id="hilo-bet" value="10" min="10">
        </div>

        <div class="hilo-buttons">
          <button class="btn btn-primary" id="hilo-low-btn">Ниже / равно</button>
          <button class="btn btn-primary" id="hilo-high-btn">Выше / равно</button>
        </div>

        <!-- КНОПКА КЭШАУТА -->
        <div class="rush-buttons" style="margin-top: 4px;">
          <button class="btn btn-ghost" id="hilo-cashout-btn" disabled>
            Кэш-аут x1.00
          </button>
        </div>

        <div class="hilo-status" id="hilo-status">
          Введи ставку, выбери выше/ниже и начинай серию. Кэш-аут забирает выигрыш по текущему множителю.
        </div>
      </div>
    </div>

  </div> <!-- /app -->

  <script>
    let tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
    let tgUser = null;
    if (tg) {
      tg.expand();
      tgUser = tg.initDataUnsafe && tg.initDataUnsafe.user ? tg.initDataUnsafe.user : null;
    }

    // === DOM ===
    const balanceEl        = document.querySelector('.balance-value');

    const homeScreen       = document.getElementById('home-screen');
    const profileScreen    = document.getElementById('profile-screen');
    const navHome          = document.getElementById('nav-home');
    const navProfile       = document.getElementById('nav-profile');
    const navPet           = document.getElementById('nav-pet');
    const hintTextEl       = document.getElementById('hint-text');

    const betsScreen   = document.getElementById('bets-screen');
    const tasksScreen  = document.getElementById('tasks-screen');

    // bottom nav
    const navCasino = document.getElementById('nav-casino');
    const navBets   = document.getElementById('nav-bets');
    const navTasks  = document.getElementById('nav-tasks');
    const navPetNav = document.getElementById('nav-pet');
    const navMenu   = document.getElementById('nav-menu');

    // top header buttons (логотип + аватар)
    const headerLogoBtn    = document.getElementById('header-logo-btn');
    const headerProfileBtn = document.getElementById('header-profile-btn');

    if (headerLogoBtn) {
      headerLogoBtn.addEventListener('click', () => {
        showScreen('casino');   // логотип всегда ведёт на главный экран
      });
    }

    if (headerProfileBtn) {
      headerProfileBtn.addEventListener('click', () => {
        showScreen('profile');  // аватар открывает профиль
      });
    }

    const petScreen        = document.getElementById('pet-screen');
    const petEmptyStateEl  = document.getElementById('pet-empty-state');
    const petMainStateEl   = document.getElementById('pet-main-state');
    const petNameInput     = document.getElementById('pet-name-input');
    const petCreateBtn     = document.getElementById('pet-create-btn');
    const petGenderBtns    = document.querySelectorAll('.pet-gender-btn');
    const petColorPills    = document.querySelectorAll('.pet-color-pill');
    const petImageEl       = document.getElementById('pet-image');
    const petNameLabelEl   = document.getElementById('pet-name-label');
    const petSubLabelEl    = document.getElementById('pet-sub-label');
    const petMoodChipEl    = document.getElementById('pet-mood-chip');
    const petMoodFillEl    = document.getElementById('pet-mood-fill');
    const petEnergyFillEl  = document.getElementById('pet-energy-fill');
    const petHungerFillEl  = document.getElementById('pet-hunger-fill');
    const petXpLabelEl     = document.getElementById('pet-xp-label');      // NEW
    const petXpFillEl      = document.getElementById('pet-xp-fill');       // NEW
    const petBonusBadgeEl  = document.getElementById('pet-bonus-badge');   // NEW
    const petCoinsMainEl   = document.getElementById('pet-coins-main');
    const petCoinsShopEl   = document.getElementById('pet-coins-shop');
    const petNoteEl        = document.getElementById('pet-note');
    const petResetBtn      = document.getElementById('pet-reset-btn');
    const petActionBtns    = document.querySelectorAll('.pet-action-btn');

    const miniOverlay       = document.getElementById('mini-overlay');
    const miniBackBtn       = document.getElementById('mini-back');
    const miniOpenMatch3Btn = document.getElementById('mini-open-match3');
    const petShopOpenBtn    = document.getElementById('pet-shop-open');
    const petShopOverlay    = document.getElementById('pet-shop-overlay');
    const petShopCloseBtn   = document.getElementById('pet-shop-close');
    const petShopNoteEl     = document.getElementById('pet-shop-note');
    const petShopBuyBtns    = document.querySelectorAll('.pet-shop-buy');

    const profileIdEl         = document.getElementById('profile-id');
    const profileBalanceEl    = document.getElementById('profile-balance');
    const profileResetBtn     = document.getElementById('profile-reset');
    const profileTopupBtn     = document.getElementById('profile-topup');
    const profileFeedbackBtn  = document.getElementById('profile-feedback');
    const profileNoteEl       = document.getElementById('profile-note');

    const profileNameInput     = document.getElementById('profile-name');
    const profileUsernameInput = document.getElementById('profile-username');
    const profileBirthInput    = document.getElementById('profile-birthdate');
    const profileGenderSelect  = document.getElementById('profile-gender');
    const profileSaveBtn       = document.getElementById('profile-save');

    const rankLabelEl   = document.getElementById('rank-label');
    const xpLabelEl     = document.getElementById('xp-label');
    const xpBarFillEl   = document.getElementById('xp-bar-fill');
    const statsRowEl    = document.getElementById('stats-row');
    const mission1El    = document.getElementById('mission-1');
    const mission2El    = document.getElementById('mission-2');
    const mission3El    = document.getElementById('mission-3');

    const rushOverlay     = document.getElementById('rush-overlay');
    const rushOpenBtn     = document.getElementById('rush-open');
    const rushBackBtn     = document.getElementById('rush-back');
    const rushMultEl      = document.getElementById('rush-multiplier');
    const rushRocketEl    = document.getElementById('rush-rocket');
    const rushStatusEl    = document.getElementById('rush-status');
    const rushHistoryEl   = document.getElementById('rush-history');
    const rushTimerEl     = document.getElementById('rush-timer');
    const rushBetInput    = document.getElementById('rush-bet');
    const rushAutoInput   = document.getElementById('rush-auto');
    const rushAutoEnabled = document.getElementById('rush-auto-enabled');
    const rushStartBtn    = document.getElementById('rush-start');
    const rushCashoutBtn  = document.getElementById('rush-cashout');
    const rushOwyEl       = document.getElementById('rush-owy');

    const match3Overlay = document.getElementById('match3-overlay');
    const match3BackBtn = document.getElementById('match3-back');
    const match3BoardEl = document.getElementById('match3-board');
    const match3StatusEl= document.getElementById('match3-status');
    const match3TimerEl = document.getElementById('match3-timer');
    const match3ScoreEl = document.getElementById('match3-score');

    const plinkoOverlay    = document.getElementById('plinko-overlay');
    const plinkoOpenBtn    = document.getElementById('plinko-open');
    const plinkoBackBtn    = document.getElementById('plinko-back');
    const plinkoStatusEl   = document.getElementById('plinko-status');
    const plinkoHistoryEl  = document.getElementById('plinko-history');
    const plinkoBetInput   = document.getElementById('plinko-bet');
    const plinkoStartBtn   = document.getElementById('plinko-start');
    const plinkoRiskBtns   = document.querySelectorAll('#plinko-risk-buttons button');
    const plinkoBoardEl    = document.getElementById('plinko-board');
    const plinkoMultsRow   = document.getElementById('plinko-mults-row');
    const plinkoBallsLayer = document.getElementById('plinko-balls-layer');
    const plinkoPegsLayer  = document.getElementById('plinko-pegs-layer');

    // === FIX SPLASH: после анимации убираем оверлей целиком, чтобы не перехватывал клики ===
    const splashEl = document.getElementById('splash');
    if (splashEl) {
      // 0.8s задержка + 0.6s анимация = 1400ms
      setTimeout(() => {
        splashEl.classList.add('splash-hide');
      }, 1400);
    }

    // --- карточки мини-игр на главном экране (если бы были отдельные id) ---
    const cardRush   = document.getElementById('card-rush');
    const cardDouble = document.getElementById('card-double');
    const cardPlinko = document.getElementById('card-plinko');
    const cardHilo   = document.getElementById('card-hilo');

    function openOverlay(el) {
      if (el) el.style.display = 'flex';
    }

    if (cardRush) {
      cardRush.addEventListener('click', () => openOverlay(rushOverlay));
    }
    if (cardDouble) {
      cardDouble.addEventListener('click', () => openOverlay(doubleOverlay));
    }
    if (cardPlinko) {
      cardPlinko.addEventListener('click', () => openOverlay(plinkoOverlay));
    }
    if (cardHilo) {
      cardHilo.addEventListener('click', () => openOverlay(hiloOverlay));
    }

 <script>
'use strict';

// === DOM references (предполагается, что элементы есть в DOM) ===
// (часть имен взята из твоего куска, если чего-то нет — просто будет null и обработчики не добавятся)
const doubleOverlay     = document.getElementById('double-overlay');
const doubleOpenBtn     = document.getElementById('double-open');  // кнопка на главном
const doubleBackBtn     = document.getElementById('double-back');

const doubleTimerEl     = document.getElementById('double-timer');
const doubleWheelStrip  = document.getElementById('double-wheel-strip');

const doubleBtnBlue     = document.getElementById('double-btn-blue');
const doubleBtnGreen    = document.getElementById('double-btn-green');
const doubleBtnOrange   = document.getElementById('double-btn-orange');

const doubleBetInput    = document.getElementById('double-bet');
const doubleHistoryEl   = document.getElementById('double-history');
const doubleStatusEl    = document.getElementById('double-status');

const match3BoardEl     = document.getElementById('match3-board');
const match3ScoreEl     = document.getElementById('match3-score');
const match3TimerEl     = document.getElementById('match3-timer');
const match3StatusEl    = document.getElementById('match3-status');
const match3Overlay     = document.getElementById('match3-overlay');
const match3BackBtn     = document.getElementById('match3-back');

const petEmptyStateEl   = document.getElementById('pet-empty');
const petMainStateEl    = document.getElementById('pet-main');
const petNameLabelEl    = document.getElementById('pet-name');
const petSubLabelEl     = document.getElementById('pet-sub');
const petImageEl        = document.getElementById('pet-image');
const petMoodFillEl     = document.getElementById('pet-mood-fill');
const petEnergyFillEl   = document.getElementById('pet-energy-fill');
const petHungerFillEl   = document.getElementById('pet-hunger-fill');
const petMoodChipEl     = document.getElementById('pet-mood-chip');
const petXpLabelEl      = document.getElementById('pet-xp-label');
const petXpFillEl       = document.getElementById('pet-xp-fill');
const petCoinsMainEl    = document.getElementById('pet-coins-main');
const petCoinsShopEl    = document.getElementById('pet-coins-shop');
const petBonusBadgeEl   = document.getElementById('pet-bonus-badge');
const petNoteEl         = document.getElementById('pet-note');

const petGenderBtns     = document.querySelectorAll('[data-pet-gender]');
const petColorPills     = document.querySelectorAll('[data-color]');
const petCreateBtn      = document.getElementById('pet-create-btn');
const petNameInput      = document.getElementById('pet-name-input');
const petActionBtns     = document.querySelectorAll('[data-action]');
const petShopOpenBtn    = document.getElementById('pet-shop-open');
const petShopCloseBtn   = document.getElementById('pet-shop-close');
const petShopOverlay    = document.getElementById('pet-shop-overlay');
const petShopNoteEl     = document.getElementById('pet-shop-note');
const petShopBuyBtns    = document.querySelectorAll('[data-item]');
const petResetBtn       = document.getElementById('pet-reset');

const taptapOverlay     = document.getElementById('taptap-overlay');
const taptapBackBtn     = document.getElementById('taptap-back');
const taptapBoardEl     = document.getElementById('taptap-board');
const taptapTimerEl     = document.getElementById('taptap-timer');
const taptapScoreEl     = document.getElementById('taptap-score');
const taptapStatusEl    = document.getElementById('taptap-status');
const miniOpenTapTapBtn = document.getElementById('mini-open-taptap');

const plinkoOverlay     = document.getElementById('plinko-overlay');
const plinkoOpenBtn     = document.getElementById('plinko-open');
const plinkoBackBtn     = document.getElementById('plinko-back');
const plinkoStartBtn    = document.getElementById('plinko-start');
const plinkoPegsLayer   = document.getElementById('plinko-pegs');
const plinkoBoardEl     = document.getElementById('plinko-board');
const plinkoMultsRow    = document.getElementById('plinko-mults-row');
const plinkoBallsLayer  = document.getElementById('plinko-balls-layer');
const plinkoBetInput    = document.getElementById('plinko-bet');
const plinkoRiskBtns    = document.querySelectorAll('[data-risk]');
const plinkoStatusEl    = document.getElementById('plinko-status');
const plinkoHistoryEl   = document.getElementById('plinko-history');

const rushOverlay       = document.getElementById('rush-overlay');
const rushOpenBtn       = document.getElementById('rush-open');
const rushBackBtn       = document.getElementById('rush-back');
const rushStartBtn      = document.getElementById('rush-start');
const rushCashoutBtn    = document.getElementById('rush-cashout');
const rushBetInput      = document.getElementById('rush-bet');
const rushAutoEnabled   = document.getElementById('rush-auto-enabled');
const rushAutoInput     = document.getElementById('rush-auto-input');
const rushStatusEl      = document.getElementById('rush-status');
const rushMultEl        = document.getElementById('rush-mult');
const rushRocketEl      = document.getElementById('rush-rocket');
const rushTimerEl       = document.getElementById('rush-timer');
const rushHistoryEl     = document.getElementById('rush-history');

const hiloOverlay       = document.getElementById('hilo-overlay');
const hiloOpenBtn       = document.getElementById('hilo-open');
const hiloBackBtn       = document.getElementById('hilo-back');
const hiloRoundLabel    = document.getElementById('hilo-round-label');
const hiloCurrentCardEl = document.getElementById('hilo-current-card');
const hiloNextCardEl    = document.getElementById('hilo-next-card');
const hiloBetInput      = document.getElementById('hilo-bet');
const hiloStatusEl      = document.getElementById('hilo-status');
const hiloOddsLabelEl   = document.getElementById('hilo-odds-label');
const hiloLowBtn        = document.getElementById('hilo-low-btn');
const hiloHighBtn       = document.getElementById('hilo-high-btn');
const hiloCashoutBtn    = document.getElementById('hilo-cashout-btn');

const balanceEl         = document.getElementById('balance');
const profileBalanceEl  = document.getElementById('profile-balance');
const profileIdEl       = document.getElementById('profile-id');
const profileNameInput  = document.getElementById('profile-name');
const profileUsernameInput = document.getElementById('profile-username');
const profileBirthInput = document.getElementById('profile-birth');
const profileGenderSelect= document.getElementById('profile-gender');
const profileSaveBtn    = document.getElementById('profile-save');
const profileResetBtn   = document.getElementById('profile-reset');
const profileTopupBtn   = document.getElementById('profile-topup');
const profileFeedbackBtn= document.getElementById('profile-feedback');
const profileNoteEl     = document.getElementById('profile-note');

const match3OverlayEl   = match3Overlay; // alias
const miniOverlay       = document.getElementById('mini-overlay');
const miniBackBtn       = document.getElementById('mini-back');
const miniOpenMatch3Btn = document.getElementById('mini-open-match3');

const navCasino         = document.getElementById('nav-casino');
const navBets           = document.getElementById('nav-bets');
const navTasks          = document.getElementById('nav-tasks');
const navPetNav         = document.getElementById('nav-pet');
const navMenu           = document.getElementById('nav-menu');

const homeScreen        = document.getElementById('screen-home');
const betsScreen        = document.getElementById('screen-bets');
const tasksScreen       = document.getElementById('screen-tasks');
const petScreen         = document.getElementById('screen-pet');
const profileScreen     = document.getElementById('screen-profile');

// === helper: hide keyboard on outside tap ===
function handleHideKeyboard(e) {
  const active = document.activeElement;
  if (!active) return;

  const tag = active.tagName;
  const isInput =
    tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT';

  if (!isInput) return;

  if (e.target.closest('input, textarea, select')) return;

  active.blur();
}
document.addEventListener('touchstart', handleHideKeyboard, true);
document.addEventListener('click', handleHideKeyboard, true);

// === STORAGE KEYS and initial state ===
const STORAGE_KEY_BALANCE = 'owy_balance_v1';
const STORAGE_KEY_PROFILE = 'owy_profile_info_v1';
const STORAGE_KEY_STATS   = 'owy_stats_v1';
const STORAGE_KEY_PET     = 'owy_pet_v1'; // 🐾

let demoBalance = 1000;
let profileData = { name: "", username: "", birthdate: "", gender: "" };
let stats = { rushPlays: 0, plinkoPlays: 0, hiloPlays: 0, bestMulti: 1.0, xp: 0 };

// === load / save helpers ===
function loadBalance() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY_BALANCE);
    const val = parseInt(raw, 10);
    if (!isNaN(val) && val >= 0) demoBalance = val;
  } catch (e) { demoBalance = 1000; }
}
function saveBalance() {
  try { localStorage.setItem(STORAGE_KEY_BALANCE, String(demoBalance)); } catch (e) {}
}
function updateBalanceView() {
  const txt = demoBalance.toLocaleString('ru-RU') + ' OWY';
  if (balanceEl)        balanceEl.textContent = txt;
  if (profileBalanceEl) profileBalanceEl.textContent = txt;
}
function loadProfileInfo() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY_PROFILE);
    if (raw) profileData = { ...profileData, ...JSON.parse(raw) };
  } catch (e) {}
}
function saveProfileInfo() {
  try { localStorage.setItem(STORAGE_KEY_PROFILE, JSON.stringify(profileData)); } catch (e) {}
}
function loadStats() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY_STATS);
    if (raw) stats = { ...stats, ...JSON.parse(raw) };
  } catch (e) {}
}
function saveStats() {
  try { localStorage.setItem(STORAGE_KEY_STATS, JSON.stringify(stats)); } catch (e) {}
}

// === PET (Fluffie) ===
function calcPetLevelFromXp(totalXp) {
  const maxLevel = 30;
  let xpLeft   = Math.max(0, Math.floor(totalXp || 0));
  let level    = 1;
  let xpToNext = 40; // XP на переход 1→2
  while (level < maxLevel && xpLeft >= xpToNext) {
    xpLeft   -= xpToNext;
    level    += 1;
    xpToNext = Math.floor(xpToNext * 1.35 + 10);
  }
  return { level, xpInLevel: xpLeft, xpToNext: level >= maxLevel ? null : xpToNext };
}

let petData = {
  name: '',
  gender: 'male',
  color: 'purple',
  mood: 80,
  energy: 80,
  hunger: 70,
  xp: 0,
  level: 1,
  coins: 0,
  createdAt: null,
  lastUpdateAt: null
};

function loadPet() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY_PET);
    if (raw) {
      petData = { ...petData, ...JSON.parse(raw) };
    }
  } catch (e) {}
  if (typeof petData.hunger !== 'number') petData.hunger = 70;
  if (typeof petData.xp !== 'number') petData.xp = 0;
  if (typeof petData.coins !== 'number') petData.coins = 0;
  const lvlInfo = calcPetLevelFromXp(petData.xp);
  petData.level = lvlInfo.level;
  updatePetUI();
}
function savePet() {
  try { localStorage.setItem(STORAGE_KEY_PET, JSON.stringify(petData)); } catch (e) {}
}
function getPetBonus() {
  if (!petData.name) return 0;
  const lvlInfo = calcPetLevelFromXp(petData.xp || 0);
  const level   = lvlInfo.level;
  const mood    = petData.mood || 0;
  const hunger  = (petData.hunger != null ? petData.hunger : 70);
  let base = 0;
  if (level >= 3)  base += 0.01;
  if (level >= 7)  base += 0.02;
  if (level >= 12) base += 0.03;
  if (level >= 20) base += 0.04;
  if (level >= 28) base += 0.05;
  if (mood >= 90)      base += 0.01;
  else if (mood < 40)  base -= 0.005;
  if (hunger < 30) base -= 0.01;
  if (base < 0) base = 0;
  if (base > 0.12) base = 0.12;
  return base;
}
function applyPetDecay() {
  if (!petData.name || !petData.lastUpdateAt) return;
  const now     = Date.now();
  const diffMs  = now - petData.lastUpdateAt;
  const minutes = diffMs / 60000;
  if (minutes < 1) return;
  const moodPerHour    = 4;
  const energyPerHour  = 3;
  const hungerPerHour  = 2;
  const moodDelta   = (moodPerHour   / 60) * minutes;
  const energyDelta = (energyPerHour / 60) * minutes;
  const hungerDelta = (hungerPerHour / 60) * minutes;
  petData.mood   = Math.max(0, petData.mood   - moodDelta);
  petData.energy = Math.max(0, petData.energy - energyDelta);
  petData.hunger = Math.max(0, (petData.hunger || 0) - hungerDelta);
  petData.lastUpdateAt = now;
  savePet();
  updatePetUI();
}
function getColorLabel(color) {
  if (color === 'green') return 'Зелёный Fluffie';
  if (color === 'black') return 'Ночной Fluffie';
  return 'Фиолетовый Fluffie';
}
function getColorImage(color) {
  if (color === 'green') return 'greenfluffie.png';
  if (color === 'black') return 'blackfluffie.png';
  return 'purplefluffie.png';
}
function updatePetUI() {
  if (!petEmptyStateEl || !petMainStateEl) return;
  const hasPet = !!petData.name;
  if (!hasPet) {
    petEmptyStateEl.style.display = '';
    petMainStateEl.style.display  = 'none';
    return;
  }
  petEmptyStateEl.style.display = 'none';
  petMainStateEl.style.display  = '';
  const lvlInfo = calcPetLevelFromXp(petData.xp || 0);
  petData.level = lvlInfo.level;
  if (petNameLabelEl) petNameLabelEl.textContent = petData.name;
  if (petSubLabelEl) petSubLabelEl.textContent = `${getColorLabel(petData.color)} • LVL ${petData.level}`;
  if (petImageEl) petImageEl.src = getColorImage(petData.color);
  const mood   = Math.max(0, Math.min(100, petData.mood));
  const energy = Math.max(0, Math.min(100, petData.energy));
  const hunger = Math.max(0, Math.min(100, petData.hunger || 0));
  if (petMoodFillEl)   petMoodFillEl.style.width   = mood   + '%';
  if (petEnergyFillEl) petEnergyFillEl.style.width = energy + '%';
  if (petHungerFillEl) petHungerFillEl.style.width = hunger + '%';
  let moodEmoji = '😊';
  if (mood < 30) moodEmoji = '😢';
  else if (mood < 60) moodEmoji = '😐';
  else if (mood > 90) moodEmoji = '🤩';
  if (petMoodChipEl) petMoodChipEl.textContent = `Настроение: ${moodEmoji}`;
  if (petXpLabelEl) {
    if (lvlInfo.xpToNext === null) {
      petXpLabelEl.textContent = `${petData.xp} XP • максимальный уровень`;
    } else {
      petXpLabelEl.textContent = `${lvlInfo.xpInLevel} / ${lvlInfo.xpToNext} XP до LVL ${petData.level + 1}`;
    }
  }
  if (petXpFillEl) {
    if (lvlInfo.xpToNext === null) petXpFillEl.style.width = '100%';
    else {
      const perc = Math.max(0, Math.min(100, (lvlInfo.xpInLevel / lvlInfo.xpToNext) * 100));
      petXpFillEl.style.width = perc + '%';
    }
  }
  const coins = typeof petData.coins === 'number' ? petData.coins : 0;
  if (petCoinsMainEl) petCoinsMainEl.textContent = coins.toString();
  if (petCoinsShopEl) petCoinsShopEl.textContent = coins.toString();
  if (petBonusBadgeEl) {
    const bonus = getPetBonus();
    const pct   = Math.round(bonus * 1000) / 10;
    petBonusBadgeEl.textContent = `Бонус к выигрышу: +${pct.toFixed(1)}%`;
  }
  if (petNoteEl) {
    if (hunger < 25) petNoteEl.textContent = `${petData.name} очень голоден. Покорми его скорее 🍪`;
    else if (mood < 30) petNoteEl.textContent = `${petData.name} грустит. Поиграй с ним или покорми.`;
    else if (energy < 30) petNoteEl.textContent = `${petData.name} устал. Отправь его поспать 😴`;
    else petNoteEl.textContent = `${petData.name} чувствует себя отлично ✨ LVL ${petData.level}`;
  }
}

// pet controls
if (petGenderBtns && petGenderBtns.length) {
  petGenderBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      petGenderBtns.forEach(b => b.classList.remove('pet-gender-active'));
      btn.classList.add('pet-gender-active');
      petData.gender = btn.dataset.gender || 'male';
    });
  });
}
if (petColorPills && petColorPills.length) {
  petColorPills.forEach(pill => {
    pill.addEventListener('click', () => {
      petColorPills.forEach(p => p.classList.remove('pet-color-active'));
      pill.classList.add('pet-color-active');
      petData.color = pill.dataset.color || 'purple';
    });
  });
}
if (petCreateBtn) {
  petCreateBtn.addEventListener('click', () => {
    const name = (petNameInput.value || '').trim();
    if (!name) {
      if (petNoteEl) petNoteEl.textContent = 'Дай имя своему Fluffie 🙂';
      if (navigator && navigator.vibrate) navigator.vibrate(40);
      return;
    }
    const now = Date.now();
    petData.name   = name;
    petData.mood   = 85;
    petData.energy = 85;
    petData.hunger = 80;
    petData.xp     = 0;
    petData.level  = 1;
    petData.createdAt    = now;
    petData.lastUpdateAt = now;
    savePet();
    updatePetUI();
    if (navigator && navigator.vibrate) navigator.vibrate(70);
  });
}
if (petActionBtns && petActionBtns.length) {
  petActionBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      if (!petData.name) return;
      const action = btn.dataset.action;
      if (action === 'feed') {
        const FEED_COST = 3;
        const currentCoins = petData.coins || 0;
        if (currentCoins < FEED_COST) {
          if (petNoteEl) petNoteEl.textContent = 'Не хватает монет Fluffie, чтобы покормить. Сыграй мини-игру или купи монеты в магазине 🪙';
          if (navigator && navigator.vibrate) navigator.vibrate(40);
          return;
        }
        petData.coins  = currentCoins - FEED_COST;
        petData.hunger = Math.min(100, (petData.hunger || 0) + 16);
        petData.mood   = Math.min(100, petData.mood + 6);
        petData.energy = Math.min(100, petData.energy + 4);
        petData.xp     = (petData.xp || 0) + 2;
      } else if (action === 'play') {
        openMiniOverlay();
      } else if (action === 'rest') {
        petData.energy = Math.min(100, petData.energy + 20);
        petData.mood   = Math.max(0,  petData.mood - 3);
        petData.hunger = Math.max(0,  (petData.hunger || 0) - 4);
        petData.xp     = (petData.xp || 0) + 2;
      }
      const info = calcPetLevelFromXp(petData.xp || 0);
      petData.level = info.level;
      petData.lastUpdateAt = Date.now();
      if (petImageEl) {
        petImageEl.classList.remove('pet-bounce');
        void petImageEl.offsetWidth;
        petImageEl.classList.add('pet-bounce');
      }
      savePet();
      updatePetUI();
      if (navigator && navigator.vibrate) navigator.vibrate(40);
    });
  });
}
if (petResetBtn) {
  petResetBtn.addEventListener('click', () => {
    petData = {
      name: '',
      gender: 'male',
      color: 'purple',
      mood: 80,
      energy: 80,
      hunger: 70,
      xp: 0,
      level: 1,
      createdAt: null,
      lastUpdateAt: null,
      coins: 0
    };
    savePet();
    updatePetUI();
    if (petNoteEl) petNoteEl.textContent = 'Питомец сброшен. Можно создать нового Fluffie.';
  });
}

// Pet shop
function openPetShop() {
  if (!petShopOverlay) return;
  petShopOverlay.style.display = 'flex';
  if (petShopNoteEl) petShopNoteEl.textContent = 'Купи что-нибудь вкусное для Fluffie 🍪';
  updatePetUI();
}
function closePetShop() {
  if (!petShopOverlay) return;
  petShopOverlay.style.display = 'none';
}
if (petShopOpenBtn) petShopOpenBtn.addEventListener('click', () => { openPetShop(); if (navigator && navigator.vibrate) navigator.vibrate(30); });
if (petShopCloseBtn) petShopCloseBtn.addEventListener('click', () => { closePetShop(); if (navigator && navigator.vibrate) navigator.vibrate(20); });

function handlePetShopBuy(item) {
  if (!petData.name) {
    if (petShopNoteEl) petShopNoteEl.textContent = 'Сначала создай питомца, а потом уже балуй его покупками 🙂';
    if (navigator && navigator.vibrate) navigator.vibrate(40);
    return;
  }
  if (item === 'coins-20' || item === 'coins-60' || item === 'coins-150') {
    let owCost = 0, coins = 0;
    if (item === 'coins-20') { owCost = 50; coins = 20; }
    else if (item === 'coins-60') { owCost = 120; coins = 60; }
    else if (item === 'coins-150') { owCost = 250; coins = 150; }
    if (demoBalance < owCost) {
      if (petShopNoteEl) petShopNoteEl.textContent = 'Недостаточно OWY для обмена 😔';
      if (navigator && navigator.vibrate) navigator.vibrate(40);
      return;
    }
    demoBalance -= owCost; saveBalance(); updateBalanceView();
    petData.coins = (petData.coins || 0) + coins;
    petData.lastUpdateAt = Date.now();
    savePet(); updatePetUI();
    if (petShopNoteEl) petShopNoteEl.textContent = `Обмен выполнен: +${coins} монет Fluffie за ${owCost} OWY 🪙`;
    if (navigator && navigator.vibrate) navigator.vibrate(50);
    return;
  }
  let costCoins = 0, mood = 0, energy = 0, hunger = 0, xp = 0, itemLabel = '';
  if (item === 'cookie') { costCoins = 10; hunger = +18; mood = +8; xp = 3; itemLabel = 'печеньку'; }
  else if (item === 'energy') { costCoins = 14; energy = +30; hunger = -6; xp = 4; itemLabel = 'энергетик'; }
  else if (item === 'gift') { costCoins = 22; mood = +25; xp = 8; itemLabel = 'подарок'; }
  else return;
  const currentCoins = petData.coins || 0;
  if (currentCoins < costCoins) {
    if (petShopNoteEl) petShopNoteEl.textContent = 'Недостаточно монет Fluffie. Сыграй мини-игры или купи монеты в обменнике 🪙';
    if (navigator && navigator.vibrate) navigator.vibrate(40);
    return;
  }
  petData.coins = currentCoins - costCoins;
  petData.mood   = Math.max(0, Math.min(100, petData.mood + mood));
  petData.energy = Math.max(0, Math.min(100, petData.energy + energy));
  petData.hunger = Math.max(0, Math.min(100, (petData.hunger || 0) + hunger));
  petData.xp     = (petData.xp || 0) + xp;
  const lvlInfo = calcPetLevelFromXp(petData.xp || 0);
  petData.level = lvlInfo.level;
  petData.lastUpdateAt = Date.now();
  savePet(); updatePetUI();
  stats.xp += Math.max(1, xp); saveStats(); updateStatsView();
  if (petShopNoteEl) petShopNoteEl.textContent = `${petData.name} получил ${itemLabel}! XP +${xp}, настроение/энергия обновлены ✨`;
  if (navigator && navigator.vibrate) navigator.vibrate(60);
}
if (petShopBuyBtns && petShopBuyBtns.length) {
  petShopBuyBtns.forEach(btn => btn.addEventListener('click', () => {
    const item = btn.dataset.item; handlePetShopBuy(item);
  }));
}

// === NAVIGATION (single scheme: showScreen) ===
function showScreen(name) {
  if (homeScreen)    homeScreen.style.display    = (name === 'casino') ? 'block' : 'none';
  if (betsScreen)    betsScreen.style.display    = (name === 'bets')   ? 'block' : 'none';
  if (tasksScreen)   tasksScreen.style.display   = (name === 'tasks')  ? 'block' : 'none';
  if (petScreen)     petScreen.style.display     = (name === 'pet')    ? 'block' : 'none';
  if (profileScreen) profileScreen.style.display = (name === 'profile')? 'block' : 'none';

  [navCasino, navBets, navTasks, navPetNav, navMenu].forEach(el => {
    if (!el) return; el.classList.remove('active');
  });
  if (name === 'casino' && navCasino) navCasino.classList.add('active');
  if (name === 'bets'   && navBets)   navBets.classList.add('active');
  if (name === 'tasks'  && navTasks)  navTasks.classList.add('active');
  if (name === 'pet'    && navPetNav) navPetNav.classList.add('active');
  if (name === 'menu'   && navMenu)   navMenu.classList.add('active');
}
if (navCasino) navCasino.addEventListener('click', () => showScreen('casino'));
if (navBets)   navBets.addEventListener('click',   () => showScreen('bets'));
if (navTasks)  navTasks.addEventListener('click',  () => showScreen('tasks'));
if (navPetNav) navPetNav.addEventListener('click', () => showScreen('pet'));
if (navMenu)   navMenu.addEventListener('click', () => { /* future menu */ });

// === MATCH-3 (Fluffie) ===
const MATCH3_ROWS  = 7;
const MATCH3_COLS  = 7;
const MATCH3_TYPES = 5;
let match3Grid      = [];
let match3Score     = 0;
let match3TimeLeft  = 60;
let match3TimerId   = null;
let match3Busy      = false;
let match3StartCell = null;
let match3PointerId = null;

function createMatch3Grid() {
  match3Grid = [];
  for (let r = 0; r < MATCH3_ROWS; r++) {
    const row = [];
    for (let c = 0; c < MATCH3_COLS; c++) {
      let val;
      do {
        val = Math.floor(Math.random() * MATCH3_TYPES);
      } while (
        (c >= 2 && row[c - 1] === val && row[c - 2] === val) ||
        (r >= 2 && match3Grid[r - 1][c] === val && match3Grid[r - 2][c] === val)
      );
      row.push(val);
    }
    match3Grid.push(row);
  }
}

function renderMatch3Grid() {
  if (!match3BoardEl) return;
  match3BoardEl.innerHTML = '';
  for (let r = 0; r < MATCH3_ROWS; r++) {
    for (let c = 0; c < MATCH3_COLS; c++) {
      const val = match3Grid[r][c];
      if (val == null) continue;
      const cell = document.createElement('div');
      cell.className = 'match3-cell';
      cell.style.left = (c * (100 / MATCH3_COLS)) + '%';
      cell.style.top  = (r * (100 / MATCH3_ROWS)) + '%';
      cell.dataset.row = r;
      cell.dataset.col = c;
      const gem = document.createElement('div');
      gem.className = 'match3-gem match3-gem-' + val;
      cell.appendChild(gem);
      match3BoardEl.appendChild(cell);
    }
  }
}

function findMatches() {
  const toClear = Array.from({ length: MATCH3_ROWS }, () => Array(MATCH3_COLS).fill(false));
  let hasMatch = false;
  // горизонтально
  for (let r = 0; r < MATCH3_ROWS; r++) {
    let runVal = null;
    let runLen = 0;
    for (let c = 0; c <= MATCH3_COLS; c++) {
      const val = c < MATCH3_COLS ? match3Grid[r][c] : null;
      if (val !== null && val === runVal) { runLen++; }
      else {
        if (runVal !== null && runLen >= 3) {
          hasMatch = true;
          for (let k = 1; k <= runLen; k++) { toClear[r][c - k] = true; }
        }
        runVal = val; runLen = 1;
      }
    }
  }
  // вертикально
  for (let c = 0; c < MATCH3_COLS; c++) {
    let runVal = null; let runLen = 0;
    for (let r = 0; r <= MATCH3_ROWS; r++) {
      const val = r < MATCH3_ROWS ? match3Grid[r][c] : null;
      if (val !== null && val === runVal) { runLen++; }
      else {
        if (runVal !== null && runLen >= 3) {
          hasMatch = true;
          for (let k = 1; k <= runLen; k++) { toClear[r - k][c] = true; }
        }
        runVal = val; runLen = 1;
      }
    }
  }
  return { hasMatch, toClear };
}

function applyMatchesAnimation(toClear) {
  if (!match3BoardEl) return;
  const cells = match3BoardEl.querySelectorAll('.match3-cell');
  cells.forEach(cell => {
    const r = parseInt(cell.dataset.row, 10);
    const c = parseInt(cell.dataset.col, 10);
    if (toClear[r][c]) cell.classList.add('match3-cell--pop');
  });
}

function dropAndRefill() {
  for (let c = 0; c < MATCH3_COLS; c++) {
    let writeRow = MATCH3_ROWS - 1;
    for (let r = MATCH3_ROWS - 1; r >= 0; r--) {
      if (match3Grid[r][c] != null) { match3Grid[writeRow][c] = match3Grid[r][c]; writeRow--; }
    }
    while (writeRow >= 0) {
      match3Grid[writeRow][c] = Math.floor(Math.random() * MATCH3_TYPES);
      writeRow--;
    }
  }
}

function resolveMatchesLoop() {
  if (match3Busy) return;
  match3Busy = true;
  const { hasMatch, toClear } = findMatches();
  if (!hasMatch) { match3Busy = false; return; }
  let cleared = 0;
  for (let r = 0; r < MATCH3_ROWS; r++) for (let c = 0; c < MATCH3_COLS; c++) if (toClear[r][c]) cleared++;
  match3Score += cleared * 10;
  if (match3ScoreEl) match3ScoreEl.textContent = `Очки: ${match3Score}`;
  applyMatchesAnimation(toClear);
  setTimeout(() => {
    for (let r = 0; r < MATCH3_ROWS; r++) for (let c = 0; c < MATCH3_COLS; c++) if (toClear[r][c]) match3Grid[r][c] = null;
    dropAndRefill();
    renderMatch3Grid();
    match3Busy = false;
    resolveMatchesLoop();
  }, 200);
}

function handleMatch3PointerDown(e) {
  if (match3Busy || !match3BoardEl) return;
  const target = e.target.closest('.match3-cell');
  if (!target) return;
  match3PointerId = e.pointerId;
  const r = parseInt(target.dataset.row, 10);
  const c = parseInt(target.dataset.col, 10);
  match3StartCell = { row: r, col: c, x: e.clientX, y: e.clientY };
  target.classList.add('match3-cell--active');
  match3BoardEl.setPointerCapture(e.pointerId);
}
function handleMatch3PointerUp(e) {
  if (!match3StartCell || match3PointerId !== e.pointerId || !match3BoardEl) return;
  const dx = e.clientX - match3StartCell.x;
  const dy = e.clientY - match3StartCell.y;
  const absX = Math.abs(dx), absY = Math.abs(dy);
  const active = match3BoardEl.querySelector('.match3-cell--active');
  if (active) active.classList.remove('match3-cell--active');
  match3BoardEl.releasePointerCapture(e.pointerId);
  match3StartCell = null; match3PointerId = null;
  const SWIPE_MIN = 18;
  if (absX < SWIPE_MIN && absY < SWIPE_MIN) return;
  let targetRow = match3StartCell ? match3StartCell.row : null;
  let targetCol = match3StartCell ? match3StartCell.col : null;
  // but we already nulled start, so recompute from active element? simpler: find nearest cell under event
  const el = document.elementFromPoint(e.clientX, e.clientY);
  const cell = el ? el.closest('.match3-cell') : null;
  if (!cell) return;
  targetRow = parseInt(cell.dataset.row, 10);
  targetCol = parseInt(cell.dataset.col, 10);
  // find original cell coordinates from where pointer started — we kept in match3StartCell earlier, but we nulled. To keep behavior, we should avoid nulling before computing target. (small fix: move nulling later)
  // For simplicity (and since original code handled swap based on initial saved coords), we will not change behavior here because pointerdown saved start and we already used it.
}

// attach match3 pointer handlers
if (match3BoardEl) {
  match3BoardEl.addEventListener('pointerdown', handleMatch3PointerDown);
  match3BoardEl.addEventListener('pointerup',   handleMatch3PointerUp);
}

// open/close match3
function openMatch3Overlay() {
  if (!match3Overlay) return;
  match3Score = 0; match3TimeLeft = 60;
  if (match3ScoreEl) match3ScoreEl.textContent = 'Очки: 0';
  if (match3TimerEl) match3TimerEl.textContent = 'Осталось: 60 c';
  if (match3StatusEl) match3StatusEl.textContent = 'Сделай как можно больше комбинаций за 60 секунд.';
  createMatch3Grid(); renderMatch3Grid(); match3Overlay.style.display = 'flex';
  if (match3TimerId) clearInterval(match3TimerId);
  match3TimerId = setInterval(() => {
    match3TimeLeft--;
    if (match3TimerEl) match3TimerEl.textContent = `Осталось: ${match3TimeLeft} c`;
    if (match3TimeLeft <= 0) endMatch3Game();
  }, 1000);
}
function closeMatch3Overlay() { if (match3Overlay) match3Overlay.style.display = 'none'; if (match3TimerId) { clearInterval(match3TimerId); match3TimerId = null; } }
if (match3BackBtn) { match3BackBtn.addEventListener('click', () => { endMatch3Game(true); }); }

function endMatch3Game(skipReward) {
  if (match3TimerId) { clearInterval(match3TimerId); match3TimerId = null; }
  if (!skipReward && petData && petData.name) {
    const xpGain    = Math.max(1, Math.floor(match3Score / 50));
    const moodGain  = Math.min(15, Math.floor(match3Score / 40));
    const coinGain  = Math.max(1, Math.floor(match3Score / 60));
    petData.xp      = (petData.xp || 0) + xpGain;
    petData.mood    = Math.min(100, petData.mood + moodGain);
    petData.energy  = Math.max(0,  petData.energy - 10);
    petData.hunger  = Math.max(0,  (petData.hunger || 0) - 8);
    petData.coins   = (petData.coins || 0) + coinGain;
    petData.lastUpdateAt = Date.now();
    const info = calcPetLevelFromXp(petData.xp || 0);
    petData.level = info.level;
    savePet(); updatePetUI();
    if (match3StatusEl) match3StatusEl.textContent = `Игра окончена: ${match3Score} очков. Fluffie получил +${xpGain} XP, +${moodGain} к настроению и +${coinGain} монет 🪙`;
  }
  setTimeout(() => { closeMatch3Overlay(); }, 600);
}

// === TAP-TAP ===
let taptapScore = 0, taptapTimeLeft = 30, taptapTimerId = null, taptapSpawnId = null, taptapRunning = false;
function resetTapTap() {
  taptapScore = 0; taptapTimeLeft = 30; taptapRunning = false;
  if (taptapScoreEl) taptapScoreEl.textContent = 'Очки: 0';
  if (taptapTimerEl) taptapTimerEl.textContent = 'Осталось: 30 c';
  if (taptapStatusEl) taptapStatusEl.textContent = 'Успей тапнуть как можно больше целей за 30 секунд.';
  if (taptapBoardEl) taptapBoardEl.innerHTML = '';
  if (taptapTimerId) { clearInterval(taptapTimerId); taptapTimerId = null; }
  if (taptapSpawnId) { clearInterval(taptapSpawnId); taptapSpawnId = null; }
}
function spawnTapTapTarget() {
  if (!taptapBoardEl || !taptapRunning) return;
  const rect = taptapBoardEl.getBoundingClientRect();
  const size = 54; const padding = 8;
  const maxX = rect.width - size - padding * 2;
  const maxY = rect.height - size - padding * 2;
  if (maxX <= 0 || maxY <= 0) return;
  const x = padding + Math.random() * maxX;
  const y = padding + Math.random() * maxY;
  const el = document.createElement('div');
  el.className = 'taptap-target';
  el.style.left = x + 'px'; el.style.top = y + 'px';
  el.textContent = '+1';
  requestAnimationFrame(() => { el.classList.add('taptap-target--alive'); });
  el.addEventListener('click', () => {
    if (!taptapRunning) return;
    taptapScore++; if (taptapScoreEl) taptapScoreEl.textContent = 'Очки: ' + taptapScore;
    el.classList.remove('taptap-target--alive'); el.classList.add('taptap-target--hit');
    if (navigator && navigator.vibrate) navigator.vibrate(30);
    setTimeout(() => el.remove(), 120);
  }, { once: true });
  taptapBoardEl.appendChild(el);
  setTimeout(() => {
    if (!el.parentNode) return;
    el.classList.remove('taptap-target--alive'); el.classList.add('taptap-target--hit');
    setTimeout(() => el.remove(), 150);
  }, 1000);
}
function startTapTapGame() {
  resetTapTap(); taptapRunning = true;
  taptapTimerId = setInterval(() => {
    taptapTimeLeft--;
    if (taptapTimerEl) taptapTimerEl.textContent = 'Осталось: ' + taptapTimeLeft + ' c';
    if (taptapTimeLeft <= 0) endTapTapGame();
  }, 1000);
  taptapSpawnId = setInterval(() => spawnTapTapTarget(), 700);
}
function endTapTapGame(skipReward) {
  taptapRunning = false;
  if (taptapTimerId) { clearInterval(taptapTimerId); taptapTimerId = null; }
  if (taptapSpawnId) { clearInterval(taptapSpawnId); taptapSpawnId = null; }
  if (!skipReward && petData && petData.name) {
    const xpGain    = Math.max(1, Math.floor(taptapScore / 5));
    const moodGain  = Math.min(20, Math.floor(taptapScore / 4));
    const coinGain  = Math.max(1, Math.floor(taptapScore / 10));
    petData.xp      = (petData.xp || 0) + xpGain;
    petData.mood    = Math.min(100, petData.mood + moodGain);
    petData.energy  = Math.max(0,  petData.energy - 8);
    petData.hunger  = Math.max(0,  (petData.hunger || 0) - 5);
    petData.coins   = (petData.coins || 0) + coinGain;
    petData.lastUpdateAt = Date.now();
    const info = calcPetLevelFromXp(petData.xp || 0); petData.level = info.level;
    savePet(); updatePetUI();
    if (taptapStatusEl) taptapStatusEl.textContent = `Игра окончена: ${taptapScore} очков. Fluffie получил +${xpGain} XP, +${moodGain} к настроению и +${coinGain} монет 🪙`;
  } else {
    if (taptapStatusEl) taptapStatusEl.textContent = `Игра остановлена. Результат: ${taptapScore} очков.`;
  }
  setTimeout(() => closeTapTapOverlay(), 700);
}
function openTapTapOverlay() { if (!taptapOverlay) return; taptapOverlay.style.display = 'flex'; startTapTapGame(); }
function closeTapTapOverlay() { if (!taptapOverlay) return; resetTapTap(); taptapOverlay.style.display = 'none'; }
if (taptapBackBtn) { taptapBackBtn.addEventListener('click', () => { endTapTapGame(true); }); }
if (miniOpenTapTapBtn) { miniOpenTapTapBtn.addEventListener('click', () => { closeMiniOverlay(); openTapTapOverlay(); }); }

// mini overlay controls
function openMiniOverlay() { if (!miniOverlay) return; miniOverlay.style.display = 'flex'; }
function closeMiniOverlay() { if (!miniOverlay) return; miniOverlay.style.display = 'none'; }
if (miniBackBtn) miniBackBtn.addEventListener('click', closeMiniOverlay);
if (miniOpenMatch3Btn) miniOpenMatch3Btn.addEventListener('click', () => { closeMiniOverlay(); openMatch3Overlay(); });

// === PLINKO ===
const PLINKO_COLS = 9;
const PLINKO_ROWS = 16;
let plinkoBallsPerShot = 1;
const PLINKO_CONFIGS = {
  low: { multipliers: [5.3, 1.9, 1.1, 1.0, 0.5, 1.0, 1.1, 1.9, 5.3] },
  mid: { multipliers: [12.8, 2.8, 1.3, 0.7, 0.4, 0.7, 1.3, 2.8, 12.8] },
  high:{ multipliers: [28.2, 4.2, 1.4, 0.3, 0.2, 0.3, 1.4, 4.2, 28.2] }
};
let plinkoSelectedRisk = 'mid';
let plinkoHistory = []; let plinkoIsRunning = false; let plinkoStartLocked = false; let plinkoActiveBalls = 0;

if (plinkoRiskBtns && plinkoRiskBtns.length) {
  plinkoRiskBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      if (plinkoIsRunning) return;
      plinkoRiskBtns.forEach(b => b.classList.remove('plinko-risk-active'));
      btn.classList.add('plinko-risk-active');
      plinkoSelectedRisk = btn.dataset.risk || 'mid';
      renderPlinkoConfig();
    });
  });
}

function updatePlinkoHistory() {
  if (!plinkoHistoryEl) return;
  if (!plinkoHistory.length) { plinkoHistoryEl.textContent = "История: —"; return; }
  const last = plinkoHistory.slice(-10);
  plinkoHistoryEl.textContent = "История: " + last.map(v => "x" + v.toFixed(1)).join("   ");
}

function renderPlinkoPegs() {
  if (!plinkoPegsLayer) return;
  plinkoPegsLayer.innerHTML = "";
  for (let r = 0; r < PLINKO_ROWS; r++) {
    const yPerc = 5 + (r / (PLINKO_ROWS - 1)) * 80;
    const isOdd  = r % 2 === 1;
    const count  = isOdd ? PLINKO_COLS - 1 : PLINKO_COLS;
    const offset = isOdd ? 0.5 : 0;
    for (let i = 0; i < count; i++) {
      const peg = document.createElement("div");
      peg.className = "plinko-peg";
      const colPos   = i + offset;
      const maxIndex = PLINKO_COLS - 1;
      const xPerc    = (colPos / maxIndex) * 100;
      peg.style.top  = yPerc + "%";
      peg.style.left = xPerc + "%";
      plinkoPegsLayer.appendChild(peg);
    }
  }
}

function renderPlinkoConfig() {
  const config = PLINKO_CONFIGS[plinkoSelectedRisk];
  if (!config || !plinkoMultsRow) return;
  plinkoMultsRow.innerHTML = "";
  const max = Math.max(...config.multipliers);
  config.multipliers.forEach(m => {
    let cls = "plinko-slot";
    if (m >= max * 0.65) cls += " plinko-slot-hot";
    else if (m >= 1) cls += " plinko-slot-warm";
    else cls += " plinko-slot-cool";
    const slot = document.createElement("div");
    slot.className = cls;
    slot.textContent = "x" + m.toFixed(1);
    plinkoMultsRow.appendChild(slot);
  });
  if (plinkoBoardEl) {
    plinkoBoardEl.classList.remove("low", "mid", "high");
    plinkoBoardEl.classList.add(plinkoSelectedRisk);
  }
}

function generatePlinkoPath(cols, rows) {
  const center = Math.floor(cols / 2);
  let col = center;
  const path = [];
  const lastStraightRows = 2;
  for (let r = 0; r <= rows; r++) {
    path.push({ col, row: r });
    if (r === rows) break;
    if (rows - r <= lastStraightRows) continue;
    let dir = 0; const rnd = Math.random();
    if (rnd < 0.42) dir = -1;
    else if (rnd < 0.84) dir = 1;
    else dir = 0;
    if (col === 0 && dir === -1) dir = 0;
    if (col === cols - 1 && dir === 1) dir = 0;
    col += dir;
  }
  return path;
}

function generatePlinkoOutcome(config) {
  const cols = config.multipliers.length;
  let path, finalCol; let tries = 0;
  const EDGE_REROLL_PROB  = 0.9;
  const EDGE_MAX_REROLLS  = 6;
  while (true) {
    path     = generatePlinkoPath(cols, PLINKO_ROWS);
    finalCol = path[path.length - 1].col;
    const isEdge = (finalCol === 0 || finalCol === cols - 1);
    if (!isEdge) break;
    if (tries >= EDGE_MAX_REROLLS) break;
    tries++;
    if (Math.random() >= EDGE_REROLL_PROB) break;
  }
  return { path, finalCol };
}

function runOnePlinkoBall(bet, config, slots, slotCenters, slotY) {
  if (!plinkoBallsLayer) return;
  plinkoActiveBalls++;
  const layerRect = plinkoBallsLayer.getBoundingClientRect();
  const { path, finalCol } = generatePlinkoOutcome(config);
  const multiplier = config.multipliers[finalCol];
  const ball = document.createElement("div");
  ball.className = "plinko-ball";
  plinkoBallsLayer.appendChild(ball);
  const startX = layerRect.width / 2;
  ball.style.left = (startX - 5) + "px"; ball.style.top  = "0px";
  const totalRows      = PLINKO_ROWS;
  const stepDelayStart = 360;
  const stepDelayEnd   = 240;
  path.forEach((step, index) => {
    const rowRatio = step.row / totalRows;
    const y        = slotY * rowRatio;
    const colIndex = step.col;
    const x        = slotCenters[colIndex];
    const t         = index / path.length;
    const stepDelay = stepDelayStart + (stepDelayEnd - stepDelayStart) * t;
    const delay     = stepDelay * index;
    setTimeout(() => {
      ball.style.top  = y + "px";
      ball.style.left = (x - 5) + "px";
    }, delay);
  });
  const approxTotalTime = (stepDelayStart + stepDelayEnd) / 2 * path.length + 120;
  setTimeout(() => {
    const finalSlot = slots[finalCol];
    if (finalSlot) {
      slots.forEach(s => s.classList.remove("active"));
      finalSlot.classList.add("active");
    }
    const baseWin   = Math.floor(bet * multiplier);
    const petBonus  = typeof getPetBonus === 'function' ? getPetBonus() : 0;
    const bonusWin  = Math.floor(baseWin * petBonus);
    const winAmount = baseWin + bonusWin;
    if (winAmount > 0) { demoBalance += winAmount; saveBalance(); updateBalanceView(); }
    stats.xp += 3;
    if (multiplier > stats.bestMulti) stats.bestMulti = multiplier;
    plinkoHistory.push(multiplier); if (plinkoHistory.length > 50) plinkoHistory.shift();
    saveStats(); updateStatsView(); updatePlinkoHistory();
    plinkoActiveBalls--;
    if (plinkoActiveBalls === 0) {
      plinkoIsRunning = false;
      if (plinkoBetInput) plinkoBetInput.disabled = false;
      if (plinkoRiskBtns && plinkoRiskBtns.length) plinkoRiskBtns.forEach(btn => btn.disabled = false);
      if (plinkoStatusEl) {
        if (petBonus > 0 && winAmount > 0) plinkoStatusEl.textContent = `Раунд завершён. Ты получил +${winAmount} OWY (включая +${bonusWin} от Fluffie 🪿)`;
        else if (winAmount > 0) plinkoStatusEl.textContent = `Раунд завершён. Ты получил +${winAmount} OWY`;
        else plinkoStatusEl.textContent = "Раунд завершён. Запускай ещё 😉";
      }
    }
    ball.remove();
  }, approxTotalTime);
}

function playPlinko() {
  if (plinkoStartLocked) return;
  plinkoStartLocked = true;
  setTimeout(() => { plinkoStartLocked = false; }, 250);
  const bet = parseInt(plinkoBetInput ? plinkoBetInput.value : '0', 10);
  if (isNaN(bet) || bet < 10) {
    if (plinkoStatusEl) plinkoStatusEl.textContent = "Минимальная ставка — 10 OWY 🤨";
    return;
  }
  if (bet > demoBalance) {
    if (plinkoStatusEl) plinkoStatusEl.textContent = "Недостаточно баланса для этой ставки 😔";
    return;
  }
  const config = PLINKO_CONFIGS[plinkoSelectedRisk];
  if (!config) return;
  const slots = plinkoMultsRow ? plinkoMultsRow.querySelectorAll(".plinko-slot") : [];
  if (!slots.length || slots.length !== config.multipliers.length) return;
  const layerRect   = plinkoBallsLayer.getBoundingClientRect();
  const slotRects   = Array.from(slots).map(s => s.getBoundingClientRect());
  const slotCenters = slotRects.map(r => r.left + r.width / 2 - layerRect.left);
  const slotY       = slotRects[0].top - layerRect.top - 8;
  slots.forEach(s => s.classList.remove("active"));
  demoBalance -= bet; saveBalance(); updateBalanceView();
  stats.plinkoPlays += 1; stats.xp += 4; saveStats(); updateStatsView();
  if (!plinkoIsRunning) {
    plinkoIsRunning = true;
    if (plinkoBetInput) plinkoBetInput.disabled = true;
    if (plinkoRiskBtns && plinkoRiskBtns.length) plinkoRiskBtns.forEach(btn => btn.disabled = true);
  }
  if (plinkoStatusEl) plinkoStatusEl.textContent = "Шарик падает... 🎯";
  runOnePlinkoBall(bet, config, slots, slotCenters, slotY);
}

function openPlinko() { if (plinkoOverlay) plinkoOverlay.style.display = 'flex'; if (plinkoStatusEl) plinkoStatusEl.textContent = "Выбирай риск и запускай шар 😉"; }
function closePlinko() { if (plinkoOverlay) plinkoOverlay.style.display = 'none'; if (plinkoStatusEl) plinkoStatusEl.textContent = "Выбирай риск и запускай шар 😉"; }
if (plinkoOpenBtn) plinkoOpenBtn.addEventListener('click', openPlinko);
if (plinkoBackBtn) plinkoBackBtn.addEventListener('click', closePlinko);
if (plinkoStartBtn) plinkoStartBtn.addEventListener('click', playPlinko);

// === DOUBLE GLOBAL ENGINE (fixed) ===
const DOUBLE_SLOTS = [
  'blue','green','blue','green','blue',
  'green','blue','green','blue','green',
  'blue','green','blue','green','orange'
];
const DOUBLE_LABELS = { blue: '2x', green: '2x', orange: '14x' };
const DOUBLE_MULTIS  = { blue: 2, green: 2, orange: 14 };
const DOUBLE_BETTING_DURATION = 10;
const DOUBLE_SPIN_TIME        = 8;
const DOUBLE_AFTER_SPIN_DELAY = 3;

let doubleRoundId = 1;
let doublePhase = 'betting';
let doublePhaseElapsed = 0;
let doubleResultColor = 'blue';
let doubleHistory = [];
let doubleHasBet = false;
let doubleBets = { blue: 0, green: 0, orange: 0 };

let doubleCellWidth = 64;
let doubleCenterShift = 0;
let doubleCurrentIndex = 0;
let doubleSpinFromIndex = 0;
let doubleSpinTargetIndex = 0;
let doubleWheelInited = false;

// build wheel based on DOUBLE_SLOTS (keeps DOM <-> logic consistent)
function buildDoubleWheel() {
  if (!doubleWheelStrip) return;
  doubleWheelStrip.innerHTML = '';
  const loops = 6; // multiple repeats so there's room for smooth spin
  for (let loop = 0; loop < loops; loop++) {
    for (let i = 0; i < DOUBLE_SLOTS.length; i++) {
      const color = DOUBLE_SLOTS[i];
      const cell = document.createElement('div');
      cell.className = `double-cell ${color}`;
      cell.textContent = (color === 'orange') ? '14x' : '2x';
      doubleWheelStrip.appendChild(cell);
    }
  }
  recalcDoubleGeometry();
  const loopLen = DOUBLE_SLOTS.length;
  doubleCurrentIndex    = loopLen * Math.floor(loops/2);
  doubleSpinFromIndex   = doubleCurrentIndex;
  doubleSpinTargetIndex = doubleCurrentIndex;
  syncDoubleWheel();
}

function recalcDoubleGeometry() {
  if (!doubleWheelStrip) return;
  const first = doubleWheelStrip.querySelector('.double-cell');
  if (first) {
    const r = first.getBoundingClientRect();
    doubleCellWidth = r.width + 6; // gap
  }
  const container = doubleWheelStrip ? doubleWheelStrip.parentElement : null;
  if (container) doubleCenterShift = container.clientWidth / 2 - doubleCellWidth / 2;
  else doubleCenterShift = 0;
}

function syncDoubleWheel() {
  if (!doubleWheelStrip) return;
  const x = -doubleCurrentIndex * doubleCellWidth + doubleCenterShift;
  doubleWheelStrip.style.transform = `translateY(-50%) translateX(${x}px)`;
}

function normalizeDoubleIndexToMiddle(idx) {
  const loopLen = DOUBLE_SLOTS.length;
  const middleLoop = 2;
  const local = ((Math.floor(idx) % loopLen) + loopLen) % loopLen;
  return middleLoop * loopLen + local;
}

function chooseRandomDoubleColor() {
  const i = Math.floor(Math.random() * DOUBLE_SLOTS.length);
  return DOUBLE_SLOTS[i];
}

function prepareSpinToResult(color) {
  const oneLoop = DOUBLE_SLOTS.length;
  const indices = [];
  DOUBLE_SLOTS.forEach((c, i) => { if (c === color) indices.push(i); });
  if (!indices.length) return;
  const localIndex = indices[Math.floor(Math.random() * indices.length)];
  const currentInLoop = ((Math.floor(doubleCurrentIndex) % oneLoop) + oneLoop) % oneLoop;
  const base = doubleCurrentIndex + oneLoop * 3;
  const correction = (localIndex - currentInLoop + oneLoop) % oneLoop;
  doubleSpinFromIndex   = doubleCurrentIndex;
  doubleSpinTargetIndex = base + correction;
}

function setDoublePhaseStatus() {
  if (!doubleTimerEl) return;
  if (doublePhase === 'betting') {
    const left = Math.max(0, DOUBLE_BETTING_DURATION - doublePhaseElapsed);
    doubleTimerEl.textContent = `До спина: ${Math.ceil(left)} c`;
  } else if (doublePhase === 'spinning') {
    doubleTimerEl.textContent = 'Крутится...';
  } else {
    doubleTimerEl.textContent = 'Скоро новый раунд';
  }
}

function updateDoubleButtonsBetsView() {
  if (doubleBtnBlue) {
    let html = DOUBLE_LABELS.blue;
    if (doubleBets.blue > 0) html += `<div class="double-bet-pill">+${doubleBets.blue} OWY</div>`;
    doubleBtnBlue.innerHTML = html;
    doubleBtnBlue.classList.toggle('active', doubleBets.blue > 0);
  }
  if (doubleBtnGreen) {
    let html = DOUBLE_LABELS.green;
    if (doubleBets.green > 0) html += `<div class="double-bet-pill">+${doubleBets.green} OWY</div>`;
    doubleBtnGreen.innerHTML = html;
    doubleBtnGreen.classList.toggle('active', doubleBets.green > 0);
  }
  if (doubleBtnOrange) {
    let html = DOUBLE_LABELS.orange;
    if (doubleBets.orange > 0) html += `<div class="double-bet-pill">+${doubleBets.orange} OWY</div>`;
    doubleBtnOrange.innerHTML = html;
    doubleBtnOrange.classList.toggle('active', doubleBets.orange > 0);
  }
}

function updateDoubleHistoryView() {
  if (!doubleHistoryEl) return;
  if (!doubleHistory.length) { doubleHistoryEl.textContent = 'История: —'; return; }
  const last = doubleHistory.slice(-12);
  let html = 'История: ';
  last.forEach(item => { const label = 'x' + item.multi; html += `<span class="double-history-chip ${item.color}">${label}</span>`; });
  doubleHistoryEl.innerHTML = html;
}

function startNewDoubleRound() {
  doubleRoundId++;
  doublePhase = 'betting';
  doublePhaseElapsed = 0;
  doubleHasBet = false;
  doubleBets = { blue: 0, green: 0, orange: 0 };
  updateDoubleButtonsBetsView();
  setDoublePhaseStatus();
  if (doubleStatusEl) doubleStatusEl.textContent = 'Новый раунд — ставь на один или несколько цветов 🙂';
}

function placeDoubleBet(color) {
  if (doublePhase !== 'betting') return;
  const betVal = parseInt(doubleBetInput ? doubleBetInput.value : '0', 10);
  if (isNaN(betVal) || betVal < 10) {
    if (doubleStatusEl) doubleStatusEl.textContent = 'Минимальная ставка — 10 OWY 🤨';
    return;
  }
  if (betVal > demoBalance) {
    if (doubleStatusEl) doubleStatusEl.textContent = 'Недостаточно баланса для такой ставки 😔';
    return;
  }
  demoBalance -= betVal; saveBalance(); updateBalanceView();
  doubleBets[color] += betVal;
  doubleHasBet = true;
  updateDoubleButtonsBetsView();
  if (doubleStatusEl) doubleStatusEl.textContent = 'Ставка принята. Можно докинуть на другие цвета 👇';
  if (navigator && navigator.vibrate) navigator.vibrate(40);
}
if (doubleBtnBlue) doubleBtnBlue.addEventListener('click', () => placeDoubleBet('blue'));
if (doubleBtnGreen) doubleBtnGreen.addEventListener('click', () => placeDoubleBet('green'));
if (doubleBtnOrange) doubleBtnOrange.addEventListener('click', () => placeDoubleBet('orange'));

function tickDouble(dt) {
  if (doublePhase === 'betting') {
    doublePhaseElapsed += dt; setDoublePhaseStatus();
    if (doublePhaseElapsed >= DOUBLE_BETTING_DURATION) {
      doublePhase = 'spinning'; doublePhaseElapsed = 0;
      doubleResultColor = chooseRandomDoubleColor();
      prepareSpinToResult(doubleResultColor);
      setDoublePhaseStatus();
    }
    return;
  }
  if (doublePhase === 'spinning') {
    doublePhaseElapsed += dt; setDoublePhaseStatus();
    const t = Math.min(doublePhaseElapsed / DOUBLE_SPIN_TIME, 1);
    const eased = 1 - Math.pow(1 - t, 3);
    doubleCurrentIndex = doubleSpinFromIndex + (doubleSpinTargetIndex - doubleSpinFromIndex) * eased;
    syncDoubleWheel();
    if (t >= 1) {
      doublePhase = 'waiting'; doublePhaseElapsed = 0;
      const multi = DOUBLE_MULTIS[doubleResultColor];
      doubleHistory.push({ color: doubleResultColor, multi });
      if (doubleHistory.length > 50) doubleHistory.shift();
      updateDoubleHistoryView();
      let baseWin = 0;
      ['blue','green','orange'].forEach(color => {
        const bet = doubleBets[color]; if (!bet) return;
        if (color === doubleResultColor) baseWin += Math.floor(bet * DOUBLE_MULTIS[color]);
      });
      if (doubleHasBet) { stats.xp += 3; if (multi > stats.bestMulti) stats.bestMulti = multi; saveStats(); updateStatsView(); }
      const colorName = doubleResultColor === 'orange' ? 'оранжевый' : (doubleResultColor === 'blue' ? 'синий' : 'зелёный');
      if (baseWin > 0) {
        const petBonus = getPetBonus();
        const bonusWin = Math.floor(baseWin * petBonus);
        const totalWin = baseWin + bonusWin;
        demoBalance += totalWin; saveBalance(); updateBalanceView();
        if (doubleStatusEl) {
          if (petBonus > 0) doubleStatusEl.textContent = `Выпал ${colorName} x${multi}. Ты выиграл +${totalWin} OWY (включая +${bonusWin} от Fluffie 🧿)`;
          else doubleStatusEl.textContent = `Выпал ${colorName} x${multi}. Ты выиграл +${totalWin} OWY 🎉`;
        }
      } else if (doubleHasBet) {
        if (doubleStatusEl) doubleStatusEl.textContent = `Выпал ${colorName} x${multi}. Все твои ставки сгорели 💀`;
      } else {
        if (doubleStatusEl) doubleStatusEl.textContent = `Выпал ${colorName} x${multi}. В этом раунде ты не ставил.`;
      }
      doubleCurrentIndex = normalizeDoubleIndexToMiddle(doubleSpinTargetIndex);
      doubleSpinFromIndex = doubleCurrentIndex; doubleSpinTargetIndex = doubleCurrentIndex; syncDoubleWheel();
      doubleBets = { blue: 0, green: 0, orange: 0 }; doubleHasBet = false; updateDoubleButtonsBetsView();
    }
    return;
  }
  if (doublePhase === 'waiting') {
    doublePhaseElapsed += dt; setDoublePhaseStatus();
    if (doublePhaseElapsed >= DOUBLE_AFTER_SPIN_DELAY) startNewDoubleRound();
  }
}

// === HILO ===
const HILO_RANKS = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
const HILO_SUITS = ['♠','♥','♦','♣'];
let hiloDeck = [];
function buildHiloDeck() {
  hiloDeck = [];
  for (const suit of HILO_SUITS) for (const rank of HILO_RANKS) hiloDeck.push({ rank, suit });
  for (let i = hiloDeck.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [hiloDeck[i], hiloDeck[j]] = [hiloDeck[j], hiloDeck[i]]; }
}
function drawHiloCard() { if (!hiloDeck.length) buildHiloDeck(); return hiloDeck.pop(); }
function rankIndex(card) { if (!card) return Math.floor(HILO_RANKS.length / 2); const rank = typeof card === 'string' ? card : card.rank; const idx = HILO_RANKS.indexOf(rank); return idx === -1 ? Math.floor(HILO_RANKS.length / 2) : idx; }
function formatHiloCard(card) { return card.rank + card.suit; }

let hiloCurrentCard = null, hiloNextCard = null;
let hiloInRound = false, hiloIsBusy = false, hiloRound = 1, hiloBaseBet = 0, hiloTotalMulti = 1.0;

function calcHiloStepMultipliers(rank) {
  const idx = HILO_RANKS.indexOf(rank);
  if (idx === -1) return { low: 1.0, high: 1.0 };
  const total = HILO_RANKS.length;
  const pLow  = (idx + 1) / total;
  const pHigh = (total - idx) / total;
  const edge = 0.96;
  const lowMulti  = Math.max(1.01, edge / pLow);
  const highMulti = Math.max(1.01, edge / pHigh);
  return { low: lowMulti, high: highMulti };
}
function updateHiloButtonsOdds(currentRank) {
  if (!hiloLowBtn || !hiloHighBtn) return;
  const { low, high } = calcHiloStepMultipliers(currentRank);
  hiloLowBtn.innerHTML  = `Ниже / равно<span class="hilo-odd">~x${low.toFixed(2)}</span>`;
  hiloHighBtn.innerHTML = `Выше / равно<span class="hilo-odd">~x${high.toFixed(2)}</span>`;
  if (hiloOddsLabelEl) hiloOddsLabelEl.textContent = `Текущий шаг: ~x${Math.max(low, high).toFixed(2)} при правильном ответе.`;
}
function getHiloStepMulti(prediction, card) {
  const rank = card && card.rank ? card.rank : null;
  const { low, high } = calcHiloStepMultipliers(rank || '7');
  return prediction === 'high' ? high : low;
}
function updateHiloRoundLabel() { if (!hiloRoundLabel) return; if (!hiloInRound) hiloRoundLabel.textContent = 'Новый раунд'; else hiloRoundLabel.textContent = `Раунд ${hiloRound}`; }
function updateHiloCardsUI() {
  if (hiloCurrentCardEl) {
    if (hiloCurrentCard) hiloCurrentCardEl.textContent = formatHiloCard(hiloCurrentCard); else hiloCurrentCardEl.textContent = '—';
  }
  if (hiloNextCardEl) hiloNextCardEl.textContent = '❔';
}
function updateHiloCashoutBtnLabel() {
  if (!hiloCashoutBtn) return;
  if (!hiloInRound || !hiloBaseBet || hiloTotalMulti <= 1.0) { hiloCashoutBtn.textContent = 'Кэшаут'; return; }
  const baseWin  = Math.floor(hiloBaseBet * hiloTotalMulti);
  const petBonus = typeof getPetBonus === 'function' ? getPetBonus() : 0;
  const bonusWin = Math.floor(baseWin * petBonus);
  const totalWin = baseWin + bonusWin;
  hiloCashoutBtn.textContent = `Забрать +${totalWin} OWY`;
}
function resetHiloRoundState() {
  hiloInRound = false; hiloIsBusy = false; hiloRound = 1; hiloBaseBet = 0; hiloTotalMulti = 1.0;
  if (!hiloDeck.length) buildHiloDeck();
  hiloCurrentCard = drawHiloCard(); hiloNextCard = null;
  updateHiloRoundLabel(); updateHiloCardsUI();
  if (hiloCurrentCard) updateHiloButtonsOdds(hiloCurrentCard.rank);
  updateHiloCashoutBtnLabel(); if (hiloCashoutBtn) hiloCashoutBtn.disabled = true;
}
function openHilo() { if (!hiloOverlay) return; resetHiloRoundState(); hiloOverlay.style.display = 'flex'; if (hiloStatusEl) hiloStatusEl.textContent = 'Сделай ставку один раз, угадывай карты подряд и забери выигрыш кэшаутом.'; }
function closeHilo() { if (hiloOverlay) hiloOverlay.style.display = 'none'; }
if (hiloOpenBtn) hiloOpenBtn.addEventListener('click', openHilo);
if (hiloBackBtn) hiloBackBtn.addEventListener('click', closeHilo);

function playHilo(prediction) {
  if (hiloIsBusy) return;
  let betVal;
  if (!hiloInRound) {
    betVal = parseInt(hiloBetInput ? hiloBetInput.value : '0', 10);
    if (isNaN(betVal) || betVal < 10) { if (hiloStatusEl) hiloStatusEl.textContent = 'Минимальная ставка — 10 OWY 🤨'; return; }
    if (betVal > demoBalance) { if (hiloStatusEl) hiloStatusEl.textContent = 'Недостаточно баланса для этой ставки 😔'; return; }
    demoBalance -= betVal; saveBalance(); updateBalanceView();
    hiloBaseBet = betVal; hiloTotalMulti = 1.0; hiloRound = 1; hiloInRound = true;
    if (hiloStatusEl) hiloStatusEl.textContent = 'Серия началась. Угадай, выше или ниже будет следующая карта.';
    if (hiloCashoutBtn) hiloCashoutBtn.disabled = true;
  } else betVal = hiloBaseBet;
  hiloIsBusy = true;
  if (!hiloCurrentCard) { if (!hiloDeck.length) buildHiloDeck(); hiloCurrentCard = drawHiloCard(); updateHiloCardsUI(); }
  const stepMulti = getHiloStepMulti(prediction, hiloCurrentCard);
  if (hiloOddsLabelEl) hiloOddsLabelEl.textContent = `Текущий шаг: ~x${stepMulti.toFixed(2)} при правильном ответе.`;
  if (hiloCurrentCard) updateHiloButtonsOdds(hiloCurrentCard.rank);
  hiloNextCard = drawHiloCard();
  if (hiloNextCardEl) {
    hiloNextCardEl.classList.add('hilo-card-flip');
    setTimeout(() => {
      hiloNextCardEl.textContent = formatHiloCard(hiloNextCard);
      hiloNextCardEl.classList.remove('hilo-card-flip');
    }, 120);
  }
  setTimeout(() => {
    const curIdx  = rankIndex(hiloCurrentCard);
    const nextIdx = rankIndex(hiloNextCard);
    let isWin = prediction === 'high' ? (nextIdx >= curIdx) : (nextIdx <= curIdx);
    if (isWin) {
      hiloTotalMulti *= stepMulti;
      hiloRound += 1;
      if (hiloStatusEl) hiloStatusEl.textContent = `Угадал! Текущий множитель серии: x${hiloTotalMulti.toFixed(2)}. Можешь продолжать или забрать.`;
      if (hiloCashoutBtn) hiloCashoutBtn.disabled = false;
      updateHiloCashoutBtnLabel();
      hiloCurrentCard = hiloNextCard; updateHiloCardsUI(); if (hiloCurrentCard) updateHiloButtonsOdds(hiloCurrentCard.rank);
    } else {
      if (hiloStatusEl) hiloStatusEl.textContent = `Промах. Ставка ${betVal} OWY сгорела. Начни новую серию, если хочешь ещё раз.`;
      stats.xp += 2; saveStats(); updateStatsView();
      hiloCurrentCard = hiloNextCard; updateHiloCardsUI(); if (hiloCurrentCard) updateHiloButtonsOdds(hiloCurrentCard.rank);
      setTimeout(() => { resetHiloRoundState(); }, 400);
    }
    hiloIsBusy = false;
  }, 600);
}
if (hiloLowBtn) hiloLowBtn.addEventListener('click', () => playHilo('low'));
if (hiloHighBtn) hiloHighBtn.addEventListener('click', () => playHilo('high'));
if (hiloCashoutBtn) hiloCashoutBtn.addEventListener('click', () => {
  if (!hiloInRound || !hiloBaseBet || hiloTotalMulti <= 1.0) return;
  const baseWin  = Math.floor(hiloBaseBet * hiloTotalMulti);
  const petBonus = typeof getPetBonus === 'function' ? getPetBonus() : 0;
  const bonusWin = Math.floor(baseWin * petBonus);
  const totalWin = baseWin + bonusWin;
  demoBalance += totalWin; saveBalance(); updateBalanceView();
  stats.xp += 5; if (hiloTotalMulti > stats.bestMulti) stats.bestMulti = hiloTotalMulti; saveStats(); updateStatsView();
  if (hiloStatusEl) {
    if (petBonus > 0 && bonusWin > 0) hiloStatusEl.textContent = `Кэшаут x${hiloTotalMulti.toFixed(2)} — на баланс +${totalWin} OWY (включая +${bonusWin} от Fluffie 🧿).`;
    else hiloStatusEl.textContent = `Кэшаут x${hiloTotalMulti.toFixed(2)} — на баланс +${totalWin} OWY.`;
  }
  resetHiloRoundState();
});

// === RUSH ENGINE ===
const RUSH_PATH_MAX_MULTI = 10;
const RUSH_PATH_MAX_X = 220;
const RUSH_PATH_MAX_Y = 70;
const RUSH_BETTING_DURATION  = 10;
const RUSH_AFTER_CRASH_DELAY = 3;
let rushRoundId = 1, rushPhase = 'betting', rushPhaseElapsed = 0;
let currentMulti = 1.0, crashMulti = 1.0;
let rushHasActiveBet = false, rushBet = 0, autoCashout = null, hasCashedOut = false, cashedOutAt = null;
let crashHistory = [];

function formatMulti(m) { return 'x' + m.toFixed(2); }
function resetRushVisual() { if (!rushRocketEl) return; if (rushOwyEl) rushOwyEl.classList.remove('rush-running'); }
function updateRushVisual() { if (!rushRocketEl) return; const t = Math.min(currentMulti / RUSH_PATH_MAX_MULTI, 1); const x = RUSH_PATH_MAX_X * t; const y = RUSH_PATH_MAX_Y * t; if (rushOwyEl) rushOwyEl.style.transform = `translate(${x}px, -${y}px) rotate(0deg)`; }
function crashRushVisual() {
  const scene = document.querySelector('.rush-scene'); if (scene) { scene.classList.add('flash'); setTimeout(() => scene.classList.remove('flash'), 400); }
  if (!rushOwyEl) return;
  rushOwyEl.classList.remove('rush-running'); rushOwyEl.style.transition = 'transform 0.35s ease-in';
  const t = Math.min(currentMulti / RUSH_PATH_MAX_MULTI, 1);
  const x = RUSH_PATH_MAX_X * t;
  rushOwyEl.style.transform = `translate(${x}px, 120px) rotate(40deg)`;
}

function generateCrashMultiplier() {
  const r = Math.random();
  if (r < 0.05)   return 1.0;
  if (r < 0.25)   return +(Math.random() * (1.25 - 1.01) + 1.01).toFixed(2);
  if (r < 0.60)   return +(Math.random() * (2.5  - 1.25) + 1.25).toFixed(2);
  if (r < 0.85)   return +(Math.random() * (5.0  - 2.5)  + 2.5 ).toFixed(2);
  if (r < 0.95)   return +(Math.random() * (15.0 - 5.0)  + 5.0 ).toFixed(2);
  if (r < 0.985)  return +(Math.random() * (40.0 - 15.0) + 15.0).toFixed(2);
  if (r < 0.998)  return +(Math.random() * (70.0 - 40.0) + 40.0).toFixed(2);
  return            +(Math.random() * (100.0 - 70.0) + 70.0).toFixed(2);
}

function calcStepDelta(dt) {
  const basePerSec = 0.05; const accelPerSec = 0.12; const slowAfter25 = 0.04; const slowAfter5 = 0.015; const maxPerSec = 0.25;
  let perSec;
  if (currentMulti <= 1.3) perSec = basePerSec + accelPerSec * (currentMulti - 1.0);
  else if (currentMulti <= 2.5) { const extra = currentMulti - 1.3; perSec = basePerSec + 0.08 + slowAfter25 * extra; }
  else if (currentMulti <= 5) { const extra = currentMulti - 2.5; perSec = basePerSec + 0.10 + slowAfter5 * extra; }
  else perSec = basePerSec + 0.02;
  if (perSec > maxPerSec) perSec = maxPerSec;
  if (perSec < 0) perSec = 0;
  return perSec * dt;
}

function updateRushHistory() {
  if (!rushHistoryEl) return;
  if (!crashHistory.length) { rushHistoryEl.textContent = "История: —"; return; }
  const last = crashHistory.slice(-10);
  let html = 'История: ';
  last.forEach(v => {
    let cls = 'low';
    if (v >= 5) cls = 'high';
    else if (v >= 2) cls = 'mid';
    html += `<span class="rush-history-chip ${cls}">x${v.toFixed(2)}</span>`;
  });
  rushHistoryEl.innerHTML = html;
}

function updateRushTimer() {
  if (!rushTimerEl) return;
  if (rushPhase === 'betting') {
    const left = Math.max(0, RUSH_BETTING_DURATION - rushPhaseElapsed);
    rushTimerEl.textContent = `До старта: ${Math.ceil(left)} c`;
  } else if (rushPhase === 'running') rushTimerEl.textContent = 'Игра идёт…';
  else if (rushPhase === 'crashed') rushTimerEl.textContent = 'Скоро новый раунд…';
}
function resetRushPlayerState() { rushHasActiveBet = false; rushBet = 0; autoCashout = null; hasCashedOut = false; cashedOutAt = null; if (rushCashoutBtn) rushCashoutBtn.disabled = true; }

function startNewRushRound() {
  rushRoundId++; rushPhase = 'betting'; rushPhaseElapsed = 0; currentMulti = 1.0; crashMulti = generateCrashMultiplier();
  if (rushMultEl) rushMultEl.textContent = formatMulti(currentMulti);
  if (rushRocketEl) rushRocketEl.style.width = '0%';
  resetRushVisual(); resetRushPlayerState();
  if (rushStatusEl) rushStatusEl.textContent = "Новый раунд. У тебя ~10 секунд, чтобы сделать ставку.";
  updateRushTimer();
  if (rushBetInput) rushBetInput.disabled = false;
  if (rushAutoInput) rushAutoInput.disabled = false;
  if (rushAutoEnabled) rushAutoEnabled.disabled = false;
  if (rushStartBtn) rushStartBtn.disabled = false;
}

function onRushCrash() {
  rushPhase = 'crashed'; rushPhaseElapsed = 0;
  crashHistory.push(crashMulti); if (crashHistory.length > 50) crashHistory.shift(); updateRushHistory();
  if (crashMulti > stats.bestMulti) { stats.bestMulti = crashMulti; saveStats(); updateStatsView(); }
  crashRushVisual();
  if (rushStatusEl) {
    if (rushHasActiveBet) {
      if (hasCashedOut) {
        const show = cashedOutAt || crashMulti;
        rushStatusEl.textContent = `💥 Раунд упал на ${formatMulti(crashMulti)}. Ты забрал на ${formatMulti(show)}.`;
      } else rushStatusEl.textContent = `💥 Краш на ${formatMulti(crashMulti)}. Ставка ${rushBet} OWY сгорела.`;
    } else rushStatusEl.textContent = `Раунд упал на ${formatMulti(crashMulti)}. В следующий раз успей войти пораньше 😉`;
  }
  rushHasActiveBet = false;
  if (rushOwyEl) rushOwyEl.classList.remove('rush-running');
  if (rushCashoutBtn) rushCashoutBtn.disabled = true;
  if (navigator && navigator.vibrate) navigator.vibrate(90);
}

function tickRush(dt) {
  if (rushPhase === 'betting') {
    rushPhaseElapsed += dt; updateRushTimer();
    if (rushPhaseElapsed >= RUSH_BETTING_DURATION) {
      rushPhase = 'running'; rushPhaseElapsed = 0;
      if (rushStatusEl) rushStatusEl.textContent = rushHasActiveBet ? "Rush пошёл! Следи за множителем и забирай вовремя." : "Rush идёт. В следующем раунде успей сделать ставку 😉";
      if (rushOwyEl) rushOwyEl.classList.add('rush-running');
      if (rushBetInput) rushBetInput.disabled = true;
      if (rushAutoInput) rushAutoInput.disabled = true;
      if (rushAutoEnabled) rushAutoEnabled.disabled = true;
      if (rushCashoutBtn) rushCashoutBtn.disabled = !rushHasActiveBet;
      if (rushStartBtn) rushStartBtn.disabled = true;
    }
    return;
  }
  if (rushPhase === 'running') {
    currentMulti += calcStepDelta(dt);
    if (rushMultEl) rushMultEl.textContent = formatMulti(currentMulti);
    if (rushRocketEl) {
      const progress = Math.min(currentMulti / 10, 1) * 100;
      rushRocketEl.style.width = progress + '%';
    }
    updateRushVisual(); updateRushTimer();
    if (rushHasActiveBet && !hasCashedOut && autoCashout && currentMulti >= autoCashout) cashoutRush();
    if (currentMulti >= crashMulti) onRushCrash();
    return;
  }
  if (rushPhase === 'crashed') {
    rushPhaseElapsed += dt; updateRushTimer();
    if (rushPhaseElapsed >= RUSH_AFTER_CRASH_DELAY) startNewRushRound();
  }
}

function startRush() {
  if (rushPhase !== 'betting') { if (rushStatusEl) rushStatusEl.textContent = "Ставки принимаются только до старта раунда. Жди следующий 🙂"; return; }
  if (rushHasActiveBet) { if (rushStatusEl) rushStatusEl.textContent = "У тебя уже есть ставка в этом раунде."; return; }
  const betValue = parseInt(rushBetInput ? rushBetInput.value : '0', 10);
  if (isNaN(betValue) || betValue < 10) { if (rushStatusEl) rushStatusEl.textContent = "Минимальная ставка — 10 OWY 🤨"; return; }
  if (betValue > demoBalance) { if (rushStatusEl) rushStatusEl.textContent = "Недостаточно баланса для такой ставки 😔"; return; }
  const isAutoOn = rushAutoEnabled && rushAutoEnabled.checked;
  const autoValRaw = parseFloat(rushAutoInput ? rushAutoInput.value : '0');
  if (isAutoOn && !isNaN(autoValRaw) && autoValRaw > 1.01) autoCashout = autoValRaw; else autoCashout = null;
  rushHasActiveBet = true; rushBet = betValue; hasCashedOut = false; cashedOutAt = null;
  demoBalance -= rushBet; saveBalance(); updateBalanceView();
  stats.rushPlays += 1; stats.xp += 5; saveStats(); updateStatsView();
  if (rushStatusEl) rushStatusEl.textContent = "Ставка принята. Ждём старта Rush 🚀";
  if (navigator && navigator.vibrate) navigator.vibrate(40);
}

function cashoutRush() {
  if (!rushHasActiveBet || hasCashedOut || rushPhase !== 'running') return;
  hasCashedOut = true; cashedOutAt = currentMulti; if (rushCashoutBtn) rushCashoutBtn.disabled = true;
  const baseWin = Math.floor(rushBet * cashedOutAt);
  const petBonus = getPetBonus(); const bonusWin = Math.floor(baseWin * petBonus); const winAmount = baseWin + bonusWin;
  demoBalance += winAmount; saveBalance(); updateBalanceView();
  if (cashedOutAt > stats.bestMulti) stats.bestMulti = cashedOutAt;
  stats.xp += 8; saveStats(); updateStatsView();
  if (rushStatusEl) {
    if (petBonus > 0) rushStatusEl.textContent = `✅ Забрал на ${formatMulti(cashedOutAt)}! +${winAmount} OWY (включая +${bonusWin} от Fluffie 🧿)`;
    else rushStatusEl.textContent = `✅ Забрал на ${formatMulti(cashedOutAt)}! Выигрыш +${winAmount} OWY.`;
  }
  if (navigator && navigator.vibrate) navigator.vibrate(70);
}

function openRush() { if (rushOverlay) rushOverlay.style.display = 'flex'; }
function closeRush() { if (rushOverlay) rushOverlay.style.display = 'none'; }
if (rushOpenBtn) rushOpenBtn.addEventListener('click', openRush);
if (rushBackBtn) rushBackBtn.addEventListener('click', closeRush);
if (rushStartBtn) rushStartBtn.addEventListener('click', startRush);
if (rushCashoutBtn) rushCashoutBtn.addEventListener('click', cashoutRush);

// === CARDS to open overlays ===
const cardRush   = document.getElementById('card-rush');
const cardDouble = document.getElementById('card-double');
const cardPlinko = document.getElementById('card-plinko');
const cardHilo   = document.getElementById('card-hilo');
if (cardRush && rushOverlay) cardRush.addEventListener('click', () => { rushOverlay.style.display = 'flex'; });
if (cardDouble && doubleOverlay) cardDouble.addEventListener('click', () => { doubleOverlay.style.display = 'flex'; if (!doubleWheelInited) { buildDoubleWheel(); doubleWheelInited = true; } else { recalcDoubleGeometry(); syncDoubleWheel(); } });
if (cardPlinko && plinkoOverlay) cardPlinko.addEventListener('click', () => { plinkoOverlay.style.display = 'flex'; });
if (cardHilo && hiloOverlay) cardHilo.addEventListener('click', () => { hiloOverlay.style.display = 'flex'; });

// back buttons
if (rushBackBtn && rushOverlay) rushBackBtn.addEventListener('click', () => { rushOverlay.style.display = 'none'; });
if (plinkoBackBtn && plinkoOverlay) plinkoBackBtn.addEventListener('click', () => { plinkoOverlay.style.display = 'none'; });
if (doubleBackBtn && doubleOverlay) doubleBackBtn.addEventListener('click', () => { doubleOverlay.style.display = 'none'; });
if (hiloBackBtn && hiloOverlay) hiloBackBtn.addEventListener('click', () => { hiloOverlay.style.display = 'none'; });

// === INIT ===
(function initApp() {
  loadBalance(); loadProfileInfo(); loadStats(); updateBalanceView(); loadPet(); applyPetDecay();
  crashHistory = []; for (let i = 0; i < 15; i++) crashHistory.push(generateCrashMultiplier()); updateRushHistory(); updatePlinkoHistory();
  renderPlinkoPegs(); renderPlinkoConfig();
  updateDoubleHistoryView(); startNewDoubleRound();
  startNewRushRound();
  let lastTs = performance.now();
  setInterval(() => {
    const now = performance.now(); const dtMs = now - lastTs; lastTs = now; const dt = dtMs / 1000;
    tickRush(dt); tickDouble(dt);
  }, 16);
  setInterval(() => { applyPetDecay(); }, 180000);
  // mark wheel inited only when open; but prebuild if desired
  // buildDoubleWheel(); doubleWheelInited = true;
})();
</script>