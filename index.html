<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>OWY Play</title>
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    }

    body {
      background: #05060a;
      color: #f5f5f5;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      touch-action: manipulation;
    }

    .app {
      max-width: 420px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      border-left: 1px solid #14151a;
      border-right: 1px solid #14151a;
    }

    /* –í–µ—Ä—Ö–Ω–∏–π –±–∞—Ä */
    .header {
      padding: 14px 18px 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #14151a;
    }

    .logo-wrap {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      font-size: 18px;
    }

    .logo-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #1ddb6f;
      box-shadow: 0 0 12px rgba(29, 219, 111, 0.8);
    }

    .demo-label {
      font-size: 11px;
      color: #888e99;
    }

    .balance {
      text-align: right;
    }

    .balance-label {
      font-size: 11px;
      color: #8c8f9a;
    }

    .balance-value {
      font-size: 16px;
      font-weight: 600;
    }

    /* –∫–æ–Ω—Ç–µ–Ω—Ç –∏ —ç–∫—Ä–∞–Ω—ã */
    .content {
      flex: 1;
      padding: 10px 18px 80px;
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin: 4px 0 8px;
    }

    .cards {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 14px;
    }

    .card {
      border-radius: 16px;
      padding: 12px 14px;
      background: radial-gradient(circle at top left, #182728, #090b0f);
      border: 1px solid rgba(255, 255, 255, 0.02);
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.5);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: #cfd2de;
      white-space: nowrap;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
    }

    .card-sub {
      font-size: 12px;
      color: #9ea2b0;
      margin-top: 2px;
    }

    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
    }

    .btn {
      border: none;
      outline: none;
      padding: 8px 14px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: transform 0.06s ease, box-shadow 0.06s ease, background 0.1s ease,
        opacity 0.08s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #1ddb6f, #16a451);
      color: #05060a;
      box-shadow: 0 6px 16px rgba(29, 219, 111, 0.4);
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 3px 10px rgba(29, 219, 111, 0.3);
    }

    .btn-ghost {
      background: transparent;
      color: #cfd2de;
    }

    .tag-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-left: 10px;
    }

    .tag {
      font-size: 10px;
      padding: 3px 6px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.5);
      color: #9ea2b0;
    }

    /* OWY —Å–æ–≤–µ—Ç –≤–Ω–∏–∑—É –≥–ª–∞–≤–Ω–æ–π */
    .tip-wrap {
      margin-top: 18px;
      padding-top: 8px;
      border-top: 1px solid #14151a;
    }

    .tip-label {
      font-size: 11px;
      color: #8c8f9a;
      margin-bottom: 4px;
    }

    .tip-bubble {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.03);
      font-size: 12px;
      color: #d8dde8;
      min-height: 24px;
    }

    .tip-bubble span:first-child {
      font-size: 16px;
    }

    /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */
    .bottom-nav {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 0;
      width: 100%;
      max-width: 420px;
      padding: 6px 10px 10px;
      background: linear-gradient(to top, #05060a, rgba(5, 6, 10, 0.9), transparent);
    }

    .bottom-nav-inner {
      background: rgba(8, 10, 16, 0.95);
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      display: flex;
      justify-content: space-around;
      padding: 6px 4px;
      backdrop-filter: blur(12px);
    }

    .nav-item {
      flex: 1;
      text-align: center;
      font-size: 11px;
      color: #7f8491;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      cursor: pointer;
      padding: 4px 0;
      border-radius: 12px;
    }

    .nav-item span {
      font-size: 16px;
    }

    .nav-item.active {
      color: #e7fdf0;
      background: rgba(29, 219, 111, 0.08);
    }

    .nav-label {
      font-size: 10px;
    }

    /* --- Rush overlay --- */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(5, 6, 10, 0.96);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 50;
    }

    .overlay-inner {
      width: 100%;
      max-width: 420px;
      padding: 18px 18px 90px;
    }

    .overlay-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .overlay-title {
      font-size: 18px;
      font-weight: 600;
    }

    .rush-multiplier {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .rush-track {
      margin-bottom: 12px;
    }

    .rush-track-line {
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.06);
      overflow: hidden;
      position: relative;
    }

    .rush-rocket {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #1ddb6f, #16a451);
      box-shadow: 0 0 18px rgba(29, 219, 111, 0.8);
      transition: width 0.05s linear;
    }

    .rush-status {
      font-size: 12px;
      color: #9ea2b0;
      margin-bottom: 8px;
      min-height: 30px;
    }

    .rush-history {
      font-size: 11px;
      color: #7f8491;
      margin-bottom: 10px;
      min-height: 14px;
    }

    .rush-controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .rush-input label {
      font-size: 12px;
      color: #9ea2b0;
      display: block;
      margin-bottom: 4px;
    }

    .rush-input input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #20232b;
      background: #080a0f;
      color: #f5f5f5;
      font-size: 14px;
      outline: none;
    }

    .rush-input input:focus {
      border-color: #1ddb6f;
    }

    .rush-auto-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .rush-auto-row input[type='checkbox'] {
      width: 16px;
      height: 16px;
      accent-color: #1ddb6f;
    }

    .rush-buttons {
      display: flex;
      gap: 8px;
    }

    #rush-cashout[disabled] {
      opacity: 0.4;
      cursor: default;
    }

    /* Plinko overlay */
    .plinko-board-wrap {
      margin-top: 6px;
      margin-bottom: 10px;
    }

    .plinko-board {
      position: relative;
      width: 100%;
      height: 260px;
      border-radius: 16px;
      background: radial-gradient(circle at top, #1a2730, #05060a);
      border: 1px solid #14151a;
      overflow: hidden;
    }

    .plinko-peg {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #263544;
    }

    .plinko-slot-labels {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      padding: 4px 4px 6px;
      font-size: 10px;
    }

    .plinko-slot-labels span {
      flex: 1;
      text-align: center;
      border-radius: 6px;
      padding: 2px 0;
      margin: 0 1px;
      background: rgba(0, 0, 0, 0.55);
    }

    .slot-low {
      color: #f2c14f;
    }

    .slot-mid {
      color: #58e07b;
    }

    .slot-high {
      color: #f36f6f;
    }

    .plinko-ball {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #1ddb6f;
      box-shadow: 0 0 10px rgba(29, 219, 111, 0.9);
      transform: translate(-50%, -50%);
    }

    .plinko-controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 10px;
    }

    .plinko-risk-row {
      display: flex;
      gap: 6px;
    }

    .pill-btn {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #273042;
      background: #080a10;
      color: #cfd2de;
      font-size: 11px;
      padding: 6px 0;
      text-align: center;
      cursor: pointer;
    }

    .pill-btn.active {
      border-color: #1ddb6f;
      background: rgba(29, 219, 111, 0.12);
      color: #e7fdf0;
    }

    .plinko-status {
      font-size: 12px;
      color: #9ea2b0;
      min-height: 28px;
    }

    /* –ü—Ä–æ—Ñ–∏–ª—å */
    .profile-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 4px;
      margin-bottom: 14px;
    }

    .profile-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #1ddb6f, #0a1516);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 18px;
    }

    .profile-name {
      font-size: 16px;
      font-weight: 600;
    }

    .profile-username {
      font-size: 12px;
      color: #8c8f9a;
    }

    .profile-balance {
      margin-left: auto;
      text-align: right;
      font-size: 13px;
    }

    .profile-balance .label {
      font-size: 11px;
      color: #8c8f9a;
    }

    .profile-balance .value {
      font-size: 15px;
      font-weight: 600;
    }

    .profile-card {
      margin-top: 8px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(12, 14, 20, 0.95);
      border: 1px solid #14151a;
    }

    .profile-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 13px;
    }

    .profile-row span:first-child {
      color: #8c8f9a;
      font-size: 12px;
    }

    .rank-label {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .rank-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #c0c4d4;
    }

    .rank-bronze {
      background: #c58b55;
    }

    .rank-silver {
      background: #bfc6d6;
    }

    .rank-gold {
      background: #f2c14f;
    }

    .rank-plat {
      background: #74e0ff;
    }

    .rank-legend {
      background: #ff7bd5;
    }

    .profile-note {
      font-size: 11px;
      color: #9ea2b0;
      margin-top: 4px;
      line-height: 1.35;
    }

    .rank-hint {
      font-size: 11px;
      color: #7f8491;
      margin-top: 2px;
    }

    .hint-link {
      text-decoration: underline;
      cursor: pointer;
    }

    .support-card {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(10, 12, 18, 0.95);
      border: 1px solid #14151a;
      font-size: 12px;
      color: #cfd2de;
    }

    .support-card a {
      color: #1ddb6f;
      text-decoration: none;
    }

    .support-card a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="header">
      <div class="logo-wrap">
        <div class="logo">
          <div class="logo-dot"></div>
          <span>OWY Play</span>
        </div>
        <div class="demo-label">Demo —Ä–µ–∂–∏–º ¬∑ –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–µ–Ω–µ–≥</div>
      </div>
      <div class="balance">
        <div class="balance-label">–ë–∞–ª–∞–Ω—Å</div>
        <div class="balance-value" id="header-balance">1 000 OWY</div>
      </div>
    </header>

    <main class="content">
      <!-- –ì–ª–∞–≤–Ω–∞—è -->
      <section id="screen-home" class="screen active">
        <div class="section-title">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Å–µ–π—á–∞—Å</div>

        <div class="cards">
          <!-- Rush -->
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Rush</div>
                <div class="card-sub">–ê–≤—Ç–æ–∫—ç—à-–∞—É—Ç –ø–æ —Å–≤–æ–µ–º—É –º–Ω–æ–∂–∏—Ç–µ–ª—é</div>
              </div>
              <div class="chip">üöÄ x1.0 ‚Äì x50</div>
            </div>
            <div class="card-footer">
              <button class="btn btn-primary" id="rush-open">–ò–≥—Ä–∞—Ç—å Rush</button>
              <div class="tag-row">
                <div class="tag">–±—ã—Å—Ç—Ä–∞—è –∏–≥—Ä–∞</div>
                <div class="tag">—Ä–∏—Å–∫ / –Ω–∞–≥—Ä–∞–¥–∞</div>
              </div>
            </div>
          </div>

          <!-- Plinko -->
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Plinko</div>
                <div class="card-sub">Low / Mid / High —Ä–∏—Å–∫</div>
              </div>
              <div class="chip">üü¢ Plinko</div>
            </div>
            <div class="card-footer">
              <button class="btn btn-primary" id="plinko-open">–ò–≥—Ä–∞—Ç—å Plinko</button>
              <div class="tag-row">
                <div class="tag">–ø–∞–¥–∞—é—â–∏–µ —à–∞—Ä—ã</div>
                <div class="tag">—Ä–∏—Å–∫ / –Ω–∞–≥—Ä–∞–¥–∞</div>
              </div>
            </div>
          </div>
        </div>

        <!-- OWY —Å–æ–≤–µ—Ç —Å–Ω–∏–∑—É -->
        <div class="tip-wrap">
          <div class="tip-label">–û–íY —Å–æ–≤–µ—Ç</div>
          <div class="tip-bubble">
            <span>ü§ñ</span>
            <span id="owy-tip-text">Plinko High —Ä–∏—Å–∫ ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≥–æ—Ç–æ–≤ –∫ –±–æ–ª–∏.</span>
          </div>
        </div>
      </section>

      <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
      <section id="screen-profile" class="screen">
        <div class="profile-header">
          <div class="profile-avatar" id="profile-avatar">OP</div>
          <div>
            <div class="profile-name" id="profile-name">OWY Player</div>
            <div class="profile-username" id="profile-username">@demo</div>
          </div>
          <div class="profile-balance">
            <div class="label">–ë–∞–ª–∞–Ω—Å</div>
            <div class="value" id="profile-balance">1 000 OWY</div>
          </div>
        </div>

        <div class="profile-card">
          <div class="profile-row">
            <span>–†–∞–Ω–≥</span>
            <span class="rank-label">
              <span class="rank-dot" id="rank-dot"></span>
              <span id="rank-name">Bronze</span>
            </span>
          </div>
          <div class="profile-row">
            <span>XP</span>
            <span id="xp-label">0 / 100</span>
          </div>
          <div class="profile-note">
            –ü–æ–ª—É—á–∞–π XP –∑–∞ –∏–≥—Ä—ã –≤ Rush –∏ Plinko. –ß–µ–º –±–æ–ª—å—à–µ –∏–≥—Ä–∞–µ—à—å, —Ç–µ–º –≤—ã—à–µ —Ä–∞–Ω–≥ –∏ —Å—Ç–∞—Ç—É—Å –≤ OWY.
          </div>
          <div class="rank-hint">
            –†–∞–Ω–≥–∏: Bronze ‚Üí Silver ‚Üí Gold ‚Üí Platinum ‚Üí OWY Legend.
            <span class="hint-link" id="rank-hint-link">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</span>
          </div>
        </div>

        <div class="profile-card">
          <div class="profile-row">
            <span>ID –≤ Telegram</span>
            <span id="profile-id">‚Äî</span>
          </div>
          <div class="profile-note">
            –í –±—É–¥—É—â–µ–º –ø—Ä–æ—Ñ–∏–ª—å –±—É–¥–µ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Ç–≤–æ–µ–º—É OWY –∫–æ—à–µ–ª—å–∫—É –∏ —Ä–µ–∞–ª—å–Ω–æ–º—É —Ç–æ–∫–µ–Ω—É OWY Coin.
          </div>
        </div>

        <div class="support-card">
          –ù–∞—à—ë–ª –±–∞–≥, –∏–¥–µ—é –∏–ª–∏ —Å—Ç—Ä–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏–≥—Ä? –ü–∏—à–∏ –ø—Ä—è–º–æ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É:<br />
          <a href="https://t.me/arhipovvv" target="_blank">@arhipovvv</a>
        </div>
      </section>
    </main>

    <!-- –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é -->
    <nav class="bottom-nav">
      <div class="bottom-nav-inner">
        <div class="nav-item active" data-screen="home">
          <span>üè†</span>
          <div class="nav-label">–ì–ª–∞–≤–Ω–∞—è</div>
        </div>
        <div class="nav-item" data-screen="profile">
          <span>üë§</span>
          <div class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</div>
        </div>
      </div>
    </nav>
  </div>

  <!-- Rush overlay -->
  <div id="rush-overlay" class="overlay">
    <div class="overlay-inner">
      <div class="overlay-header">
        <button class="btn btn-ghost" id="rush-back">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="overlay-title">Rush</div>
      </div>

      <div class="rush-multiplier" id="rush-multiplier">x1.00</div>

      <div class="rush-track">
        <div class="rush-track-line">
          <div class="rush-rocket" id="rush-rocket"></div>
        </div>
      </div>

      <div class="rush-status" id="rush-status">–í—ã–±–µ—Ä–∏ —Å—Ç–∞–≤–∫—É –∏ –∂–º–∏ —Å—Ç–∞—Ä—Ç</div>
      <div class="rush-history" id="rush-history">–ò—Å—Ç–æ—Ä–∏—è: ‚Äî</div>

      <div class="rush-controls">
        <div class="rush-input">
          <label for="rush-auto">–ê–≤—Ç–æ–≤—ã–≤–æ–¥, x</label>
          <div class="rush-auto-row">
            <input type="checkbox" id="rush-auto-enabled" checked />
            <input
              type="number"
              id="rush-auto"
              value="2.0"
              step="0.1"
              min="1.01"
              style="flex: 1"
            />
          </div>
        </div>

        <div class="rush-input">
          <label for="rush-bet">–°—Ç–∞–≤–∫–∞, OWY</label>
          <input type="number" id="rush-bet" value="10" min="10" />
        </div>

        <div class="rush-buttons">
          <button class="btn btn-primary" id="rush-start">–°—Ç–∞—Ä—Ç</button>
          <button class="btn btn-ghost" id="rush-cashout" disabled>–ó–∞–±—Ä–∞—Ç—å</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Plinko overlay -->
  <div id="plinko-overlay" class="overlay">
    <div class="overlay-inner">
      <div class="overlay-header">
        <button class="btn btn-ghost" id="plinko-back">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="overlay-title">Plinko</div>
      </div>

      <div class="plinko-board-wrap">
        <div class="plinko-board" id="plinko-board">
          <div class="plinko-slot-labels" id="plinko-slot-labels"></div>
        </div>
      </div>

      <div class="plinko-status" id="plinko-status">
        –í—ã–±–µ—Ä–∏ —Ä–∏—Å–∫ –∏ –∂–º–∏ –∑–∞–ø—É—Å–∫ —à–∞—Ä–æ–≤
      </div>

      <div class="plinko-controls">
        <div class="plinko-risk-row">
          <div class="pill-btn active" data-risk="low">Low</div>
          <div class="pill-btn" data-risk="mid">Mid</div>
          <div class="pill-btn" data-risk="high">High</div>
        </div>

        <div class="rush-input">
          <label for="plinko-bet">–°—Ç–∞–≤–∫–∞ –∑–∞ —à–∞—Ä, OWY</label>
          <input type="number" id="plinko-bet" value="10" min="10" />
        </div>

        <div class="rush-buttons">
          <button class="btn btn-primary" id="plinko-launch-1">+1 —à–∞—Ä</button>
          <button class="btn btn-primary" id="plinko-launch-5">+5 —à–∞—Ä–æ–≤</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    // –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–∞–±–ª-—Ç–∞–ø –∑—É–º–∞
    window.addEventListener(
      'dblclick',
      function (e) {
        e.preventDefault();
      },
      { passive: false }
    );

    // --- Telegram WebApp –∏ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ---
    let tg = null;
    let user = null;

    const STORAGE_KEY = 'owy_play_demo_state_v2';

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
          return { balance: 1000, xp: 0, gamesPlayed: 0 };
        }
        const obj = JSON.parse(raw);
        if (typeof obj.balance !== 'number') obj.balance = 1000;
        if (typeof obj.xp !== 'number') obj.xp = 0;
        if (typeof obj.gamesPlayed !== 'number') obj.gamesPlayed = 0;
        return obj;
      } catch (e) {
        return { balance: 1000, xp: 0, gamesPlayed: 0 };
      }
    }

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    let state = loadState();
    let demoBalance = state.balance;

    const headerBalanceEl = document.getElementById('header-balance');
    const profileBalanceEl = document.getElementById('profile-balance');
    const profileNameEl = document.getElementById('profile-name');
    const profileUsernameEl = document.getElementById('profile-username');
    const profileIdEl = document.getElementById('profile-id');
    const profileAvatarEl = document.getElementById('profile-avatar');
    const rankDotEl = document.getElementById('rank-dot');
    const rankNameEl = document.getElementById('rank-name');
    const xpLabelEl = document.getElementById('xp-label');

    if (window.Telegram && window.Telegram.WebApp) {
      tg = window.Telegram.WebApp;
      tg.expand();
      user = tg.initDataUnsafe?.user || null;
    }

    function updateBalanceView() {
      demoBalance = state.balance;
      const formatted = demoBalance.toLocaleString('ru-RU');
      headerBalanceEl.textContent = formatted + ' OWY';
      profileBalanceEl.textContent = formatted + ' OWY';
    }

    function getRankByXp(xp) {
      if (xp < 100) return { name: 'Bronze', dotClass: 'rank-bronze', next: 100 };
      if (xp < 300) return { name: 'Silver', dotClass: 'rank-silver', next: 300 };
      if (xp < 600) return { name: 'Gold', dotClass: 'rank-gold', next: 600 };
      if (xp < 1000) return { name: 'Platinum', dotClass: 'rank-plat', next: 1000 };
      return { name: 'OWY Legend', dotClass: 'rank-legend', next: null };
    }

    function updateProfileView() {
      // –∏–º—è / —é–∑–µ—Ä
      if (user) {
        const name = [user.first_name, user.last_name].filter(Boolean).join(' ');
        profileNameEl.textContent = name || 'OWY Player';
        profileUsernameEl.textContent = user.username
          ? '@' + user.username
          : 'ID: ' + user.id;
        profileIdEl.textContent = user.id || '‚Äî';
        const initials = (name || 'OP')
          .split(' ')
          .map((p) => p[0])
          .join('')
          .slice(0, 2)
          .toUpperCase();
        profileAvatarEl.textContent = initials;
      } else {
        profileNameEl.textContent = 'OWY Player (demo)';
        profileUsernameEl.textContent = '@demo';
        profileIdEl.textContent = '‚Äî';
        profileAvatarEl.textContent = 'OP';
      }

      const rankInfo = getRankByXp(state.xp);
      rankNameEl.textContent = rankInfo.name;
      rankDotEl.className = 'rank-dot ' + rankInfo.dotClass;
      if (rankInfo.next) {
        xpLabelEl.textContent = state.xp + ' / ' + rankInfo.next;
      } else {
        xpLabelEl.textContent = state.xp + ' XP';
      }

      updateBalanceView();
    }

    updateProfileView();

    document.getElementById('rank-hint-link').addEventListener('click', () => {
      alert(
        '–†–∞–Ω–≥–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –ø–æ –æ–±—â–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É XP:\n' +
          '‚Ä¢ Bronze ‚Äî –¥–æ 100 XP\n' +
          '‚Ä¢ Silver ‚Äî –¥–æ 300 XP\n' +
          '‚Ä¢ Gold ‚Äî –¥–æ 600 XP\n' +
          '‚Ä¢ Platinum ‚Äî –¥–æ 1000 XP\n' +
          '‚Ä¢ OWY Legend ‚Äî 1000+ XP\n\n' +
          'XP –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –∑–∞ –∏–≥—Ä—É –≤ Rush –∏ Plinko.'
      );
    });

    // --- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º ---
    const screens = {
      home: document.getElementById('screen-home'),
      profile: document.getElementById('screen-profile')
    };

    document.querySelectorAll('.nav-item').forEach((item) => {
      item.addEventListener('click', () => {
        document.querySelectorAll('.nav-item').forEach((n) => n.classList.remove('active'));
        item.classList.add('active');

        const target = item.getAttribute('data-screen');
        Object.keys(screens).forEach((key) => {
          screens[key].classList.toggle('active', key === target);
        });
      });
    });

    // --- OWY —Å–æ–≤–µ—Ç—ã (—Ä–æ—Ç–∞—Ü–∏—è) ---
    const tips = [
      'Plinko High —Ä–∏—Å–∫ ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≥–æ—Ç–æ–≤ –∫ –±–æ–ª–∏.',
      '–í Rush –∞–≤—Ç–æ-–≤—ã–≤–æ–¥ –Ω–∞ x2‚Äìx3 –æ–±—ã—á–Ω–æ –∂–∏–≤—ë—Ç –¥–æ–ª—å—à–µ, —á–µ–º –∂–∞–¥–Ω–æ—Å—Ç—å ‚úã',
      '–ù–µ —Å—Ç–∞–≤—å –≤–µ—Å—å –±–∞–Ω–∫ –≤ –æ–¥–∏–Ω —à–∞—Ä ‚Äî –¥–µ–ª–∏ —Å—Ç–∞–≤–∫—É –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—É—Å–∫–æ–≤.',
      '–°–∞–º—ã–π —É–º–Ω—ã–π –º—É–≤ ‚Äî —É–π—Ç–∏ –≤ –ø–ª—é—Å –∏ —Å–¥–µ–ª–∞—Ç—å –ø–∞—É–∑—É üòé',
      'Plinko Mid ‚Äî –∑–æ–ª–æ—Ç–∞—è —Å–µ—Ä–µ–¥–∏–Ω–∞ –º–µ–∂–¥—É —Ä–∏—Å–∫–æ–º –∏ —à–∞–Ω—Å–æ–º –≤—ã–∂–∏—Ç—å.'
    ];
    const tipEl = document.getElementById('owy-tip-text');
    let tipIndex = 0;

    function rotateTip() {
      tipIndex = (tipIndex + 1) % tips.length;
      tipEl.textContent = tips[tipIndex];
    }

    setInterval(rotateTip, 12000);

    // ---- Rush logic ----
    const rushOverlay = document.getElementById('rush-overlay');
    const rushOpenBtn = document.getElementById('rush-open');
    const rushBackBtn = document.getElementById('rush-back');
    const rushMultEl = document.getElementById('rush-multiplier');
    const rushRocketEl = document.getElementById('rush-rocket');
    const rushStatusEl = document.getElementById('rush-status');
    const rushHistoryEl = document.getElementById('rush-history');
    const rushBetInput = document.getElementById('rush-bet');
    const rushAutoInput = document.getElementById('rush-auto');
    const rushAutoEnabled = document.getElementById('rush-auto-enabled');
    const rushStartBtn = document.getElementById('rush-start');
    const rushCashoutBtn = document.getElementById('rush-cashout');

    let rushTimer = null;
    let rushState = 'idle';
    let currentMulti = 1.0;
    let crashMulti = 1.0;
    let rushBet = 0;
    let autoCashout = 2.0;
    let crashHistory = [];

    function updateRushHistory() {
      if (!crashHistory.length) {
        rushHistoryEl.textContent = '–ò—Å—Ç–æ—Ä–∏—è: ‚Äî';
        return;
      }
      const last = crashHistory.slice(-10);
      const text = last.map((v) => 'x' + v.toFixed(2)).join('   ');
      rushHistoryEl.textContent = '–ò—Å—Ç–æ—Ä–∏—è: ' + text;
    }

    updateRushHistory();

    function resetRushForNewGame() {
      rushState = 'idle';
      currentMulti = 1.0;
      crashMulti = 1.0;
      rushBet = 0;
      rushMultEl.textContent = 'x1.00';
      rushRocketEl.style.width = '0%';
      rushStatusEl.textContent = '–í—ã–±–µ—Ä–∏ —Å—Ç–∞–≤–∫—É –∏ –∂–º–∏ —Å—Ç–∞—Ä—Ç';
      rushStartBtn.disabled = false;
      rushCashoutBtn.disabled = true;
      if (rushTimer) {
        clearInterval(rushTimer);
        rushTimer = null;
      }
    }

    function openRush() {
      rushOverlay.style.display = 'flex';
      resetRushForNewGame();
    }

    function closeRush() {
      rushOverlay.style.display = 'none';
      resetRushForNewGame();
    }

    rushOpenBtn.addEventListener('click', openRush);
    rushBackBtn.addEventListener('click', closeRush);

    function generateCrashMultiplier() {
      const r = Math.random();
      if (r < 0.05) return 1.0;
      if (r < 0.25) return +(Math.random() * (1.2 - 1.01) + 1.01).toFixed(2);
      if (r < 0.6) return +(Math.random() * (2.0 - 1.2) + 1.2).toFixed(2);
      if (r < 0.8) return +(Math.random() * (3.0 - 2.0) + 2.0).toFixed(2);
      if (r < 0.92) return +(Math.random() * (5.0 - 3.0) + 3.0).toFixed(2);
      if (r < 0.98) return +(Math.random() * (10.0 - 5.0) + 5.0).toFixed(2);
      if (r < 0.995) return +(Math.random() * (20.0 - 10.0) + 10.0).toFixed(2);
      return +(Math.random() * (50.0 - 20.0) + 20.0).toFixed(2);
    }

    function calcStepDelta() {
      if (currentMulti < 1.2) return 0.005;
      if (currentMulti < 1.5) return 0.01;
      if (currentMulti < 2.0) return 0.02;
      if (currentMulti < 3.0) return 0.04;
      if (currentMulti < 5.0) return 0.06;
      if (currentMulti < 8.0) return 0.09;
      return 0.12;
    }

    function startRush() {
      if (rushState === 'running') return;

      const betValue = parseInt(rushBetInput.value, 10);
      if (isNaN(betValue) || betValue < 10) {
        rushStatusEl.textContent = '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ ‚Äî 10 OWY ü§®';
        return;
      }

      if (betValue > demoBalance) {
        rushStatusEl.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è —Ç–∞–∫–æ–π —Å—Ç–∞–≤–∫–∏ üòî';
        return;
      }

      resetRushForNewGame();

      if (rushAutoEnabled.checked) {
        const autoValRaw = parseFloat(rushAutoInput.value);
        if (!isNaN(autoValRaw) && autoValRaw > 1.0) {
          autoCashout = autoValRaw;
        } else {
          autoCashout = null;
        }
      } else {
        autoCashout = null;
      }

      rushState = 'running';
      rushBet = betValue;
      state.balance -= rushBet;
      saveState();
      updateBalanceView();
      state.xp += 5;
      state.gamesPlayed += 1;
      saveState();
      updateProfileView();

      rushStatusEl.textContent = '–ò–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞... —Å–ª–µ–¥–∏ –∑–∞ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–º! üöÄ';
      crashMulti = generateCrashMultiplier();

      rushCashoutBtn.disabled = false;
      rushStartBtn.disabled = true;

      rushTimer = setInterval(() => {
        if (rushState !== 'running') return;

        currentMulti += calcStepDelta();
        rushMultEl.textContent = 'x' + currentMulti.toFixed(2);
        const progress = Math.min(currentMulti / 10, 1) * 100;
        rushRocketEl.style.width = progress + '%';

        if (autoCashout && currentMulti >= autoCashout) {
          cashoutRush();
          return;
        }

        if (currentMulti >= crashMulti) {
          if (rushTimer) {
            clearInterval(rushTimer);
            rushTimer = null;
          }
          crashHistory.push(crashMulti);
          updateRushHistory();

          rushState = 'idle';
          rushCashoutBtn.disabled = true;
          rushStartBtn.disabled = false;
          rushStatusEl.textContent =
            'üí• –ö—Ä–∞—à –Ω–∞ x' +
            crashMulti.toFixed(2) +
            '. –°—Ç–∞–≤–∫–∞ ' +
            rushBet +
            ' OWY —Å–≥–æ—Ä–µ–ª–∞.';
        }
      }, 70);
    }

    function cashoutRush() {
      if (rushState !== 'running') return;

      rushState = 'idle';
      if (rushTimer) {
        clearInterval(rushTimer);
        rushTimer = null;
      }
      rushCashoutBtn.disabled = true;
      rushStartBtn.disabled = false;

      const winAmount = Math.floor(rushBet * currentMulti);
      state.balance += winAmount;
      saveState();
      updateBalanceView();

      crashHistory.push(crashMulti);
      updateRushHistory();

      rushStatusEl.textContent =
        '‚úÖ –ó–∞–±—Ä–∞–ª –Ω–∞ x' +
        currentMulti.toFixed(2) +
        '!\n–í—ã–∏–≥—Ä—ã—à: ' +
        winAmount +
        ' OWY.';
    }

    rushStartBtn.addEventListener('click', startRush);
    rushCashoutBtn.addEventListener('click', cashoutRush);

    // --- Plinko logic (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π, –Ω–æ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —à–∞—Ä–∞–º–∏) ---
    const plinkoOverlay = document.getElementById('plinko-overlay');
    const plinkoOpenBtn = document.getElementById('plinko-open');
    const plinkoBackBtn = document.getElementById('plinko-back');
    const plinkoBoard = document.getElementById('plinko-board');
    const plinkoStatusEl = document.getElementById('plinko-status');
    const plinkoBetInput = document.getElementById('plinko-bet');
    const plinkoLaunch1 = document.getElementById('plinko-launch-1');
    const plinkoLaunch5 = document.getElementById('plinko-launch-5');
    const plinkoRiskButtons = document.querySelectorAll('.pill-btn');
    const plinkoSlotLabels = document.getElementById('plinko-slot-labels');

    let currentRisk = 'low';
    let plinkoSlots = [];
    let pegs = [];
    let activeBalls = [];

    function openPlinko() {
      plinkoOverlay.style.display = 'flex';
      setupPlinkoBoard();
      plinkoStatusEl.textContent = '–í—ã–±–µ—Ä–∏ —Ä–∏—Å–∫ –∏ –∂–º–∏ –∑–∞–ø—É—Å–∫ —à–∞—Ä–æ–≤';
    }

    function closePlinko() {
      plinkoOverlay.style.display = 'none';
      clearPlinko();
    }

    plinkoOpenBtn.addEventListener('click', openPlinko);
    plinkoBackBtn.addEventListener('click', closePlinko);

    plinkoRiskButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        plinkoRiskButtons.forEach((b) => b.classList.remove('active'));
        btn.classList.add('active');
        currentRisk = btn.getAttribute('data-risk');
        setupPlinkoBoard();
      });
    });

    function clearPlinko() {
      pegs.forEach((p) => p.remove());
      pegs = [];
      activeBalls.forEach((b) => b.el.remove());
      activeBalls = [];
      plinkoSlotLabels.innerHTML = '';
    }

    function setupPlinkoBoard() {
      clearPlinko();
      const rows = 8;
      const cols = 13;
      const boardRect = plinkoBoard.getBoundingClientRect();
      const width = boardRect.width;
      const height = boardRect.height - 30;

      const hSpacing = width / (cols + 1);
      const vSpacing = height / (rows + 1);

      for (let r = 0; r < rows; r++) {
        for (let c = 0; c <= r; c++) {
          const x =
            width / 2 -
            (r * hSpacing) / 2 +
            c * hSpacing +
            hSpacing / 2;
          const y = 40 + r * vSpacing;
          const peg = document.createElement('div');
          peg.className = 'plinko-peg';
          peg.style.left = x + 'px';
          peg.style.top = y + 'px';
          plinkoBoard.appendChild(peg);
          pegs.push({ x, y });
        }
      }

      // –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –ø–æ —Å–ª–æ—Ç–∞–º
      const countSlots = 13;
      plinkoSlots = [];
      const labelsFrag = document.createDocumentFragment();

      for (let i = 0; i < countSlots; i++) {
        let coef;
        if (currentRisk === 'low') {
          const arr = [0.5, 0.8, 1, 1.2, 1.5, 2, 3];
          const idx = Math.min(
            arr.length - 1,
            Math.abs(i - Math.floor(countSlots / 2))
          );
          coef = arr[idx];
        } else if (currentRisk === 'mid') {
          const arr = [0.2, 0.5, 0.8, 1, 2, 3, 5];
          const idx = Math.min(
            arr.length - 1,
            Math.abs(i - Math.floor(countSlots / 2))
          );
          coef = arr[idx];
        } else {
          const arr = [0, 0.2, 0.5, 1, 3, 5, 10];
          const idx = Math.min(
            arr.length - 1,
            Math.abs(i - Math.floor(countSlots / 2))
          );
          coef = arr[idx];
        }
        plinkoSlots.push(coef);

        const span = document.createElement('span');
        span.textContent = coef + 'x';
        if (coef <= 0.5) span.classList.add('slot-low');
        else if (coef <= 3) span.classList.add('slot-mid');
        else span.classList.add('slot-high');
        labelsFrag.appendChild(span);
      }

      plinkoSlotLabels.appendChild(labelsFrag);
    }

    function launchBall() {
      const betValue = parseInt(plinkoBetInput.value, 10);
      if (isNaN(betValue) || betValue < 10) {
        plinkoStatusEl.textContent = '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ ‚Äî 10 OWY ü§®';
        return;
      }
      if (betValue > state.balance) {
        plinkoStatusEl.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è —ç—Ç–æ–π —Å—Ç–∞–≤–∫–∏ üòî';
        return;
      }

      // —Å–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
      state.balance -= betValue;
      saveState();
      updateBalanceView();
      state.xp += 3;
      state.gamesPlayed += 1;
      saveState();
      updateProfileView();

      const boardRect = plinkoBoard.getBoundingClientRect();
      const width = boardRect.width;
      const startX = width / 2;
      const startY = 20;

      const el = document.createElement('div');
      el.className = 'plinko-ball';
      plinkoBoard.appendChild(el);

      const ball = {
        el,
        x: startX,
        y: startY,
        vy: 0.6,
        vx: 0,
        bet: betValue,
        alive: true
      };
      activeBalls.push(ball);
      updateBallPosition(ball);
      plinkoStatusEl.textContent = '–®–∞—Ä–∏–∫–∏ –≤ –ø—É—Ç–∏...';

      animateBalls();
    }

    function updateBallPosition(ball) {
      ball.el.style.left = ball.x + 'px';
      ball.el.style.top = ball.y + 'px';
    }

    let plinkoAnimating = false;

    function animateBalls() {
      if (plinkoAnimating) return;
      plinkoAnimating = true;

      function step() {
        const boardRect = plinkoBoard.getBoundingClientRect();
        const width = boardRect.width;
        const height = boardRect.height - 20;

        activeBalls.forEach((ball) => {
          if (!ball.alive) return;

          ball.vy += 0.015;
          ball.y += ball.vy;
          ball.x += ball.vx * 0.8;

          // —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –ø–∏–Ω–∞–º–∏
          pegs.forEach((peg) => {
            const dx = ball.x - peg.x;
            const dy = ball.y - peg.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            if (dist < 10) {
              ball.vy = Math.abs(ball.vy);
              const dir = Math.random() < 0.5 ? -1 : 1;
              ball.vx = dir * (0.3 + Math.random() * 0.4);
            }
          });

          if (ball.x < 5) ball.x = 5;
          if (ball.x > width - 5) ball.x = width - 5;

          if (ball.y >= height) {
            ball.alive = false;
            ball.y = height;

            const slotIndex = Math.min(
              plinkoSlots.length - 1,
              Math.max(0, Math.round((ball.x / width) * (plinkoSlots.length - 1)))
            );
            const coef = plinkoSlots[slotIndex];
            const win = Math.floor(ball.bet * coef);
            if (win > 0) {
              state.balance += win;
              saveState();
              updateBalanceView();
              plinkoStatusEl.textContent =
                '–®–∞—Ä x' + coef + '. –í—ã–∏–≥—Ä—ã—à: ' + win + ' OWY.';
            } else {
              plinkoStatusEl.textContent = '–®–∞—Ä —É–ø–∞–ª –≤ –Ω—É–ª–µ–≤–æ–π —Å–ª–æ—Ç. –°—Ç–∞–≤–∫–∞ —Å–≥–æ—Ä–µ–ª–∞ üíÄ';
            }
          }

          updateBallPosition(ball);
        });

        activeBalls = activeBalls.filter((b) => b.alive);
        if (activeBalls.length > 0) {
          requestAnimationFrame(step);
        } else {
          plinkoAnimating = false;
        }
      }

      requestAnimationFrame(step);
    }

    plinkoLaunch1.addEventListener('click', () => {
      launchBall();
    });

    plinkoLaunch5.addEventListener('click', () => {
      for (let i = 0; i < 5; i++) {
        setTimeout(launchBall, i * 160);
      }
    });
  </script>
</body>
</html>