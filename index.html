<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>OWY Play</title>
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    }

    body {
      background: #05060a;
      color: #f5f5f5;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      -webkit-text-size-adjust: 100%;
      transition: background 0.25s ease;
    }

      :root, html, body {
      overflow-x: clip;               /* –Ω–∞–¥—ë–∂–Ω–µ–µ —Å–∫—Ä—ã–≤–∞–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª –≤ iOS */
      width: 100%;
      max-width: 100%;
    }

    .app { overflow-x: hidden; }
    .content { overflow-x: hidden; }
    .mini-scroll { overscroll-behavior-x: contain; }

    .app, .content, .header {
      overflow-x: hidden;           /* –æ–±—Ä–µ–∑–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ç–µ–Ω–∏/–≤—ã–ø–æ–ª–∑–∞–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ */
      max-width: 100%;
    }

        /* –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ —Å–µ–∫—Ü–∏–∏ –∏ –æ–≤–µ—Ä–ª–µ–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ä–∞–∑–¥—É–≤–∞—é—Ç —à–∏—Ä–∏–Ω—É */
    #home-screen, #profile-screen, #pet-screen,
    .overlay, .overlay-inner {
      max-width: 100%;
      overflow-x: clip;
    }

    body.theme-neon {
      background: radial-gradient(circle at top, #061318, #040308 60%, #020105);
    }

    .app {
      max-width: 420px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      border-left: 1px solid #14151a;
      border-right: 1px solid #14151a;
      position: relative;
    }

    body.theme-neon .app {
      border-color: rgba(29,219,111,0.35);
      box-shadow: 0 0 20px rgba(29,219,111,0.2);
    }

    /* SPLASH */

  .splash {
  position: absolute;
  inset: 0;
  z-index: 200;
  display: flex;
  align-items: center;
  justify-content: center;
  background: radial-gradient(circle at top, #111821, #05060a 60%, #020105 100%);
  transition: opacity 0.35s ease;
}

.splash-hide {
  opacity: 0;
  pointer-events: none;
}

/* —Å–∞–º–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ */
.splash-inner {
  position: relative;
  width: calc(100% - 40px);
  max-width: 360px;
  padding: 22px 20px 18px;
  border-radius: 22px;
  background: radial-gradient(circle at top left, #151b24, #06070c 70%);
  border: 1px solid rgba(29, 219, 111, 0.28);
  box-shadow:
    0 0 25px rgba(29, 219, 111, 0.25),
    0 18px 34px rgba(0, 0, 0, 0.8);
  overflow: hidden;
}

/* –º—è–≥–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –ø–æ–¥ –∫–∞—Ä—Ç–æ–π */
.splash-glow {
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at top, rgba(29, 219, 111, 0.32), transparent 60%);
  opacity: 0.7;
  filter: blur(18px);
  pointer-events: none;
}

/* –ª–æ–≥–æ—Ç–∏–ø */
.splash-logo-row {
  position: relative;
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

.splash-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: #1ddb6f;
  box-shadow: 0 0 18px rgba(29, 219, 111, 0.95);
}

.splash-logo-text {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.splash-title {
  font-size: 22px;
  font-weight: 700;
}

.splash-tagline {
  font-size: 12px;
  color: #9ea2b0;
}

/* –ø–æ–¥–ø–∏—Å–∏ / —Å—Ç–∞—Ç—É—Å */
.splash-sub {
  position: relative;
  font-size: 12px;
  color: #c2c6d3;
  margin-top: 4px;
}

/* –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä */
.splash-bar {
  position: relative;
  margin-top: 14px;
  width: 100%;
  height: 4px;
  border-radius: 999px;
  background: rgba(255, 255, 255, 0.06);
  overflow: hidden;
}

.splash-bar-fill {
  width: 40%;
  height: 100%;
  border-radius: 999px;
  background: linear-gradient(90deg, #1ddb6f, #16a451);
  animation: splash-bar-move 1.2s ease-in-out infinite;
}

@keyframes splash-bar-move {
  0%   { transform: translateX(-110%); }
  50%  { transform: translateX(0%); }
  100% { transform: translateX(120%); }
}

    /* HEADER */

 .header{
  position: relative;              /* —è–∫–æ—Ä–∏–º –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤–Ω—É—Ç—Ä–∏ */
  padding: 10px 14px 6px 14px;
  padding-right: calc(56px + env(safe-area-inset-right));
  display: flex;                   /* –ø—Ä–æ—Å—Ç–∞—è —Å—Ö–µ–º–∞ –≤–º–µ—Å—Ç–æ grid */
  align-items: center;
  gap: 10px;
  border-bottom: none;
  background: transparent;
  overflow: visible;
}

    /* –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Ä–∞—Å–ø–∏—Ä–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º */
    .header > * { min-width: 0; }

  .logo{
  display:flex;
  align-items:center;
  gap:6px;
  font-weight:600;
  font-size:16px;
  justify-self:start;              /* –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å, –Ω–æ –Ω–µ –≤–ª–∏—è–µ—Ç –≤–æ flex */
  flex:0 0 auto;                   /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–ª–æ–∫ —Å–ª–µ–≤–∞ */
  z-index:1;
}

    .logo-img {
  height: 36px;
  width: auto;
  display: block;
}

    .balance-pill {
      flex: 0 0 auto;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(15, 17, 25, 0.96);
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.7);
      justify-self: center;      /* —Ü–µ–Ω—Ç—Ä —Å—Ç—Ä–æ–≥–æ –≤ –≥—Ä–∏–¥–µ */
      cursor: pointer;
      transition: box-shadow 0.15s ease, transform 0.08s ease;
      max-width: min(48vw, 220px); /* –Ω–µ —Ä–∞—Å–ø–∏—Ä–∞–µ–º —Å–µ—Ç–∫—É –¥–∞–∂–µ –ø—Ä–∏ –¥–ª–∏–Ω–Ω—ã—Ö —á–∏—Å–ª–∞—Ö */
      white-space: nowrap;        /* –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ */
      min-width: 0;               /* —Ä–∞–∑—Ä–µ—à–∞–µ–º —Å–∂–∏–º–∞—Ç—å—Å—è –≤ –≥—Ä–∏–¥–µ */
      position:absolute;               /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∫–æ–º–ø–æ–Ω–æ–≤–∫–∏ */
      left:50%;
      transform:translateX(-50%);
      z-index:2;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      touch-action: manipulation;
      will-change: transform;
    }

.balance-pill:active {
  transform: translateX(-50%) scale(0.97);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
}


    .balance-icon {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: radial-gradient(circle at top, #46a2ff, #142334);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
     } 

    .balance-text {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      color: #f5f5f5;
    }

    .balance-value {
      font-size: 13px;
      font-weight: 600;
    }

    .profile-btn {
  position: absolute;          /* —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤ –ø—Ä–∞–≤–æ–º —É–≥–ª—É —à–∞–ø–∫–∏ */
  top: 10px;                   /* —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å padding .header */
  right: calc(14px + env(safe-area-inset-right));
  z-index: 3;                  /* –ø–æ–≤–µ—Ä—Ö –±–∞–ª–∞–Ω—Å–∞ */

  width: 32px;
  height: 32px;
  border-radius: 999px;
  border: none;
  outline: none;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #46a2ff, #1ddb6f);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.7);
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}

@supports (padding: max(0px)) {
  @media (max-width: 430px) {
    .header { padding-right: max(56px, calc(56px + env(safe-area-inset-right))); }
    .profile-btn { right: max(14px, calc(14px + env(safe-area-inset-right))); }
  }
}

    .profile-avatar-text {
      font-size: 14px;
      font-weight: 600;
      color: #05060a;
    }

    /* MAIN */

    /* === MINI GAMES CAROUSEL (horizontal) === */
    .mini-section-title {
      font-size: 14px;
      font-weight: 600;
      margin: 8px 0 8px;
    }
    .mini-scroll {
      display: flex;
      gap: 12px;
      overflow-x: auto;             /* –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª —Ç–æ–ª—å–∫–æ –∑–¥–µ—Å—å */
      overflow-y: hidden;
      padding: 2px 2px 10px;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior-inline: contain; /* –Ω–µ –ø–µ—Ä–µ–¥–∞—ë–º –∂–µ—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—é */
     }
    .mini-scroll::-webkit-scrollbar {
      height: 6px;
    }
    .mini-scroll::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.08);
      border-radius: 999px;
    }
    .mini-card {
      flex: 0 0 220px;               /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∞–π—Ç–µ–º–∞ */
      max-width: 220px;              /* –Ω–µ –≤—ã—Ä–∞—Å—Ç–∞–µ–º —Å–≤–µ—Ä—Ö —à–∏—Ä–∏–Ω—ã */
      border-radius: 16px;
      overflow: hidden;
      background: radial-gradient(circle at top left, #151a22, #090b0f);
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 12px 24px rgba(0,0,0,0.8);
      scroll-snap-align: start;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.08s ease, border-color 0.12s ease;
    }
    .mini-card:active {
      transform: scale(0.98);
      box-shadow: 0 8px 18px rgba(0,0,0,0.7);
      border-color: rgba(29,219,111,0.35);
    }
    .mini-card img {
      display: block;
      width: 100%;
      height: 120px;
      object-fit: cover;
    }
    .mini-card-body {
      padding: 10px 12px 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .mini-card-title {
      font-size: 16px;
      font-weight: 600;
    }
    .mini-chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.08);
      color: #cfd2de;
    }

    .content {
      flex: 1;
      padding: 14px 18px 80px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .cards {
      display: flex;
      flex-direction: column;
      gap: 18px;
      margin-bottom: 16px;
    }

    .card {
      border-radius: 18px;
      padding: 26px 20px;
      background: radial-gradient(circle at top left, #182728, #090b0f);
      border: 1px solid rgba(255, 255, 255, 0.02);
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.5);
      min-height: 120px;
      transition: transform 0.08s ease, box-shadow 0.08s ease, border-color 0.15s ease;
    }

    body.theme-neon .card {
      background: radial-gradient(circle at top left, #10231e, #050309);
      border-color: rgba(29,219,111,0.18);
    }

    .card:active {
      transform: scale(0.98);
      box-shadow: 0 8px 20px rgba(29,219,111,0.35);
      border-color: rgba(29,219,111,0.4);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: #cfd2de;
    }

    .card-title {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .card-sub {
      font-size: 13px;
      color: #9ea2b0;
    }

    .card-footer {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 10px;
    }

    .btn {
      border: none;
      outline: none;
      padding: 10px 16px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: transform 0.06s ease, box-shadow 0.06s ease, background 0.1s ease;
      touch-action: manipulation;
    }

    .btn-primary {
      background: linear-gradient(135deg, #1ddb6f, #16a451);
      color: #05060a;
      box-shadow: 0 6px 16px rgba(29, 219, 111, 0.4);
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 3px 10px rgba(29, 219, 111, 0.3);
    }

    .btn-ghost {
      background: transparent;
      color: #cfd2de;
    }

    .hint-text {
      font-size: 11px;
      color: #9ea2b0;
      margin: 6px 0 12px;
    }

    .bottom-hint {
      text-align: center;
      font-size: 11px;
      color: #8c909a;
      margin-top: 10px;
      margin-bottom: 20px;
    }

  .big-cards {
  display: flex;
  flex-direction: column;
  gap: 18px;
}

   .big-card {
  display: flex;
  flex-direction: column;
  justify-content: center;
  text-align: center;
  padding: 26px 20px;
}

    /* PET / FLUFFIE */

    .pet-xp-row {
      margin: 6px 0 4px;
    }

    .pet-xp-label {
      font-size: 11px;
      color: #9ea2b0;
      margin-bottom: 4px;
    }

    .pet-xp-fill {
      background: linear-gradient(90deg,#8a66ff,#1ddb6f);
    }

    .pet-bonus-badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: radial-gradient(circle at left, rgba(29,219,111,0.22), rgba(6,10,18,0.95));
      border: 1px solid rgba(29,219,111,0.5);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 5px;
      color: #e7fdf0;
      box-shadow: 0 0 10px rgba(29,219,111,0.35);
    }

       .pet-card {
      border-radius: 22px;
      padding: 18px 14px 16px;
      background: radial-gradient(circle at top, #121722, #05070b);
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 18px 40px rgba(0,0,0,0.9);
      margin-top: 6px;
      min-height: calc(100vh - 170px); /* –ø–æ—á—Ç–∏ –≤–µ—Å—å —ç–∫—Ä–∞–Ω –≤ –∫–æ–ª–æ–Ω–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
      display: flex;
      flex-direction: column;
    }

#pet-screen .section-title {
  margin-bottom: 6px;      /* –º–æ–∂–Ω–æ 4‚Äì6px –≤–º–µ—Å—Ç–æ 8px –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
}

    .pet-text {
      font-size: 13px;
      color: #cfd2de;
      margin-bottom: 12px;
    }

    .pet-field {
      margin-bottom: 10px;
    }

    .pet-field label {
      font-size: 12px;
      color: #9ea2b0;
      display: block;
      margin-bottom: 4px;
    }

    .pet-field input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #20232b;
      background: #080a0f;
      color: #f5f5f5;
      font-size: 14px;
      outline: none;
    }

.pet-error {
  font-size: 11px;
  color: #ff7676;
  margin-top: 4px;
  min-height: 13px;
}

    .pet-field input:focus {
      border-color: #1ddb6f;
    }

    .pet-gender-row {
      display: flex;
      gap: 8px;
    }

    .pet-gender-btn {
      flex: 1;
      font-size: 13px;
    }

    .pet-gender-active {
      background: rgba(29,219,111,0.14);
      border: 1px solid rgba(29,219,111,0.7);
      color: #e7fdf0;
    }

    .pet-color-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .pet-color-pill {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #20232b;
      background: rgba(6,8,12,0.95);
      padding: 6px 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #cfd2de;
      cursor: pointer;
      outline: none;
    }

    .pet-color-pill:active {
      transform: scale(0.98);
    }

    .pet-color-active {
      border-color: #1ddb6f;
      background: radial-gradient(circle at left, rgba(29,219,111,0.2), #05070c);
      color: #e7fdf0;
    }

    .pet-color-dot {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      box-shadow: 0 0 10px rgba(0,0,0,0.7);
      flex-shrink: 0;
    }

    .pet-color-purple {
      background: #8a66ff;
      box-shadow: 0 0 12px rgba(138,102,255,0.9);
    }

    .pet-color-green {
      background: #1ddb6f;
      box-shadow: 0 0 12px rgba(29,219,111,0.9);
    }

    .pet-color-black {
      background: #11131b;
      box-shadow: 0 0 12px rgba(0,0,0,0.9);
    }

    .pet-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .pet-name {
      font-size: 20px;
      font-weight: 600;
    }

    .pet-sub {
      font-size: 12px;
      color: #b1b6c4;
    }

    .pet-chip {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(11,24,19,0.9);
      border: 1px solid rgba(29,219,111,0.35);
      box-shadow: 0 0 10px rgba(29,219,111,0.35);
    }

      .pet-image-wrap {
      margin: 4px 0 6px;
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .pet-image-wrap img {
      width: 230px;
      height: 230px;
      transition: transform 0.25s ease;
      object-fit: contain;
      filter: drop-shadow(0 18px 40px rgba(0,0,0,0.95));
    }

@keyframes pet-bounce {
  0%   { transform: translateY(0) scale(1); }
  30%  { transform: translateY(-8px) scale(1.04); }
  60%  { transform: translateY(2px) scale(0.98); }
  100% { transform: translateY(0) scale(1); }
}

.pet-bounce {
  animation: pet-bounce 0.45s ease-out;
}

    .pet-bars {
      margin-bottom: 10px;
    }

    .pet-bar-row {
      font-size: 11px;
      color: #cfd2de;
      margin-bottom: 6px;
    }

    .pet-bar {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      overflow: hidden;
      margin-top: 3px;
    }

    .pet-bar-fill {
      width: 100%;
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg,#1ddb6f,#16a451);
      transition: width 0.2s ease;
    }

   .pet-actions {
  display: flex;
  gap: 6px;
  margin: 8px 0 6px;
}

.pet-action-btn {
  flex: 1;
  font-size: 13px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.06);
  background: rgba(9,11,18,0.95);
}

.pet-action-btn:active {
  transform: translateY(1px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.7);
}

    .pet-note {
      font-size: 11px;
      color: #a1a6b5;
      text-align: center;
    }

   
.pet-reset-btn {
  margin-top: 8px;
  font-size: 11px;
  opacity: 0.6;
}

.pet-shop-btn {
  margin-top: 6px;
  font-size: 12px;
}

/* –ú–∞–≥–∞–∑–∏–Ω Fluffie */

.pet-shop-card {
  padding-bottom: 14px;
}

.pet-shop-items {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 12px;
}

.pet-shop-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 10px;
  border-radius: 12px;
  background: rgba(6, 8, 14, 0.9);
  border: 1px solid rgba(255,255,255,0.06);
}

.pet-shop-item-main {
  max-width: 65%;
}

.pet-shop-item-name {
  font-size: 14px;
  font-weight: 500;
}

.pet-shop-item-desc {
  font-size: 11px;
  color: #9ea2b0;
  margin-top: 2px;
}

.pet-shop-item-side {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 4px;
}

.pet-shop-price {
  font-size: 12px;
  color: #e7fdf0;
}

.pet-shop-note {
  font-size: 11px;
  color: #9ea2b0;
  margin-top: 10px;
}

/* === PET MATCH-3 GAME === */

.pet-game-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 13px;
  color: #cfd2de;
  margin-bottom: 10px;
}

.pet-game-score,
.pet-game-timer {
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(6, 8, 12, 0.9);
  border: 1px solid rgba(255, 255, 255, 0.06);
}

.pet-game-grid {
  margin-top: 10px;
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 6px;
  justify-items: center;
}

.pet-game-tile {
  width: 44px;
  height: 44px;
  border-radius: 14px;
  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.8);
  border: 1px solid rgba(0, 0, 0, 0.4);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: transform 0.08s ease, box-shadow 0.08s ease, border-color 0.1s ease;
}

.pet-game-tile:active {
  transform: scale(0.95);
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.8);
}

.pet-game-tile-selected {
  border-color: #1ddb6f;
  box-shadow: 0 0 12px rgba(29, 219, 111, 0.7);
}

/* —Ü–≤–µ—Ç–∞ "–∫–∞–º–Ω–µ–π" */
.pet-game-gem-0 {
  background: linear-gradient(135deg, #8a66ff, #c29dff);
}
.pet-game-gem-1 {
  background: linear-gradient(135deg, #1ddb6f, #40f7a0);
}
.pet-game-gem-2 {
  background: linear-gradient(135deg, #ffb943, #ff8a3b);
}
.pet-game-gem-3 {
  background: linear-gradient(135deg, #ff5a7a, #ff9ab0);
}
.pet-game-gem-4 {
  background: linear-gradient(135deg, #46a2ff, #8ec8ff);
}

#pet-game-note {
  margin-top: 12px;
}

    /* PROFILE */

    .profile-card {
      border-radius: 16px;
      padding: 16px 14px 16px;
      background: radial-gradient(circle at top left, #151923, #090b0f);
      border: 1px solid rgba(255, 255, 255, 0.02);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.5);
      margin-top: 10px;
    }

    body.theme-neon .profile-card {
      background: radial-gradient(circle at top left, #101725, #05030a);
      border-color: rgba(29,219,111,0.25);
    }

    .profile-line {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-bottom: 6px;
      color: #cfd2de;
    }

    .profile-line span:first-child {
      color: #8c8f9a;
    }

    .profile-balance {
      font-size: 15px;
      font-weight: 600;
    }

    .rank-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 6px 0 8px;
      font-size: 12px;
    }

    .xp-bar {
      margin-top: 4px;
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(255,255,255,0.05);
      overflow: hidden;
    }

    .xp-bar-fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #1ddb6f, #16a451);
      transition: width 0.2s ease;
    }

    .profile-section-title {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      font-weight: 600;
      margin: 14px 0 8px;
    }

    .profile-section-title .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #1ddb6f;
    }

    .profile-field {
      margin-bottom: 10px;
    }

    .profile-field label {
      font-size: 12px;
      color: #9ea2b0;
      display: block;
      margin-bottom: 4px;
    }

    .profile-field input,
    .profile-field select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #20232b;
      background: #080a0f;
      color: #f5f5f5;
      font-size: 14px;
      outline: none;
    }

    .profile-field input:focus,
    .profile-field select:focus {
      border-color: #1ddb6f;
    }

    .profile-buttons {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 6px;
    }

    .profile-note {
      font-size: 11px;
      color: #7f8491;
      margin-top: 6px;
    }

    .stats-row {
      font-size: 11px;
      color: #9ea2b0;
      margin-top: 4px;
    }

    .missions-list {
      font-size: 11px;
      color: #9ea2b0;
      list-style: none;
      padding-left: 0;
    }

    .missions-list li {
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .mission-done {
      color: #1ddb6f;
    }


/* === BOTTOM NAVIGATION BAR (–Ω–æ–≤—ã–π –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Å—Ç–∏–ª—å) === */

  .bottom-nav {
    position: fixed;
    bottom: 34px;              /* –±—ã–ª–æ 16px ‚Äî –ø–æ–¥–Ω–∏–º–∞–µ–º –≤—ã—à–µ –æ—Ç –∫—Ä–∞—è —ç–∫—Ä–∞–Ω–∞ */
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 85%;
    max-width: 360px;
    padding: 8px 16px;        /* —á—É—Ç—å –±–æ–ª—å—à–µ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
    border-radius: 26px;       /* –±–æ–ª–µ–µ –æ–∫—Ä—É–≥–ª—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    background: rgba(20, 21, 25, 0.9);
    backdrop-filter: blur(10px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
    z-index: 100;
    overflow-x: hidden;
   }

/* –ö–Ω–æ–ø–∫–∏ */

  .bottom-nav-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    gap: 10px;
  }

  /* –ö–Ω–æ–ø–∫–∏ */
  .nav-btn,
  .nav-item {
    flex: 1;
    text-align: center;
    color: #a0a0a0;
    font-size: 12px;
    font-weight: 500;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3px;
    cursor: pointer;
    transition: color 0.2s ease, transform 0.1s ease;
    background: transparent;   /* —É–±–∏—Ä–∞–µ–º –±–µ–ª—ã–π —Ñ–æ–Ω —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–Ω–æ–ø–∫–∏ */
    border: none;              /* —É–±–∏—Ä–∞–µ–º –±–æ—Ä–¥–µ—Ä */
    outline: none;
    padding: 4px 0;
    border-radius: 999px;
    -webkit-appearance: none;
    appearance: none;
  }

    /* –ò–∫–æ–Ω–∫–∏ */
  .nav-btn img,
  .nav-btn svg,
  .nav-item img,
  .nav-item svg {
    width: 22px;
    height: 22px;
    opacity: 0.9;
  }

  /* –ê–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
  .nav-btn.active,
  .nav-item.active {
    color: #1ddb6f;
  }

  .nav-btn.active img,
  .nav-btn.active svg,
  .nav-item.active img,
  .nav-item.active svg {
    opacity: 1;
  }

  /* Hover —ç—Ñ—Ñ–µ–∫—Ç (–¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞) */
  .nav-btn:hover,
  .nav-item:hover {
    color: #e7ffe9;
  }

    /* OVERLAYS */

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(5, 6, 10, 0.96);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 50;
      overflow-x: hidden;
     }

    .overlay-inner {
      width: 100%;
      max-width: 420px;
      padding: 18px 18px 90px;
    }

    .overlay-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .overlay-title {
      font-size: 18px;
      font-weight: 600;
    }

    /* RUSH */

    .rush-multiplier {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .rush-scene {
      position: relative;
      width: 100%;
      height: 120px;
      margin: 10px 0 6px;
      border-radius: 16px;
      background: radial-gradient(circle at bottom, #16352c, #05070a);
      overflow: hidden;
      border: 1px solid rgba(29, 219, 111, 0.25);
    }

    .rush-slope {
      position: absolute;
      left: -20%;
      bottom: -30px;
      width: 160%;
      height: 80px;
      background: linear-gradient(135deg, #124233, #050708);
      border-radius: 40px;
      box-shadow: 0 -6px 24px rgba(0, 0, 0, 0.7);
      transform: rotate(-18deg);
    }

    #rush-owy {
      position: absolute;
      width: 60px;
      height: 60px;
      left: 4%;
      bottom: 6px;

      background-image: url("owy.png");
      background-size: contain;
      background-repeat: no-repeat;
      background-position: bottom center;

      transform-origin: center bottom;
      transform: translate(0px, 0px) rotate(0deg);
      transition: transform 0.07s linear;
    }

    @keyframes rush-run {
      0%   { bottom: 6px; }
      50%  { bottom: 10px; }
      100% { bottom: 6px; }
    }

    #rush-owy.rush-running {
      animation: rush-run 0.22s linear infinite;
    }

    /* –ª–∏–Ω–∏—è –∏ —Ä–∞–∫–µ—Ç–∞ —Å–µ–π—á–∞—Å –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –ø—Ä–æ—Å—Ç–æ —Å–∫—Ä—ã–≤–∞–µ–º */
    .rush-track-line {
      display: none !important;
    }

    .rush-status {
      font-size: 12px;
      color: #9ea2b0;
      margin: 12px 0;
      min-height: 32px;
    }

    .rush-timer {
      font-size: 11px;
      color: #7f8491;
      margin-top: -4px;
    }

    .rush-history {
      font-size: 11px;
      color: #7f8491;
      margin-bottom: 10px;
      min-height: 14px;
    }

    .rush-input {
      margin-bottom: 10px;
    }

    .rush-input label {
      font-size: 12px;
      color: #9ea2b0;
      display: block;
      margin-bottom: 4px;
    }

    .rush-input input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #20232b;
      background: #080a0f;
      color: #f5f5f5;
      font-size: 14px;
      outline: none;
    }

    .rush-input input:focus {
      border-color: #1ddb6f;
    }

    .rush-buttons {
      display: flex;
      gap: 8px;
      margin-top: 4px;
      flex-wrap: wrap;
    }

    #rush-cashout[disabled] {
      opacity: 0.4;
      cursor: default;
    }

    .auto-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-size: 12px;
      color: #9ea2b0;
      margin-bottom: 6px;
      user-select: none;
    }

    .auto-checkbox input {
      display: none;
    }

    .checkmark {
      width: 16px;
      height: 16px;
      display: inline-block;
      flex-shrink: 0;
      border-radius: 4px;
      border: 1px solid #3a3d44;
      background: #080a0f;
      position: relative;
      transition: all 0.15s ease;
    }

    .auto-checkbox input:checked + .checkmark {
      border-color: #1ddb6f;
      background: #1ddb6f;
      box-shadow: 0 0 10px rgba(29, 219, 111, 0.6);
    }

    .auto-checkbox input:checked + .checkmark::after {
      content: "‚úì";
      position: absolute;
      left: 3px;
      top: -1px;
      font-size: 13px;
      color: #05060a;
      font-weight: bold;
    }

    .auto-label-text {
      font-size: 12px;
      color: #cfd2de;
    }

    /* –º–∞–ª–µ–Ω—å–∫–∏–µ —Ü–≤–µ—Ç–Ω—ã–µ —Ç–∞–±—ã –∏—Å—Ç–æ—Ä–∏–∏ */

    .rush-history-chip {
      display: inline-block;
      padding: 1px 5px;
      margin-right: 4px;
      margin-top: 2px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 500;
      background: rgba(255, 255, 255, 0.03);
    }

    .rush-history-chip.low {
      color: #ff7676;
      background: rgba(255, 118, 118, 0.12);
    }

    .rush-history-chip.mid {
      color: #ffd27f;
      background: rgba(255, 210, 127, 0.14);
    }

    .rush-history-chip.high {
      color: #c4ffd9;
      background: rgba(29, 219, 111, 0.2);
    }

    /* –≤—Å–ø—ã—à–∫–∞ –ø—Ä–∏ –∫—Ä–∞—à–µ */

    .rush-scene::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(circle at center, rgba(255,255,255,0.65), transparent 60%);
      opacity: 0;
    }

    @keyframes crash-flash {
      0%   { opacity: 0; }
      25%  { opacity: 1; }
      100% { opacity: 0; }
    }

    .rush-scene.flash::after {
      animation: crash-flash 0.35s ease-out;
    }

    /* PLINKO */

   .plinko-board {
  position: relative;
  border-radius: 20px;
  padding: 18px 16px 28px;
  background: radial-gradient(circle at top, #141922, #06070b 70%);
  border: 1px solid rgba(255, 255, 255, 0.04);
  box-shadow: 0 14px 28px rgba(0, 0, 0, 0.75);
  margin-bottom: 10px;
  height: 320px;
  overflow: hidden;
}

.plinko-board.low {
  background: radial-gradient(circle at top, #151d23, #05060a 70%);
}

.plinko-board.mid {
  background: radial-gradient(circle at top, #101f19, #05060a 70%);
}

.plinko-board.high {
  background: radial-gradient(circle at top, #231318, #05060a 70%);
}

.plinko-pegs-layer {
  position: absolute;
  inset: 10px 16px 56px 16px;
  pointer-events: none;
  z-index: 1;
}

.plinko-peg {
  position: absolute;
  width: 7px;
  height: 7px;
  border-radius: 50%;
  background: #dde2ec;
  box-shadow: 0 0 4px rgba(0, 0, 0, 0.9);
  opacity: 0.95;
}

.plinko-balls-layer {
  position: absolute;
  inset: 0 0 60px 0;
  pointer-events: none;
  z-index: 2;
}

    .plinko-ball {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #1ddb6f;
      box-shadow: 0 0 8px rgba(29, 219, 111, 0.9);
      top: 0;
      left: 50%;
      margin-left: -5px;
      transition: top 0.2s linear, left 0.2s linear;
    }

   .plinko-slots {
  display: flex;
  justify-content: space-between;
  gap: 4px;
  position: absolute;
  left: 16px;
  right: 16px;
  bottom: 18px;
  z-index: 3;
}

.plinko-slot {
  flex: 1;
  min-width: 28px;
  padding: 4px 0 3px;
  border-radius: 9px;
  text-align: center;
  font-size: 11px;
  font-weight: 600;
  color: #fff7eb;
  background: linear-gradient(180deg, #2b2622, #171310);
  border: 1px solid #332822;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.7);
  transform: translateY(0);
  transition: transform 0.06s ease,
              box-shadow 0.06s ease,
              border-color 0.1s ease,
              background 0.1s ease;
}

/* –≥—Ä–∞–¥–∞—Ü–∏–∏ "–≥–æ—Ä—è—á–µ—Å—Ç–∏" —Å–ª–æ—Ç–∞ –ø–æ –∏–∫—Å—É */
.plinko-slot-hot {
  background: linear-gradient(180deg, #ff6a34, #d9362b);
  border-color: #ff8a3c;
}

.plinko-slot-warm {
  background: linear-gradient(180deg, #ffb943, #ff8531);
  border-color: #ffc659;
}

.plinko-slot-cool {
  background: linear-gradient(180deg, #252932, #1a1e26);
  border-color: #353a47;
  color: #d2d7e4;
}

.plinko-slot.active {
  transform: translateY(-2px);
  box-shadow:
    0 0 16px rgba(29, 219, 111, 0.5),
    0 10px 20px rgba(0, 0, 0, 0.9);
  border-color: #1ddb6f;
}

    .plinko-risk-active {
      background: rgba(29, 219, 111, 0.15);
      border-color: #1ddb6f;
      color: #e7fdf0;
    }

    .plinko-history {
      font-size: 11px;
      color: #7f8491;
      margin-top: 4px;
      min-height: 14px;
    }

    /* HILO BANNER */

    .hilo-banner {
      border-radius: 18px;
      padding: 16px 16px 14px;
      background: radial-gradient(circle at top, #181f2c, #05060a 70%);
      border: 1px solid rgba(70, 162, 255, 0.45);
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 14px;
      cursor: pointer;
      overflow: hidden;
    }

.hilo-odd {
  font-size: 11px;
  opacity: 0.8;
  display: block;
  margin-top: 2px;
}

    .hilo-banner:active {
      transform: scale(0.98);
      box-shadow: 0 8px 20px rgba(70,162,255,0.5);
      border-color: rgba(70,162,255,0.8);
    }

    .hilo-banner-left {
      flex: 1;
      min-width: 0;
    }

    .hilo-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: #dbe7ff;
      background: rgba(70,162,255,0.1);
      border: 1px solid rgba(70,162,255,0.4);
      margin-bottom: 6px;
    }

    .hilo-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .hilo-subtitle {
      font-size: 12px;
      color: #9ea2b0;
      max-width: 210px;
    }

    .hilo-banner-right {
      position: relative;
      width: 80px;
      height: 70px;
      flex-shrink: 0;
    }

    .hilo-card-mini {
      position: absolute;
      width: 60px;
      height: 80px;
      border-radius: 12px;
      background: #f5f5f5;
      color: #1b1d22;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 700;
      box-shadow: 0 10px 24px rgba(0,0,0,0.9);
    }

    .hilo-card-mini.prev {
      left: 0;
      top: 8px;
      transform: rotate(-8deg);
      background: #fdf4f4;
      color: #d64545;
    }

    .hilo-card-mini.next {
      right: 0;
      top: -2px;
      transform: rotate(10deg);
      background: linear-gradient(135deg,#142334,#3354a8);
      color: #f5f5f5;
    }

    .hilo-card-mini.next span {
      opacity: 0.85;
    }

    /* RUSH BANNER */

    .rush-banner {
      border-radius: 18px;
      overflow: hidden;
      cursor: pointer;
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.5);
      margin-bottom: 18px;
    }

    .rush-banner img {
      display: block;
      width: 100%;
      height: auto;
    }

.match3-board {
  margin-top: 12px;
  margin-bottom: 12px;
  width: 100%;
  max-width: 320px;
  aspect-ratio: 1 / 1;
  border-radius: 18px;
  background: radial-gradient(circle at top, #171b24, #05060a);
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 14px 30px rgba(0,0,0,0.8);
  margin-inline: auto;
  position: relative;
  overflow: hidden;
  touch-action: none; /* —á—Ç–æ–±—ã —Å–≤–∞–π–ø—ã –Ω–µ —Å–∫—Ä–æ–ª–ª–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É */
}

.match3-cell {
  position: absolute;
  width: calc(100% / 7);
  height: calc(100% / 7);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 700;
  color: #f5f5f5;
  transition: transform 0.16s ease, opacity 0.16s ease;
}

.match3-gem {
  width: 70%;
  height: 70%;
  border-radius: 14px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.7);
}

/* –¶–≤–µ—Ç–∞ –∫–∞–º–Ω–µ–π */
.match3-gem-0 { background: linear-gradient(135deg,#8a66ff,#c69dff); }
.match3-gem-1 { background: linear-gradient(135deg,#1ddb6f,#46f0a0); }
.match3-gem-2 { background: linear-gradient(135deg,#ff9a3b,#ffc86a); }
.match3-gem-3 { background: linear-gradient(135deg,#46a2ff,#8bc7ff); }
.match3-gem-4 { background: linear-gradient(135deg,#ff5a7a,#ff9bb0); }

.match3-cell--pop {
  animation: match3-pop 0.18s ease-out forwards;
}

@keyframes match3-pop {
  0%   { transform: scale(1);   opacity: 1; }
  100% { transform: scale(1.3); opacity: 0; }
}

/* –≤–æ –≤—Ä–µ–º—è —Å–≤–∞–π–ø–∞ —Å–ª–µ–≥–∫–∞ –ø–æ–¥–Ω–∏–º–∞–µ–º */
.match3-cell--active {
  transform: translateY(-4px);
}

/* === TAP-TAP GAME === */

.taptap-board {
  margin-top: 12px;
  margin-bottom: 12px;
  width: 100%;
  max-width: 320px;
  aspect-ratio: 1 / 1;
  border-radius: 18px;
  background: radial-gradient(circle at top, #171b24, #05060a);
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 14px 30px rgba(0,0,0,0.8);
  margin-inline: auto;
  position: relative;
  overflow: hidden;
}

.taptap-target {
  position: absolute;
  width: 54px;
  height: 54px;
  border-radius: 999px;
  background: radial-gradient(circle at top, #1ddb6f, #0f7b45);
  box-shadow: 0 0 14px rgba(29,219,111,0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  color: #05060a;
  cursor: pointer;
  transform: scale(0.4);
  opacity: 0;
  transition: transform 0.12s ease-out, opacity 0.12s ease-out;
}

.taptap-target--alive {
  transform: scale(1);
  opacity: 1;
}

.taptap-target--hit {
  transform: scale(0.2);
  opacity: 0;
}

/* === DOUBLE === */

.double-wheel-wrap {
  margin: 10px 0 16px;
  padding: 14px 10px 18px;
  border-radius: 18px;
  background: radial-gradient(circle at top, #151a22, #05070a);
  border: 1px solid rgba(255,255,255,0.08);
  box-shadow: 0 10px 24px rgba(0,0,0,0.7);
  position: relative;
  overflow: hidden;
}

.double-wheel-window {
  position: relative;
  height: 70px;
  overflow: hidden;
}

.double-wheel-strip {
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  gap: 6px;
  /* –±–µ–∑ transition, –¥–≤–∏–≥–∞–µ–º —Ç–æ–ª—å–∫–æ –∏–∑ JS */
}

.double-cell {
  min-width: 60px;
  padding: 6px 6px 8px;
  border-radius: 14px;
  font-size: 13px;
  font-weight: 600;
  text-align: center;
  color: #f5f5f5;
  box-shadow: 0 0 10px rgba(0,0,0,0.6);
  border: 1px solid rgba(0,0,0,0.4);
  white-space: nowrap;
}

.double-cell.blue {
  background: linear-gradient(135deg, #254dff, #46a2ff);
  border-color: rgba(70,162,255,0.85);
}

.double-cell.green {
  background: linear-gradient(135deg, #19c86e, #25e3a9);
  border-color: rgba(31,215,117,0.9);
}

.double-cell.orange {
  background: linear-gradient(135deg, #ff9a3b, #ff5a3b);
  border-color: rgba(255,154,59,0.95);
}

.double-pointer {
  position: absolute;
  top: 2px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 7px solid transparent;
  border-right: 7px solid transparent;
  border-bottom: 10px solid #f5f5f5;
  filter: drop-shadow(0 0 6px rgba(0,0,0,0.9));
  z-index: 3;
}

.double-round-label {
  font-size: 13px;
  margin-bottom: 4px;
}

.double-sub {
  font-size: 12px;
  color: #9ea2b0;
  margin-bottom: 6px;
}

.double-timer {
  font-size: 11px;
  color: #7f8491;
  margin-bottom: 4px;
}

.double-colors-row {
  display: flex;
  gap: 6px;
  margin: 8px 0 6px;
  flex-wrap: nowrap;
}

.double-color-btn {
  flex: 1;
  min-width: 0;
  border-radius: 14px;
  padding: 6px 10px;
  border: none;
  outline: none;
  font-size: 13px;
  font-weight: 500;
  color: #f5f5f5;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  cursor: pointer;
  background: #111520;
  border: 1px solid #222738;
  transition: transform 0.05s ease, box-shadow 0.05s ease,
              border-color 0.1s ease, background 0.1s ease;
}

    .double-color-btn.blue {
  background: linear-gradient(135deg,#254dff,#46a2ff);
  border-color: rgba(70,162,255,0.9);
}

.double-color-btn.green {
  background: linear-gradient(135deg,#19c86e,#25e3a9);
  border-color: rgba(31,215,117,0.9);
}

.double-color-btn.orange {
  background: linear-gradient(135deg,#ff9a3b,#ff5a3b);
  border-color: rgba(255,154,59,0.95);
}

.double-color-btn.active {
  box-shadow: 0 0 14px rgba(0,0,0,0.9);
  transform: translateY(1px);
}

.double-bet-pill {
  margin-top: 2px;
  padding: 0 6px;
  border-radius: 999px;
  font-size: 10px;
  background: rgba(5,6,10,0.35);
  border: 1px solid rgba(255,255,255,0.16);
}

.double-history {
  font-size: 11px;
  color: #7f8491;
  margin-top: 6px;
  min-height: 16px;
}

.double-history-chip {
  display: inline-block;
  padding: 1px 5px;
  margin-right: 4px;
  margin-top: 2px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 500;
  background: rgba(255,255,255,0.03);
}

.double-history-chip.blue {
  color: #8ec2ff;
  background: rgba(142,194,255,0.14);
}

.double-history-chip.green {
  color: #c2ffe1;
  background: rgba(31,215,117,0.16);
}

.double-history-chip.orange {
  color: #ffddb3;
  background: rgba(255,164,81,0.18);
}

    /* HILO */

    .hilo-sub {
      font-size: 12px;
      color: #9ea2b0;
      margin-bottom: 6px;
    }

    .hilo-round-label {
      font-size: 13px;
      font-weight: 500;
      margin: 6px 0 4px;
      color: #cfd2de;
    }

    .hilo-card-wrap {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 14px;
      margin: 10px 0 6px;
    }

    .hilo-card {
      width: 90px;
      height: 130px;
      border-radius: 14px;
      background: #f5f5f5;
      color: #1b1d22;
      box-shadow: 0 10px 22px rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      font-weight: 700;
    }

    .hilo-card-back {
      background: linear-gradient(135deg,#142334,#3354a8);
      color: #f5f5f5;
    }

    .hilo-buttons {
      display: flex;
      gap: 8px;
      margin: 8px 0 4px;
    }

    .hilo-buttons .btn {
      flex: 1;
      font-size: 13px;
      text-align: center;
      padding-inline: 10px;
    }

    .hilo-status {
      font-size: 12px;
      color: #9ea2b0;
      margin-top: 6px;
      min-height: 36px;
    }

  </style>
</head>
<body>
  <div class="app">
   <div class="splash" id="splash">
  <div class="splash-inner">
    <div class="splash-glow"></div>

    <div class="splash-logo-row">
      <div class="splash-dot"></div>
      <div class="splash-logo-text">
        <div class="splash-title">OWY Play</div>
        <div class="splash-tagline">Always Await</div>
      </div>
    </div>

    <div class="splash-sub">–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ–º–æ-–∏–≥—Ä—ã, Fluffie –∏ –±–∞–Ω–Ω–µ—Ä—ã‚Ä¶</div>

    <div class="splash-bar">
      <div class="splash-bar-fill"></div>
    </div>
  </div>
</div>

    <header class="header">
  <div class="logo">
    <img src="play-logo.png" alt="OWY Play" class="logo-img">
  </div>
      
    <div class="balance-pill" id="balance-pill">
  <div class="balance-icon">ü™ô</div>
  <div class="balance-text">
    <span class="balance-value">1 000 OWY</span>
  </div>
</div>

      <button class="profile-btn" id="profile-open-btn" type="button">
        <span class="profile-avatar-text">EA</span>
      </button>
    </header>

 <div id="balance-popup" class="overlay" style="align-items:flex-start;">
  <div class="overlay-inner" style="padding-top:70px;">
    <div class="profile-card">
      <div class="section-title">Balance</div>

      <div class="profile-line">
        <span>Main balance</span>
        <span id="balance-main-usd">0.00 $</span>
      </div>

      <div class="profile-line">
        <span>OWY Bonus Coins</span>
        <span id="balance-bonus-owy">0 OWY</span>
      </div>

      <div class="profile-field" style="margin-top:8px;">
        <label for="balance-currency">Currency</label>
        <select id="balance-currency">
          <option value="USD">USD $</option>
          <option value="EUR">EUR ‚Ç¨</option>
          <option value="RUB">RUB ‚ÇΩ</option>
        </select>
      </div>

      <div class="profile-note">
        –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–µ–º–æ, –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–µ–Ω–µ–≥.
      </div>

      <div style="margin-top:10px;">
        <button class="btn btn-primary" id="balance-popup-close">–û–∫</button>
      </div>
    </div>
  </div>
</div>

    <main class="content">
      <!-- HOME -->
      <section id="home-screen">
               <div class="mini-section-title">Mini games</div>
        <div class="mini-scroll" id="mini-scroll">
          <div class="mini-card" id="rush-open">
            <img src="rush-banner.png" alt="Rush">
            <div class="mini-card-body">
              <div class="mini-card-title">Rush</div>
              <div class="mini-chip">Crash</div>
            </div>
          </div>

          <div class="mini-card" id="double-open">
            <img src="double-banner.png" alt="Double">
            <div class="mini-card-body">
              <div class="mini-card-title">Double</div>
              <div class="mini-chip">2x / 14x</div>
            </div>
          </div>

                  <div class="mini-card" id="plinko-open">
            <img src="plinko-banner.png" alt="Plinko">
            <div class="mini-card-body">
              <div class="mini-card-title">Plinko</div>
              <div class="mini-chip">Low/Mid/High</div>
            </div>
          </div>
         
      <div class="mini-card" id="hilo-open">
  <!-- –º–∏–Ω–∏-–æ–±–ª–æ–∂–∫–∞ —Å –¥–≤—É–º—è –º–∏–Ω–∏-–∫–∞—Ä—Ç–∞–º–∏ -->
  <div class="hilo-banner-mini"
       style="position:relative;height:120px;width:100%;overflow:hidden;display:flex;align-items:center;justify-content:center;background:radial-gradient(circle at top,#181f2c,#05060a 70%);">
    <div class="hilo-card-mini prev">J</div>
    <div class="hilo-card-mini next"><span>?</span></div>
  </div>

  <div class="mini-card-body">
    <div class="mini-card-title">HiLo</div>
    <div class="mini-chip">Cards</div>
  </div>
</div>
</div><!-- /mini-scroll -->
</section><!-- /home-screen -->
  
      <!-- PROFILE -->
      <section id="profile-screen" style="display:none;">
        <div class="section-title">–õ–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å</div>
        <div class="profile-card">
          <div class="profile-line">
            <span>OWY ID</span>
            <span id="profile-id">‚Äî</span>
          </div>
          <div class="profile-line">
            <span>–ë–∞–ª–∞–Ω—Å</span>
            <span class="profile-balance" id="profile-balance">1 000 OWY</span>
          </div>

          <div class="rank-row">
            <span>–†–∞–Ω–≥: <span id="rank-label">BRONZE I</span></span>
            <span id="xp-label">0 / 100 XP</span>
          </div>
          <div class="xp-bar">
            <div class="xp-bar-fill" id="xp-bar-fill"></div>
          </div>

          <div class="stats-row" id="stats-row">
            Rush: 0 –∏–≥—Ä ‚Ä¢ Plinko: 0 –∏–≥—Ä ‚Ä¢ –õ—É—á—à–∏–π –º–Ω–æ–∂–∏—Ç–µ–ª—å: x1.00
          </div>

          <div class="profile-section-title">
            <span class="dot"></span>
            <span>–ú–∏—Å—Å–∏–∏ –¥–Ω—è (–¥–µ–º–æ)</span>
          </div>
          <ul class="missions-list">
            <li id="mission-1"><span>‚¨ú</span><span>–°—ã–≥—Ä–∞–π Rush 5 —Ä–∞–∑</span></li>
            <li id="mission-2"><span>‚¨ú</span><span>–°—ã–≥—Ä–∞–π Plinko 3 —Ä–∞–∑–∞</span></li>
            <li id="mission-3"><span>‚¨ú</span><span>–°—ã–≥—Ä–∞–π –æ–±–µ –∏–≥—Ä—ã —Å–µ–≥–æ–¥–Ω—è</span></li>
          </ul>

          <div class="profile-section-title">
            <span class="dot"></span>
            <span>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</span>
          </div>

          <div class="profile-field">
            <label for="profile-name">–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è</label>
            <input id="profile-name" type="text" placeholder="–ö–∞–∫ —Ç–µ–±—è –Ω–∞–∑—ã–≤–∞—Ç—å –≤ OWY">
          </div>

          <div class="profile-field">
            <label for="profile-username">OWY username</label>
            <input id="profile-username" type="text" placeholder="@nickname">
          </div>

          <div class="profile-field">
            <label for="profile-birthdate">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
            <input id="profile-birthdate" type="date">
          </div>

          <div class="profile-field">
            <label for="profile-gender">–ü–æ–ª</label>
            <select id="profile-gender">
              <option value="">–ù–µ —É–∫–∞–∑—ã–≤–∞—Ç—å</option>
              <option value="male">–ú—É–∂—Å–∫–æ–π</option>
              <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
              <option value="other">–î—Ä—É–≥–æ–µ</option>
            </select>
          </div>

          <div class="profile-buttons">
            <button class="btn btn-primary" id="profile-save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
            <button class="btn btn-ghost" id="profile-topup">+500 OWY (–¥–µ–º–æ)</button>
            <button class="btn btn-ghost" id="profile-reset">–°–±—Ä–æ—Å–∏—Ç—å –¥–µ–º–æ –±–∞–ª–∞–Ω—Å</button>
            <button class="btn btn-ghost" id="profile-feedback">‚úâ –ù–∞–ø–∏—Å–∞—Ç—å –≤ OWY Hub</button>
          </div>

          <div class="profile-note" id="profile-note">
            –î–∞–Ω–Ω—ã–µ –∏ –±–∞–ª–∞–Ω—Å —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ —É —Ç–µ–±—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ (localStorage).
          </div>
        </div>
      </section>

<!-- PET MATCH-3 OVERLAY -->
<!-- MATCH-3 OVERLAY -->
<div id="match3-overlay" class="overlay">
  <div class="overlay-inner">
    <div class="overlay-header">
      <button class="btn btn-ghost" id="match3-back">‚Üê –ù–∞–∑–∞–¥</button>
      <div class="overlay-title">Fluffie: 3 –≤ —Ä—è–¥</div>
    </div>

    <div class="rush-status" id="match3-status">
      –°–¥–µ–ª–∞–π –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –∑–∞ 60 —Å–µ–∫—É–Ω–¥.
    </div>

    <div class="rush-timer" id="match3-timer">
      –û—Å—Ç–∞–ª–æ—Å—å: 60 c
    </div>

    <div class="match3-board" id="match3-board"></div>

    <div class="rush-status" id="match3-score">
      –û—á–∫–∏: 0
    </div>
  </div>
</div>

<!-- TAP-TAP OVERLAY -->
<div id="taptap-overlay" class="overlay">
  <div class="overlay-inner">
    <div class="overlay-header">
      <button class="btn btn-ghost" id="taptap-back">‚Üê –ù–∞–∑–∞–¥</button>
      <div class="overlay-title">Tap-tap</div>
    </div>

    <div class="rush-status" id="taptap-status">
      –£—Å–ø–µ–π —Ç–∞–ø–Ω—É—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ —Ü–µ–ª–µ–π –∑–∞ 30 —Å–µ–∫—É–Ω–¥.
    </div>

    <div class="rush-timer" id="taptap-timer">
      –û—Å—Ç–∞–ª–æ—Å—å: 30 c
    </div>

    <div class="taptap-board" id="taptap-board"></div>

    <div class="rush-status" id="taptap-score">
      –û—á–∫–∏: 0
    </div>
  </div>
</div>

      <!-- PET -->
      <section id="pet-screen" style="display:none;">
        <div class="section-title">–¢–≤–æ–π Fluffie</div>

        <div class="pet-card" id="pet-main-card">
          <!-- —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ–≥–¥–∞ –ø–∏—Ç–æ–º—Ü–∞ –µ—â—ë –Ω–µ—Ç -->
          <div id="pet-empty-state">
            <p class="pet-text">
              –°–æ–∑–¥–∞–π —Å–≤–æ–µ–≥–æ –ø–µ—Ä–≤–æ–≥–æ Fluffie-–ø–∏—Ç–æ–º—Ü–∞. –û–Ω –±—É–¥–µ—Ç –∂–∏—Ç—å –≤ OWY Play –∏
              —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–æ, –∫–∞–∫ —Ç—ã –∏–≥—Ä–∞–µ—à—å.
            </p>

            <div class="pet-field">
  <label for="pet-name-input">–ò–º—è –ø–∏—Ç–æ–º—Ü–∞</label>
  <input id="pet-name-input" type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ë—É—Å—Ç–∏" />
  <div class="pet-error" id="pet-name-error"></div>
</div>

            <div class="pet-field">
              <label>–ü–æ–ª –ø–∏—Ç–æ–º—Ü–∞</label>
              <div class="pet-gender-row">
                <button class="btn btn-ghost pet-gender-btn pet-gender-active"
                        data-gender="male">–ú–∞–ª—å—á–∏–∫</button>
                <button class="btn btn-ghost pet-gender-btn"
                        data-gender="female">–î–µ–≤–æ—á–∫–∞</button>
              </div>
            </div>

            <div class="pet-field">
              <label>–¶–≤–µ—Ç Fluffie</label>
              <div class="pet-color-row">
                <button class="pet-color-pill pet-color-active"
                        data-color="purple">
                  <span class="pet-color-dot pet-color-purple"></span>
                  –§–∏–æ–ª–µ—Ç–æ–≤—ã–π
                </button>
                <button class="pet-color-pill"
                        data-color="green">
                  <span class="pet-color-dot pet-color-green"></span>
                  –ó–µ–ª—ë–Ω—ã–π
                </button>
                <button class="pet-color-pill"
                        data-color="black">
                  <span class="pet-color-dot pet-color-black"></span>
                  –ù–æ—á–Ω–æ–π
                </button>
              </div>
            </div>

            <button class="btn btn-primary pet-create-btn" id="pet-create-btn">
              –°–æ–∑–¥–∞—Ç—å Fluffie
            </button>
          </div>

          <!-- —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∫–æ–≥–¥–∞ –ø–∏—Ç–æ–º–µ—Ü —É–∂–µ —Å–æ–∑–¥–∞–Ω -->
  <div id="pet-main-state" style="display:none;">
  <div class="pet-header-row">
    <div>
      <div class="pet-name" id="pet-name-label">Fluffie</div>
      <div class="pet-sub" id="pet-sub-label">–§–∏–æ–ª–µ—Ç–æ–≤—ã–π Fluffie ‚Ä¢ LVL 1</div>
    </div>
    <div class="pet-chip" id="pet-mood-chip">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: üòä</div>
  </div>

  <div class="pet-xp-row">
    <div class="pet-xp-label" id="pet-xp-label">
      0 / 40 XP –¥–æ LVL 2
    </div>
    <div class="pet-bar">
      <div class="pet-bar-fill pet-xp-fill" id="pet-xp-fill"></div>
    </div>
    <div class="pet-bonus-badge" id="pet-bonus-badge">
      –ë–æ–Ω—É—Å –∫ –≤—ã–∏–≥—Ä—ã—à—É: +0.0%
    </div>
  </div>

  <div class="pet-image-wrap">
    <img id="pet-image" src="purplefluffie.png" alt="Fluffie" />
  </div>

  <div class="pet-bars">
    <div class="pet-bar-row">
      <span>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</span>
      <div class="pet-bar">
        <div class="pet-bar-fill" id="pet-mood-fill"></div>
      </div>
    </div>
    <div class="pet-bar-row">
      <span>–≠–Ω–µ—Ä–≥–∏—è</span>
      <div class="pet-bar">
        <div class="pet-bar-fill" id="pet-energy-fill"></div>
      </div>
    </div>
    <div class="pet-bar-row">
      <span>–°—ã—Ç–æ—Å—Ç—å</span>
      <div class="pet-bar">
        <div class="pet-bar-fill" id="pet-hunger-fill"></div>
      </div>
    </div>
  </div>

  <div class="pet-actions">
    <button class="btn btn-ghost pet-action-btn" data-action="feed">–ü–æ–∫–æ—Ä–º–∏—Ç—å</button>
    <button class="btn btn-ghost pet-action-btn" data-action="play">–ü–æ–∏–≥—Ä–∞—Ç—å</button>
    <button class="btn btn-ghost pet-action-btn" data-action="rest">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–ø–∞—Ç—å</button>
  </div>

   <div class="pet-note" id="pet-note">
    Fluffie —á—É–≤—Å—Ç–≤—É–µ—Ç —Å–µ–±—è –æ—Ç–ª–∏—á–Ω–æ ‚ú®
  </div>

  <button class="btn btn-ghost pet-shop-btn" id="pet-shop-open">
    –ú–∞–≥–∞–∑–∏–Ω Fluffie
  </button>

  <button class="btn btn-ghost pet-reset-btn" id="pet-reset-btn">
    –°–±—Ä–æ—Å–∏—Ç—å –ø–∏—Ç–æ–º—Ü–∞ (–Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ)
  </button>
</div>
        </div>
      </section>
    </main> 

    <!-- NAV -->
  <nav class="bottom-nav">
  <div class="bottom-nav-inner">
    <button class="nav-item active" id="nav-casino" type="button">
      <span class="nav-icon">üé∞</span>
      <span class="nav-label">Casino</span>
    </button>

    <button class="nav-item" id="nav-bets" type="button">
      <span class="nav-icon">üìà</span>
      <span class="nav-label">Bets</span>
    </button>

    <button class="nav-item" id="nav-tasks" type="button">
      <span class="nav-icon">üìã</span>
      <span class="nav-label">Tasks</span>
    </button>

    <button class="nav-item" id="nav-pet" type="button">
      <span class="nav-icon">üßø</span>
      <span class="nav-label">Fluffie</span>
    </button>
  </div>
</nav>

<!-- MINI GAMES OVERLAY -->
<div id="mini-overlay" class="overlay">
  <div class="overlay-inner">
    <div class="overlay-header">
      <button class="btn btn-ghost" id="mini-back">‚Üê –ù–∞–∑–∞–¥</button>
      <div class="overlay-title">–ú–∏–Ω–∏-–∏–≥—Ä—ã Fluffie</div>
    </div>

    <div class="cards big-cards">

      <!-- –ê–∫—Ç–∏–≤–Ω–∞—è –∏–≥—Ä–∞ -->
      <div class="card big-card" id="mini-open-match3">
        <div class="card-title">3 –≤ —Ä—è–¥</div>
        <div class="card-sub">
          –°–æ–±–∏—Ä–∞–π –∫–∞–º–Ω–∏, –Ω–∞–±–∏—Ä–∞–π –æ—á–∫–∏ –∏ –ø—Ä–æ–∫–∞—á–∏–≤–∞–π Fluffie.
        </div>
        <div class="card-footer">
          <button class="btn btn-primary">–ò–≥—Ä–∞—Ç—å</button>
        </div>
      </div>

      <div class="card big-card" id="mini-open-taptap">
        <div class="card-title">Tap-tap</div>
        <div class="card-sub">
          –ë—ã—Å—Ç—Ä—ã–µ —Ç–∞–ø-—á–µ–ª–ª–µ–Ω–¥–∂–∏ –¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏ Fluffie.
        </div>
        <div class="card-footer">
          <button class="btn btn-primary">–ò–≥—Ä–∞—Ç—å</button>
        </div>
      </div>

      <div class="card big-card">
        <div class="card-title">–ù–∞–π–¥–∏ –ø–∞—Ä—É (—Å–∫–æ—Ä–æ)</div>
        <div class="card-sub">
          –ú–µ–º–æ—Ä–∏-–∏–≥—Ä–∞ –Ω–∞ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ.
        </div>
        <div class="card-footer">
          <button class="btn btn-ghost" disabled>Coming soon</button>
        </div>
      </div>

    </div> <!-- /cards -->
  </div>   <!-- /overlay-inner -->
</div>     <!-- /mini-overlay -->


<!-- PET SHOP OVERLAY (–£–ñ–ï –û–¢–î–ï–õ–¨–ù–û, –ù–ï –í–ù–£–¢–†–ò mini-overlay) -->
<div id="pet-shop-overlay" class="overlay">
  <div class="match3-card pet-shop-card">
    <div class="match3-header">
      <div class="match3-title">–ú–∞–≥–∞–∑–∏–Ω Fluffie</div>
      <button class="btn btn-ghost" id="pet-shop-close">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <div class="pet-shop-items">
      ...
    </div>

    <div class="pet-shop-note" id="pet-shop-note">
      –í—Å–µ –ø–æ–∫—É–ø–∫–∏ —Ç–æ–ª—å–∫–æ –≤ –¥–µ–º–æ, –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–µ–Ω–µ–≥.
    </div>
  </div>
</div>

  <!-- RUSH OVERLAY -->
  <div id="rush-overlay" class="overlay">
    <div class="overlay-inner">
      <div class="overlay-header">
        <button class="btn btn-ghost" id="rush-back">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="overlay-title">Rush</div>
      </div>

      <div class="rush-multiplier" id="rush-multiplier">x1.00</div>

      <div class="rush-timer" id="rush-timer">–î–æ —Å—Ç–∞—Ä—Ç–∞: 10 c</div>

      <div class="rush-scene">
        <div class="rush-slope"></div>
        <div id="rush-owy"></div>
      </div>

      <div class="rush-track-line">
        <div class="rush-rocket" id="rush-rocket"></div>
      </div>

      <div class="rush-status" id="rush-status">
        –í—ã–±–µ—Ä–∏ —Å—Ç–∞–≤–∫—É –∏ –∂–º–∏ —Å—Ç–∞—Ä—Ç
      </div>

      <div class="rush-history" id="rush-history">
        –ò—Å—Ç–æ—Ä–∏—è: ‚Äî
      </div>

      <div class="rush-input">
        <label class="auto-checkbox">
          <input type="checkbox" id="rush-auto-enabled" checked>
          <span class="checkmark"></span>
          <span class="auto-label-text">–ê–≤—Ç–æ–≤—ã–≤–æ–¥, x</span>
        </label>
        <input type="number" id="rush-auto" value="2.0" step="0.1" min="1.01">
      </div>

      <div class="rush-input">
        <label for="rush-bet">–°—Ç–∞–≤–∫–∞, OWY</label>
        <input type="number" id="rush-bet" value="10" min="10">
      </div>

      <div class="rush-buttons">
        <button class="btn btn-primary" id="rush-start">–°—Ç–∞—Ä—Ç</button>
        <button class="btn btn-ghost" id="rush-cashout" disabled>–ó–∞–±—Ä–∞—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- PLINKO OVERLAY -->
  <div id="plinko-overlay" class="overlay">
    <div class="overlay-inner">
      <div class="overlay-header">
        <button class="btn btn-ghost" id="plinko-back">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="overlay-title">Plinko</div>
      </div>

      <div class="plinko-board mid" id="plinko-board">
        <div class="plinko-pegs-layer" id="plinko-pegs-layer"></div>
        <div class="plinko-balls-layer" id="plinko-balls-layer"></div>
        <div class="plinko-slots" id="plinko-mults-row"></div>
      </div>

      <div class="rush-status" id="plinko-status">
        –í—ã–±–∏—Ä–∞–π —Ä–∏—Å–∫ –∏ –∑–∞–ø—É—Å–∫–∞–π —à–∞—Ä üòâ
      </div>

      <div class="plinko-history" id="plinko-history">
        –ò—Å—Ç–æ—Ä–∏—è: ‚Äî
      </div>

      <div class="rush-input">
        <label>–†–∏—Å–∫</label>
        <div class="rush-buttons" id="plinko-risk-buttons">
          <button class="btn btn-ghost" data-risk="low">Low</button>
          <button class="btn btn-ghost plinko-risk-active" data-risk="mid">Mid</button>
          <button class="btn btn-ghost" data-risk="high">High</button>
        </div>
      </div>

      <div class="rush-input">
        <label for="plinko-bet">–°—Ç–∞–≤–∫–∞, OWY</label>
        <input type="number" id="plinko-bet" value="10" min="10">
      </div>

      <div class="rush-buttons">
        <button class="btn btn-primary" id="plinko-start">–ó–∞–ø—É—Å—Ç–∏—Ç—å —à–∞—Ä</button>
      </div>
    </div>
  </div>

  <!-- DOUBLE OVERLAY -->
<div id="double-overlay" class="overlay">
  <div class="overlay-inner">
    <div class="overlay-header">
      <button class="btn btn-ghost" id="double-back">‚Üê –ù–∞–∑–∞–¥</button>
      <div class="overlay-title">Double</div>
    </div>

<div class="double-timer" id="double-timer">
  –î–æ —Å–ø–∏–Ω–∞: 10 c
</div>

<div class="rush-status" id="double-status"></div>

    <div class="double-wheel-wrap">
      <div class="double-pointer"></div>
      <div class="double-wheel-window">
        <div class="double-wheel-strip" id="double-wheel-strip">
          <!-- –∫–ª–µ—Ç–∫–∏ –≥–µ–Ω–µ—Ä–∏–º —á–µ—Ä–µ–∑ JS -->
        </div>
      </div>
    </div>

  <div class="double-colors-row">
  <button class="double-color-btn blue"   data-color="blue"   id="double-btn-blue">2x</button>
  <button class="double-color-btn green"  data-color="green"  id="double-btn-green">2x</button>
  <button class="double-color-btn orange" data-color="orange" id="double-btn-orange">14x</button>
</div>

    <div class="rush-input">
      <label for="double-bet">–°—Ç–∞–≤–∫–∞, OWY</label>
      <input type="number" id="double-bet" value="10" min="10">
    </div>

    <div class="double-history" id="double-history">
      –ò—Å—Ç–æ—Ä–∏—è: ‚Äî
    </div>
  </div>
</div>

<!-- HILO OVERLAY -->
<div id="hilo-overlay" class="overlay">
  <div class="overlay-inner">
    <div class="overlay-header">
      <button class="btn btn-ghost" id="hilo-back">‚Üê –ù–∞–∑–∞–¥</button>
      <div class="overlay-title">HiLo</div>
    </div>

    <div class="hilo-sub">
      –°–¥–µ–ª–∞–π —Å—Ç–∞–≤–∫—É –æ–¥–∏–Ω —Ä–∞–∑, —É–≥–∞–¥—ã–≤–∞–π –∫–∞—Ä—Ç—ã –ø–æ–¥—Ä—è–¥ –∏ –∑–∞–±–µ—Ä–∏ –≤—ã–∏–≥—Ä—ã—à –∫—ç—à–∞—É—Ç–æ–º.
      –ß–µ–º –¥–ª–∏–Ω–Ω–µ–µ —Å–µ—Ä–∏—è ‚Äî —Ç–µ–º –±–æ–ª—å—à–µ x-–º–Ω–æ–∂–∏—Ç–µ–ª—å.
    </div>

    <div class="hilo-round-label" id="hilo-round-label">–†–∞—É–Ω–¥ 1</div>

    <div class="hilo-card-wrap">
      <div class="hilo-card" id="hilo-current-card">7‚ô¶</div>
      <div class="hilo-card hilo-card-back" id="hilo-next-card">‚ùî</div>
    </div>

    <div class="hilo-sub" id="hilo-odds-label">
      –®–∞–Ω—Å—ã –∏ –º–Ω–æ–∂–∏—Ç–µ–ª–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –æ—Ç –∫–∞—Ä—Ç—ã –∫ –∫–∞—Ä—Ç–µ.
    </div>

    <div class="rush-input">
      <label for="hilo-bet">–°—Ç–∞–≤–∫–∞, OWY (–æ–¥–Ω–∞ –Ω–∞ –≤—Å—é —Å–µ—Ä–∏—é)</label>
      <input type="number" id="hilo-bet" value="10" min="10">
    </div>

    <div class="hilo-buttons">
      <button class="btn btn-primary" id="hilo-low-btn">–ù–∏–∂–µ / —Ä–∞–≤–Ω–æ</button>
      <button class="btn btn-primary" id="hilo-high-btn">–í—ã—à–µ / —Ä–∞–≤–Ω–æ</button>
    </div>

    <!-- –ö–ù–û–ü–ö–ê –ö–≠–®–ê–£–¢–ê -->
    <div class="rush-buttons" style="margin-top: 4px;">
      <button class="btn btn-ghost" id="hilo-cashout-btn" disabled>
        –ö—ç—à-–∞—É—Ç x1.00
      </button>
    </div>

    <div class="hilo-status" id="hilo-status">
      –í–≤–µ–¥–∏ —Å—Ç–∞–≤–∫—É, –≤—ã–±–µ—Ä–∏ –≤—ã—à–µ/–Ω–∏–∂–µ –∏ –Ω–∞—á–∏–Ω–∞–π —Å–µ—Ä–∏—é. –ö—ç—à-–∞—É—Ç –∑–∞–±–∏—Ä–∞–µ—Ç –≤—ã–∏–≥—Ä—ã—à –ø–æ —Ç–µ–∫—É—â–µ–º—É –º–Ω–æ–∂–∏—Ç–µ–ª—é.
    </div>
  </div>
</div>

  <script>
  let tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
  let tgUser = null;
  if (tg) {
    tg.expand();
    tgUser = tg.initDataUnsafe && tg.initDataUnsafe.user ? tg.initDataUnsafe.user : null;
  }

  // safety-guard: —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –æ–∫–Ω–∞ –Ω–∞ 0
  window.addEventListener('scroll', () => {
    if (window.scrollX !== 0) window.scrollTo(0, window.scrollY);
  }, { passive: true });


  // === DOM ===
const balanceEl             = document.querySelector('.balance-value');
const splashEl              = document.getElementById('splash');
const balancePopup          = document.getElementById('balance-popup');
const balancePopupClose     = document.getElementById('balance-popup-close');
const balanceMainUsdEl      = document.getElementById('balance-main-usd');
const balanceBonusOwyEl     = document.getElementById('balance-bonus-owy');
const balancePillEl         = document.getElementById('balance-pill');
const balanceCurrencySelect = document.getElementById('balance-currency');

  const homeScreen       = document.getElementById('home-screen');
  const profileScreen    = document.getElementById('profile-screen');
  const petScreen        = document.getElementById('pet-screen');
  const profileOpenBtn = document.getElementById('profile-open-btn');

  // –Ω–æ–≤—ã–µ id —Å–Ω–∏–∑—É –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
  const navCasino        = document.getElementById('nav-casino');
  const navBets          = document.getElementById('nav-bets');
  const navTasks         = document.getElementById('nav-tasks');
  const navPet           = document.getElementById('nav-pet');

  const hintTextEl       = document.getElementById('hint-text');

  const petEmptyStateEl  = document.getElementById('pet-empty-state');
  const petMainStateEl   = document.getElementById('pet-main-state');
  const petNameInput     = document.getElementById('pet-name-input');
  const petCreateBtn     = document.getElementById('pet-create-btn');
  const petGenderBtns    = document.querySelectorAll('.pet-gender-btn');
  const petColorPills    = document.querySelectorAll('.pet-color-pill');
  const petImageEl       = document.getElementById('pet-image');
  const petNameLabelEl   = document.getElementById('pet-name-label');
  const petSubLabelEl    = document.getElementById('pet-sub-label');
  const petMoodChipEl    = document.getElementById('pet-mood-chip');
  const petMoodFillEl    = document.getElementById('pet-mood-fill');
  const petEnergyFillEl  = document.getElementById('pet-energy-fill');
  const petHungerFillEl  = document.getElementById('pet-hunger-fill');
  const petXpLabelEl     = document.getElementById('pet-xp-label');      // NEW
  const petXpFillEl      = document.getElementById('pet-xp-fill');       // NEW
  const petBonusBadgeEl  = document.getElementById('pet-bonus-badge');   // NEW
  const petNoteEl        = document.getElementById('pet-note');
  const petResetBtn      = document.getElementById('pet-reset-btn');
  const petActionBtns    = document.querySelectorAll('.pet-action-btn');

  const miniOverlay       = document.getElementById('mini-overlay');
  const miniBackBtn       = document.getElementById('mini-back');
  const miniOpenMatch3Btn = document.getElementById('mini-open-match3');
  const petShopOpenBtn   = document.getElementById('pet-shop-open');
  const petShopOverlay   = document.getElementById('pet-shop-overlay');
  const petShopCloseBtn  = document.getElementById('pet-shop-close');
  const petShopNoteEl    = document.getElementById('pet-shop-note');
  const petShopBuyBtns   = document.querySelectorAll('.pet-shop-buy');

  const profileIdEl         = document.getElementById('profile-id');
  const profileBalanceEl    = document.getElementById('profile-balance');
  const profileResetBtn     = document.getElementById('profile-reset');
  const profileTopupBtn     = document.getElementById('profile-topup');
  const profileFeedbackBtn  = document.getElementById('profile-feedback');
  const profileNoteEl       = document.getElementById('profile-note');

  const profileNameInput     = document.getElementById('profile-name');
  const profileUsernameInput = document.getElementById('profile-username');
  const profileBirthInput    = document.getElementById('profile-birthdate');
  const profileGenderSelect  = document.getElementById('profile-gender');
  const profileSaveBtn       = document.getElementById('profile-save');

  const rankLabelEl   = document.getElementById('rank-label');
  const xpLabelEl     = document.getElementById('xp-label');
  const xpBarFillEl   = document.getElementById('xp-bar-fill');
  const statsRowEl    = document.getElementById('stats-row');
  const mission1El    = document.getElementById('mission-1');
  const mission2El    = document.getElementById('mission-2');
  const mission3El    = document.getElementById('mission-3');

  const rushOverlay     = document.getElementById('rush-overlay');
  const rushOpenBtn     = document.getElementById('rush-open');
  const rushBackBtn     = document.getElementById('rush-back');
  const rushMultEl      = document.getElementById('rush-multiplier');
  const rushRocketEl    = document.getElementById('rush-rocket');
  const rushStatusEl    = document.getElementById('rush-status');
  const rushHistoryEl   = document.getElementById('rush-history');
  const rushTimerEl    = document.getElementById('rush-timer');
  const rushBetInput    = document.getElementById('rush-bet');
  const rushAutoInput   = document.getElementById('rush-auto');
  const rushAutoEnabled = document.getElementById('rush-auto-enabled');
  const rushStartBtn    = document.getElementById('rush-start');
  const rushCashoutBtn  = document.getElementById('rush-cashout');
  const rushOwyEl       = document.getElementById('rush-owy');

  const match3Overlay = document.getElementById('match3-overlay');
  const match3BackBtn = document.getElementById('match3-back');
  const match3BoardEl = document.getElementById('match3-board');
  const match3StatusEl= document.getElementById('match3-status');
  const match3TimerEl = document.getElementById('match3-timer');
  const match3ScoreEl = document.getElementById('match3-score');

  const plinkoOverlay    = document.getElementById('plinko-overlay');
  const plinkoOpenBtn    = document.getElementById('plinko-open');
  const plinkoBackBtn    = document.getElementById('plinko-back');
  const plinkoStatusEl   = document.getElementById('plinko-status');
  const plinkoHistoryEl  = document.getElementById('plinko-history');
  const plinkoBetInput   = document.getElementById('plinko-bet');
  const plinkoStartBtn   = document.getElementById('plinko-start');
  const plinkoRiskBtns   = document.querySelectorAll('#plinko-risk-buttons button');
  const plinkoBoardEl    = document.getElementById('plinko-board');
  const plinkoMultsRow   = document.getElementById('plinko-mults-row');
  const plinkoBallsLayer = document.getElementById('plinko-balls-layer');
  const plinkoPegsLayer  = document.getElementById('plinko-pegs-layer');

if (profileOpenBtn) {
  profileOpenBtn.addEventListener('click', () => {
       // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø—Ä–æ—Ñ–∏–ª—è, —Å–∫—Ä—ã–≤–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã
    if (homeScreen)   homeScreen.style.display   = 'none';
    if (petScreen)    petScreen.style.display    = 'none';
    if (profileScreen) profileScreen.style.display = 'block';
  });
}

// === POPUP –ë–ê–õ–ê–ù–°–ê ===
if (balancePillEl && balancePopup) {
  balancePillEl.addEventListener('click', () => {
    // –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –æ–±–Ω–æ–≤–∏–º —Ü–∏—Ñ—Ä—ã
    updateBalanceView();
    balancePopup.style.display = 'flex';
  });
}

if (balancePopup && balancePopupClose) {
  balancePopupClose.addEventListener('click', () => {
    balancePopup.style.display = 'none';
  });

  // –∫–ª–∏–∫ –ø–æ –∑–∞—Ç–µ–º–Ω—ë–Ω–Ω–æ–º—É —Ñ–æ–Ω—É –≤–æ–∫—Ä—É–≥ –∫–∞—Ä—Ç–æ—á–∫–∏ ‚Äî —Ç–æ–∂–µ –∑–∞–∫—Ä—ã—Ç—å
  balancePopup.addEventListener('click', (e) => {
    if (e.target === balancePopup) {
      balancePopup.style.display = 'none';
    }
  });
}

  // === DOUBLE DOM ===
const doubleOverlay     = document.getElementById('double-overlay');
const doubleOpenBtn     = document.getElementById('double-open');  // –∫–Ω–æ–ø–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º
const doubleBackBtn     = document.getElementById('double-back');

const doubleTimerEl     = document.getElementById('double-timer');
const doubleWheelStrip  = document.getElementById('double-wheel-strip');

const doubleBtnBlue     = document.getElementById('double-btn-blue');
const doubleBtnGreen    = document.getElementById('double-btn-green');
const doubleBtnOrange   = document.getElementById('double-btn-orange');

const doubleBetInput    = document.getElementById('double-bet');
const doubleHistoryEl   = document.getElementById('double-history');

function handleHideKeyboard(e) {
  const active = document.activeElement;
  if (!active) return;

  const tag = active.tagName;
  const isInput =
    tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT';

  if (!isInput) return;

  // –µ—Å–ª–∏ —Ç–∞–ø–Ω—É–ª–∏ –ø–æ –¥—Ä—É–≥–æ–º—É –∏–Ω–ø—É—Ç—É ‚Äî –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º
  if (e.target.closest('input, textarea, select')) return;

  active.blur();
}

// –≥–ª–æ–±–∞–ª—å–Ω–æ: –ª—é–±–æ–π —Ç–∞–ø –ø–æ —ç–∫—Ä–∞–Ω—É –≤–Ω–µ –∏–Ω–ø—É—Ç–æ–≤ —Å–∫—Ä—ã–≤–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
document.addEventListener('touchstart', handleHideKeyboard, true);
document.addEventListener('click', handleHideKeyboard, true);

// === MATCH-3 (Fluffie) ===

const MATCH3_ROWS  = 7;
const MATCH3_COLS  = 7;
const MATCH3_TYPES = 5;

let match3Grid      = []; // [row][col] = int (—Ç–∏–ø –∫–∞–º–Ω—è)
let match3Score     = 0;
let match3TimeLeft  = 60;
let match3TimerId   = null;
let match3Busy      = false;

let match3StartCell = null;  // {row, col}
let match3PointerId = null;

function createMatch3Grid() {
  match3Grid = [];
  for (let r = 0; r < MATCH3_ROWS; r++) {
    const row = [];
    for (let c = 0; c < MATCH3_COLS; c++) {
      let val;
      do {
        val = Math.floor(Math.random() * MATCH3_TYPES);
      } while (
        (c >= 2 && row[c - 1] === val && row[c - 2] === val) ||
        (r >= 2 && match3Grid[r - 1][c] === val && match3Grid[r - 2][c] === val)
      );
      row.push(val);
    }
    match3Grid.push(row);
  }
}

function renderMatch3Grid() {
  if (!match3BoardEl) return;
  match3BoardEl.innerHTML = '';

  for (let r = 0; r < MATCH3_ROWS; r++) {
    for (let c = 0; c < MATCH3_COLS; c++) {
      const val = match3Grid[r][c];
      if (val == null) continue;

      const cell = document.createElement('div');
      cell.className = 'match3-cell';
      cell.style.left = (c * (100 / MATCH3_COLS)) + '%';
      cell.style.top  = (r * (100 / MATCH3_ROWS)) + '%';

      cell.dataset.row = r;
      cell.dataset.col = c;

      const gem = document.createElement('div');
      gem.className = 'match3-gem match3-gem-' + val;
      cell.appendChild(gem);

      match3BoardEl.appendChild(cell);
    }
  }
}

function findMatches() {
  const toClear = Array.from({ length: MATCH3_ROWS },
    () => Array(MATCH3_COLS).fill(false)
  );
  let hasMatch = false;

  // –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ
  for (let r = 0; r < MATCH3_ROWS; r++) {
    let runVal = null;
    let runLen = 0;
    for (let c = 0; c <= MATCH3_COLS; c++) {
      const val = c < MATCH3_COLS ? match3Grid[r][c] : null;
      if (val !== null && val === runVal) {
        runLen++;
      } else {
        if (runVal !== null && runLen >= 3) {
          hasMatch = true;
          for (let k = 1; k <= runLen; k++) {
            toClear[r][c - k] = true;
          }
        }
        runVal = val;
        runLen = 1;
      }
    }
  }

  // –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ
  for (let c = 0; c < MATCH3_COLS; c++) {
    let runVal = null;
    let runLen = 0;
    for (let r = 0; r <= MATCH3_ROWS; r++) {
      const val = r < MATCH3_ROWS ? match3Grid[r][c] : null;
      if (val !== null && val === runVal) {
        runLen++;
      } else {
        if (runVal !== null && runLen >= 3) {
          hasMatch = true;
          for (let k = 1; k <= runLen; k++) {
            toClear[r - k][c] = true;
          }
        }
        runVal = val;
        runLen = 1;
      }
    }
  }

  return { hasMatch, toClear };
}

function applyMatchesAnimation(toClear) {
  if (!match3BoardEl) return;

  const cells = match3BoardEl.querySelectorAll('.match3-cell');
  cells.forEach(cell => {
    const r = parseInt(cell.dataset.row, 10);
    const c = parseInt(cell.dataset.col, 10);
    if (toClear[r][c]) {
      cell.classList.add('match3-cell--pop');
    }
  });
}

function dropAndRefill() {
  // –ø–∞–¥–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –∫–æ–ª–æ–Ω–æ–∫
  for (let c = 0; c < MATCH3_COLS; c++) {
    let writeRow = MATCH3_ROWS - 1;
    for (let r = MATCH3_ROWS - 1; r >= 0; r--) {
      if (match3Grid[r][c] != null) {
        match3Grid[writeRow][c] = match3Grid[r][c];
        writeRow--;
      }
    }
    while (writeRow >= 0) {
      match3Grid[writeRow][c] = Math.floor(Math.random() * MATCH3_TYPES);
      writeRow--;
    }
  }
}

function resolveMatchesLoop() {
  if (match3Busy) return;
  match3Busy = true;

  const { hasMatch, toClear } = findMatches();
  if (!hasMatch) {
    match3Busy = false;
    return;
  }

  // —Å—á–∏—Ç–∞–µ–º –æ—á–∫–∏
  let cleared = 0;
  for (let r = 0; r < MATCH3_ROWS; r++) {
    for (let c = 0; c < MATCH3_COLS; c++) {
      if (toClear[r][c]) cleared++;
    }
  }
  match3Score += cleared * 10;
  if (match3ScoreEl) {
    match3ScoreEl.textContent = `–û—á–∫–∏: ${match3Score}`;
  }

  applyMatchesAnimation(toClear);

  setTimeout(() => {
    // —Ä–µ–∞–ª—å–Ω–æ —á–∏—Å—Ç–∏–º
    for (let r = 0; r < MATCH3_ROWS; r++) {
      for (let c = 0; c < MATCH3_COLS; c++) {
        if (toClear[r][c]) {
          match3Grid[r][c] = null;
        }
      }
    }

    dropAndRefill();
    renderMatch3Grid();
    match3Busy = false;

    // —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Å–º–æ—Ç—Ä–∏–º, –µ—Å—Ç—å –ª–∏ –Ω–æ–≤—ã–µ –º–∞—Ç—á–∏
    resolveMatchesLoop();
  }, 200);
}

function handleMatch3PointerDown(e) {
  if (match3Busy || !match3BoardEl) return;

  const target = e.target.closest('.match3-cell');
  if (!target) return;

  match3PointerId = e.pointerId;
  const r = parseInt(target.dataset.row, 10);
  const c = parseInt(target.dataset.col, 10);
  match3StartCell = { row: r, col: c, x: e.clientX, y: e.clientY };

  target.classList.add('match3-cell--active');
  match3BoardEl.setPointerCapture(e.pointerId);
}

function handleMatch3PointerUp(e) {
  if (!match3StartCell || match3PointerId !== e.pointerId || !match3BoardEl) return;

  const dx = e.clientX - match3StartCell.x;
  const dy = e.clientY - match3StartCell.y;
  const absX = Math.abs(dx);
  const absY = Math.abs(dy);

  // —É–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–∫—É
  const active = match3BoardEl.querySelector('.match3-cell--active');
  if (active) active.classList.remove('match3-cell--active');

  match3BoardEl.releasePointerCapture(e.pointerId);

  const SWIPE_MIN = 18;
  if (absX < SWIPE_MIN && absY < SWIPE_MIN) {
    // –ø–æ—á—Ç–∏ –Ω–µ –¥–≤–∏–≥–∞–ª –ø–∞–ª—å—Ü–µ–º ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
    match3StartCell = null;
    match3PointerId = null;
    return;
  }

  let targetRow = match3StartCell.row;
  let targetCol = match3StartCell.col;

  if (absX > absY) {
    // –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
    if (dx > 0) targetCol++;
    else        targetCol--;
  } else {
    // –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
    if (dy > 0) targetRow++;
    else        targetRow--;
  }

  // –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü—ã
  if (
    targetRow < 0 || targetRow >= MATCH3_ROWS ||
    targetCol < 0 || targetCol >= MATCH3_COLS
  ) {
    match3StartCell = null;
    match3PointerId = null;
    return;
  }

  trySwapMatch3(match3StartCell.row, match3StartCell.col, targetRow, targetCol);

  match3StartCell = null;
  match3PointerId = null;
}

function trySwapMatch3(r1, c1, r2, c2) {
  if (match3Busy) return;

  // –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Å–æ—Å–µ–¥–Ω–∏–µ
  const dist = Math.abs(r1 - r2) + Math.abs(c1 - c2);
  if (dist !== 1) return;

  // –º–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏
  const tmp = match3Grid[r1][c1];
  match3Grid[r1][c1] = match3Grid[r2][c2];
  match3Grid[r2][c2] = tmp;

  renderMatch3Grid();

  const { hasMatch } = findMatches();
  if (hasMatch) {
    resolveMatchesLoop();
  } else {
    // –æ—Ç–∫–∞—Ç, –µ—Å–ª–∏ –º–∞—Ç—á–µ–π –Ω–µ—Ç
    setTimeout(() => {
      const t = match3Grid[r1][c1];
      match3Grid[r1][c1] = match3Grid[r2][c2];
      match3Grid[r2][c2] = t;
      renderMatch3Grid();
    }, 120);
  }
}

if (match3BoardEl) {
  match3BoardEl.addEventListener('pointerdown', handleMatch3PointerDown);
  match3BoardEl.addEventListener('pointerup',   handleMatch3PointerUp);
}

function openMatch3Overlay() {
  if (!match3Overlay) return;

  match3Score    = 0;
  match3TimeLeft = 60;
  if (match3ScoreEl) match3ScoreEl.textContent = '–û—á–∫–∏: 0';
  if (match3TimerEl) match3TimerEl.textContent = '–û—Å—Ç–∞–ª–æ—Å—å: 60 c';
  if (match3StatusEl) {
    match3StatusEl.textContent =
      '–°–¥–µ–ª–∞–π –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –∑–∞ 60 —Å–µ–∫—É–Ω–¥.';
  }

  createMatch3Grid();
  renderMatch3Grid();
  match3Overlay.style.display = 'flex';

  if (match3TimerId) clearInterval(match3TimerId);
  match3TimerId = setInterval(() => {
    match3TimeLeft--;
    if (match3TimerEl) {
      match3TimerEl.textContent = `–û—Å—Ç–∞–ª–æ—Å—å: ${match3TimeLeft} c`;
    }
    if (match3TimeLeft <= 0) {
      endMatch3Game();
    }
  }, 1000);
}

function closeMatch3Overlay() {
  if (match3Overlay) match3Overlay.style.display = 'none';
  if (match3TimerId) {
    clearInterval(match3TimerId);
    match3TimerId = null;
  }
}

if (match3BackBtn) {
  match3BackBtn.addEventListener('click', () => {
    endMatch3Game(true); // –≤—ã—Ö–æ–¥ –±–µ–∑ –Ω–∞–≥—Ä–∞–¥—ã
  });
}

function endMatch3Game(skipReward) {
  if (match3TimerId) {
    clearInterval(match3TimerId);
    match3TimerId = null;
  }

  if (!skipReward && petData && petData.name) {
    // –ü—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º—É–ª–∞: 1 XP –∑–∞ –∫–∞–∂–¥—ã–µ 50 –æ—á–∫–æ–≤
    const xpGain = Math.max(1, Math.floor(match3Score / 50));
    const moodGain = Math.min(15, Math.floor(match3Score / 40));

    petData.xp     = (petData.xp || 0) + xpGain;
    petData.mood   = Math.min(100, petData.mood + moodGain);
    petData.energy = Math.max(0,  petData.energy - 10);
    petData.hunger = Math.max(0,  (petData.hunger || 0) - 8);
    petData.lastUpdateAt = Date.now();

    const info = calcPetLevelFromXp(petData.xp || 0);
    petData.level = info.level;
    savePet();
    updatePetUI();

    if (match3StatusEl) {
      match3StatusEl.textContent =
        `–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞: ${match3Score} –æ—á–∫–æ–≤. Fluffie –ø–æ–ª—É—á–∏–ª +${xpGain} XP –∏ +${moodGain} –∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é üéÆ`;
    }
  }

  setTimeout(() => {
    closeMatch3Overlay();
  }, 600);
}

// === PET MATCH-3 DOM ===
const petGameOverlay   = document.getElementById('pet-game-overlay');
const petGameBackBtn   = document.getElementById('pet-game-back');
const petGameGridEl    = document.getElementById('pet-game-grid');
const petGameScoreEl   = document.getElementById('pet-game-score');
const petGameTimerEl   = document.getElementById('pet-game-timer');
const petGameNoteEl    = document.getElementById('pet-game-note');

  function hideSplash() {
  if (!splashEl) return;

  // –ø–ª–∞–≤–Ω–æ –ø—Ä—è—á–µ–º (–∫–ª–∞—Å—Å .splash-hide —É–∂–µ –µ—Å—Ç—å –≤ CSS –≤—ã—à–µ)
  splashEl.classList.add('splash-hide');

  // –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–±–∏—Ä–∞–µ–º –∏–∑ –ø–æ—Ç–æ–∫–∞
  setTimeout(() => {
    if (splashEl) splashEl.style.display = 'none';
  }, 400);
}

// —É–±–∏—Ä–∞–µ–º —Å–ø–ª—ç—à –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM –∏–ª–∏ —á–µ—Ä–µ–∑ –∑–∞–ø–∞—Å–Ω–æ–π —Ç–∞–π–º–µ—Ä
function initSplashHide() {
  // 1) –µ—Å–ª–∏ DOM –≥–æ—Ç–æ–≤ ‚Äî –ø—Ä—è—á–µ–º
  if (document.readyState === 'complete' || document.readyState === 'interactive') {
    hideSplash();
  } else {
    window.addEventListener('load', hideSplash);
    document.addEventListener('DOMContentLoaded', hideSplash);
  }

  // 2) –∑–∞–ø–∞—Å–Ω–æ–π —Ç–∞–π–º–µ—Ä (–µ—Å–ª–∏ WebView –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç load)
  setTimeout(() => {
    hideSplash();
  }, 2500); // —á–µ—Ä–µ–∑ 2.5 —Å–µ–∫—É–Ω–¥—ã –º–∞–∫—Å–∏–º—É–º —Å–∫—Ä—ã–≤–∞–µ–º
}

initSplashHide();

  function vibrate(ms) {
    if (navigator && navigator.vibrate) navigator.vibrate(ms);
  }

// === TAP-TAP DOM ===
const taptapOverlay  = document.getElementById('taptap-overlay');
const taptapBackBtn  = document.getElementById('taptap-back');
const taptapBoardEl  = document.getElementById('taptap-board');
const taptapTimerEl  = document.getElementById('taptap-timer');
const taptapScoreEl  = document.getElementById('taptap-score');
const taptapStatusEl = document.getElementById('taptap-status');
const miniOpenTapTapBtn = document.getElementById('mini-open-taptap');

  // === STORAGE ===
const STORAGE_KEY_BALANCE  = 'owy_balance_v1';
const STORAGE_KEY_PROFILE  = 'owy_profile_info_v1';
const STORAGE_KEY_STATS    = 'owy_stats_v1';
const STORAGE_KEY_PET      = 'owy_pet_v1'; // üêæ
const STORAGE_KEY_CURRENCY = 'owy_currency_v1';

const CURRENCIES = {
  USD: { symbol: '$', rate: 1 },
  EUR: { symbol: '‚Ç¨', rate: 0.92 },
  RUB: { symbol: '‚ÇΩ', rate: 90 }
};

let currentCurrency = 'USD';
let demoBalance = 1000;

  function loadBalance() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY_BALANCE);
      const val = parseInt(raw, 10);
      if (!isNaN(val) && val >= 0) demoBalance = val;
    } catch (e) { demoBalance = 1000; }
  }

  function saveBalance() {
    try { localStorage.setItem(STORAGE_KEY_BALANCE, String(demoBalance)); } catch (e) {}
  }

function loadCurrency() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY_CURRENCY);
    if (raw && CURRENCIES[raw]) {
      currentCurrency = raw;
    }
  } catch (e) {}

  if (balanceCurrencySelect) {
    balanceCurrencySelect.value = currentCurrency;
  }
}

function saveCurrency() {
  try {
    localStorage.setItem(STORAGE_KEY_CURRENCY, currentCurrency);
  } catch (e) {}
}

function updateBalanceView() {
  // –±–∞–∑–æ–≤—ã–π –±–∞–ª–∞–Ω—Å —Å—á–∏—Ç–∞–µ–º –≤ –¥–æ–ª–ª–∞—Ä–∞—Ö: 100 OWY = 1.00$
  const baseUsd = demoBalance / 100;
  const cfg = CURRENCIES[currentCurrency] || CURRENCIES.USD;
  const amount = baseUsd * cfg.rate;

  const mainText = amount.toLocaleString('en-US', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  }) + ' ' + cfg.symbol;

  const owyText = demoBalance.toLocaleString('ru-RU') + ' OWY';

  // —Ç–æ–ø-–±–∞—Ä –∏ –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–∞–Ω—Å –≤ –ø–æ–ø–∞–ø–µ
  if (balanceEl)        balanceEl.textContent       = mainText;
  if (balanceMainUsdEl) balanceMainUsdEl.textContent = mainText;

  // –±–æ–Ω—É—Å–Ω—ã–π –±–∞–ª–∞–Ω—Å ‚Äî —á–∏—Å—Ç–æ OWY Coins
  if (balanceBonusOwyEl) balanceBonusOwyEl.textContent = owyText;

  // –≤ –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º OWY
  if (profileBalanceEl) profileBalanceEl.textContent = owyText;
}

if (balanceCurrencySelect) {
  balanceCurrencySelect.addEventListener('change', (e) => {
    const val = e.target.value;
    if (CURRENCIES[val]) {
      currentCurrency = val;
      saveCurrency();
      updateBalanceView();
    }
  });
}

  // === PROFILE / STATS ===
  let profileData = { name: "", username: "", birthdate: "", gender: "" };

  function loadProfileInfo() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY_PROFILE);
      if (raw) profileData = { ...profileData, ...JSON.parse(raw) };
    } catch (e) {}
  }

  function saveProfileInfo() {
    try { localStorage.setItem(STORAGE_KEY_PROFILE, JSON.stringify(profileData)); } catch (e) {}
  }

  let stats = { rushPlays: 0, plinkoPlays: 0, hiloPlays: 0, bestMulti: 1.0, xp: 0 };

  function loadStats() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY_STATS);
      if (raw) stats = { ...stats, ...JSON.parse(raw) };
    } catch (e) {}
  }

  function saveStats() {
    try { localStorage.setItem(STORAGE_KEY_STATS, JSON.stringify(stats)); } catch (e) {}
  }

  function calcRank(xp) {
    if (xp < 100)  return 'BRONZE I';
    if (xp < 200)  return 'BRONZE II';
    if (xp < 400)  return 'SILVER I';
    if (xp < 700)  return 'SILVER II';
    if (xp < 1100) return 'GOLD I';
    return 'OWY ELITE';
  }

  function calcXpProgress(xp) {
    const level  = Math.floor(xp / 100);
    const start  = level * 100;
    const end    = start + 100;
    const within = Math.min(Math.max(xp - start, 0), 100);
    return { label: `${xp} / ${end} XP`, percent: (within / 100) * 100 };
  }

  function updateStatsView() {
    if (statsRowEl) {
          statsRowEl.textContent =
        `Rush: ${stats.rushPlays} –∏–≥—Ä ‚Ä¢ Plinko: ${stats.plinkoPlays} –∏–≥—Ä ‚Ä¢ HiLo: ${stats.hiloPlays || 0} –∏–≥—Ä ‚Ä¢ –õ—É—á—à–∏–π –º–Ω–æ–∂–∏—Ç–µ–ª—å: x${stats.bestMulti.toFixed(2)}`;
    }

    const rank = calcRank(stats.xp);
    if (rankLabelEl) rankLabelEl.textContent = rank;

    const prog = calcXpProgress(stats.xp);
    if (xpLabelEl)   xpLabelEl.textContent = prog.label;
    if (xpBarFillEl) xpBarFillEl.style.width = `${prog.percent}%`;

    const m1Done = stats.rushPlays   >= 5;
    const m2Done = stats.plinkoPlays >= 3;
    const m3Done = stats.rushPlays > 0 && stats.plinkoPlays > 0;

    if (mission1El) {
      mission1El.firstElementChild.textContent = m1Done ? "‚úÖ" : "‚¨ú";
      mission1El.classList.toggle('mission-done', m1Done);
    }
    if (mission2El) {
      mission2El.firstElementChild.textContent = m2Done ? "‚úÖ" : "‚¨ú";
      mission2El.classList.toggle('mission-done', m2Done);
    }
    if (mission3El) {
      mission3El.firstElementChild.textContent = m3Done ? "‚úÖ" : "‚¨ú";
      mission3El.classList.toggle('mission-done', m3Done);
    }
  }

  function initProfile() {
    if (tgUser && profileIdEl) profileIdEl.textContent = tgUser.id;
    else if (profileIdEl)      profileIdEl.textContent = "‚Äî";

    if (!profileData.name) {
      if (tgUser) {
        const name = (tgUser.first_name || '') +
          (tgUser.last_name ? (' ' + tgUser.last_name) : '');
        profileData.name = name || '–ò–≥—Ä–æ–∫ OWY';
        if (!profileData.username && tgUser.username) {
          profileData.username = '@' + tgUser.username;
        }
      } else {
        profileData.name = 'Demo –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
      }
    }

    if (profileNameInput)     profileNameInput.value     = profileData.name || '';
    if (profileUsernameInput) profileUsernameInput.value = profileData.username || '';
    if (profileBirthInput)    profileBirthInput.value    = profileData.birthdate || '';
    if (profileGenderSelect)  profileGenderSelect.value  = profileData.gender || '';
  }

  if (profileSaveBtn) {
    profileSaveBtn.addEventListener('click', () => {
      profileData.name      = (profileNameInput.value || '').trim();
      profileData.username  = (profileUsernameInput.value || '').trim();
      profileData.birthdate = profileBirthInput.value;
      profileData.gender    = profileGenderSelect.value;
      saveProfileInfo();
      if (profileNoteEl) {
        profileNoteEl.textContent = "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úî –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ —É —Ç–µ–±—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.";
      }
    });
  }

  if (profileResetBtn) {
    profileResetBtn.addEventListener('click', () => {
      demoBalance = 1000;
      saveBalance();
      updateBalanceView();
    });
  }

  if (profileTopupBtn) {
    profileTopupBtn.addEventListener('click', () => {
      demoBalance += 500;
      saveBalance();
      updateBalanceView();
      if (profileNoteEl) profileNoteEl.textContent = "–î–æ–∫–∏–Ω—É–ª–æ +500 OWY –¥–ª—è —Ç–µ—Å—Ç–∞ üí∏";
    });
  }

  if (profileFeedbackBtn) {
    profileFeedbackBtn.addEventListener('click', () => {
      const link = "https://t.me/arhipovvv";
      if (tg && tg.openTelegramLink) tg.openTelegramLink(link);
      else window.open(link, "_blank");
    });
  }

  // === PET / FLUFFIE ===

// === PET / FLUFFIE ===

function calcPetLevelFromXp(totalXp) {
  const maxLevel = 30;

  let xpLeft   = Math.max(0, Math.floor(totalXp || 0));
  let level    = 1;
  let xpToNext = 40; // XP –Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥ 1‚Üí2

  // –∫–∞–∂–¥—ã–π —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å –¥–æ—Ä–æ–∂–µ
  while (level < maxLevel && xpLeft >= xpToNext) {
    xpLeft   -= xpToNext;
    level    += 1;
    xpToNext = Math.floor(xpToNext * 1.35 + 10);
  }

  return {
    level,
    xpInLevel: xpLeft,
    xpToNext: level >= maxLevel ? null : xpToNext
  };
}

let petData = {
  name: '',
  gender: 'male', // male | female
  color: 'purple', // purple | green | black
  mood: 80,    // 0..100
  energy: 80,  // 0..100
  hunger: 70,  // 0..100 (0 ‚Äî –≥–æ–ª–æ–¥–µ–Ω)
  xp: 0,       // –æ–±—â–∏–π XP –ø–∏—Ç–æ–º—Ü–∞
  level: 1,
  createdAt: null,
  lastUpdateAt: null
};

    function loadPet() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY_PET);
      if (raw) {
        petData = { ...petData, ...JSON.parse(raw) };
      }
    } catch (e) {}

    // –¥–µ—Ñ–æ–ª—Ç—ã –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
    if (typeof petData.hunger !== 'number') petData.hunger = 70;
    if (typeof petData.xp     !== 'number') petData.xp     = 0;

    const lvlInfo = calcPetLevelFromXp(petData.xp);
    petData.level = lvlInfo.level;

    updatePetUI();
  }

function getPetBonus() {
  if (!petData.name) return 0;

  const lvlInfo = calcPetLevelFromXp(petData.xp || 0);
  const level   = lvlInfo.level;
  const mood    = petData.mood || 0;
  const hunger  = (petData.hunger != null ? petData.hunger : 70);

  // –±–∞–∑–æ–≤—ã–π –±–æ–Ω—É—Å –æ—Ç —É—Ä–æ–≤–Ω—è
  let base = 0;
  if (level >= 3)  base += 0.01;
  if (level >= 7)  base += 0.02;
  if (level >= 12) base += 0.03;
  if (level >= 20) base += 0.04;
  if (level >= 28) base += 0.05;

  // –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
  if (mood >= 90)      base += 0.01;
  else if (mood < 40)  base -= 0.005;

  // –µ—Å–ª–∏ –≥–æ–ª–æ–¥–µ–Ω ‚Äî —Å–ª–µ–≥–∫–∞ —Ä–µ–∂–µ–º –±–æ–Ω—É—Å
  if (hunger < 30) base -= 0.01;

  // –ù–ò–ö–û–ì–î–ê –Ω–µ –¥–∞—ë–º –º–∏–Ω—É—Å –∫ –≤—ã–∏–≥—Ä—ã—à—É
  if (base < 0)    base = 0;
  if (base > 0.12) base = 0.12; // –º–∞–∫—Å–∏–º—É–º +12%

  return base;
}

function applyPetDecay() {
  if (!petData.name || !petData.lastUpdateAt) return;

  const now     = Date.now();
  const diffMs  = now - petData.lastUpdateAt;
  const minutes = diffMs / 60000;

  if (minutes < 1) return;

  const moodPerHour    = 4; // -4/—á
  const energyPerHour  = 3; // -3/—á
  const hungerPerHour  = 2; // -2/—á

  const moodDelta   = (moodPerHour   / 60) * minutes;
  const energyDelta = (energyPerHour / 60) * minutes;
  const hungerDelta = (hungerPerHour / 60) * minutes;

  petData.mood   = Math.max(0, petData.mood   - moodDelta);
  petData.energy = Math.max(0, petData.energy - energyDelta);
  petData.hunger = Math.max(0, (petData.hunger || 0) - hungerDelta);

  petData.lastUpdateAt = now;
  savePet();
  updatePetUI();
}

  function savePet() {
    try {
      localStorage.setItem(STORAGE_KEY_PET, JSON.stringify(petData));
    } catch (e) {}
  }

  function getColorLabel(color) {
    if (color === 'green') return '–ó–µ–ª—ë–Ω—ã–π Fluffie';
    if (color === 'black') return '–ù–æ—á–Ω–æ–π Fluffie';
    return '–§–∏–æ–ª–µ—Ç–æ–≤—ã–π Fluffie';
  }

  function getColorImage(color) {
    if (color === 'green') return 'greenfluffie.png';
    if (color === 'black') return 'blackfluffie.png';
    return 'purplefluffie.png';
  }

  function updatePetUI() {
    if (!petEmptyStateEl || !petMainStateEl) return;

    const hasPet = !!petData.name;

    if (!hasPet) {
      petEmptyStateEl.style.display = '';
      petMainStateEl.style.display  = 'none';
      return;
    }

    petEmptyStateEl.style.display = 'none';
    petMainStateEl.style.display  = '';

    // —É—Ä–æ–≤–µ–Ω—å –∏–∑ –æ–±—â–µ–≥–æ XP
    const lvlInfo = calcPetLevelFromXp(petData.xp || 0);
    petData.level = lvlInfo.level;

    // –∏–º—è –∏ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
    if (petNameLabelEl) petNameLabelEl.textContent = petData.name;
    if (petSubLabelEl) {
      petSubLabelEl.textContent =
        `${getColorLabel(petData.color)} ‚Ä¢ LVL ${petData.level}`;
    }

    // –∫–∞—Ä—Ç–∏–Ω–∫–∞
    if (petImageEl) {
      petImageEl.src = getColorImage(petData.color);
    }

    // –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ / —ç–Ω–µ—Ä–≥–∏—è / —Å—ã—Ç–æ—Å—Ç—å
    const mood   = Math.max(0, Math.min(100, petData.mood));
    const energy = Math.max(0, Math.min(100, petData.energy));
    const hunger = Math.max(0, Math.min(100, petData.hunger || 0)); // 0 ‚Äî –≥–æ–ª–æ–¥–µ–Ω

    if (petMoodFillEl)   petMoodFillEl.style.width   = mood   + '%';
    if (petEnergyFillEl) petEnergyFillEl.style.width = energy + '%';
    if (petHungerFillEl) petHungerFillEl.style.width = hunger + '%';

    // —á–∏–ø –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
    let moodEmoji = 'üòä';
    if (mood < 30) moodEmoji = 'üò¢';
    else if (mood < 60) moodEmoji = 'üòê';
    else if (mood > 90) moodEmoji = 'ü§©';

    if (petMoodChipEl) {
      petMoodChipEl.textContent = `–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: ${moodEmoji}`;
    }

    // XP –±–∞—Ä
    if (petXpLabelEl) {
      if (lvlInfo.xpToNext === null) {
        petXpLabelEl.textContent = `${petData.xp} XP ‚Ä¢ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å`;
      } else {
        petXpLabelEl.textContent =
          `${lvlInfo.xpInLevel} / ${lvlInfo.xpToNext} XP –¥–æ LVL ${petData.level + 1}`;
      }
    }

    if (petXpFillEl) {
      if (lvlInfo.xpToNext === null) {
        petXpFillEl.style.width = '100%';
      } else {
        const perc = Math.max(0, Math.min(100,
          (lvlInfo.xpInLevel / lvlInfo.xpToNext) * 100
        ));
        petXpFillEl.style.width = perc + '%';
      }
    }

    // –ë–æ–Ω—É—Å –∫ –≤—ã–∏–≥—Ä—ã—à—É
    if (petBonusBadgeEl) {
      const bonus = getPetBonus();
      const pct   = Math.round(bonus * 1000) / 10; // 0.1%
      petBonusBadgeEl.textContent =
        `–ë–æ–Ω—É—Å –∫ –≤—ã–∏–≥—Ä—ã—à—É: +${pct.toFixed(1)}%`;
    }

    // —Ç–µ–∫—Å—Ç–æ–≤–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞
    if (petNoteEl) {
      if (hunger < 25) {
        petNoteEl.textContent = `${petData.name} –æ—á–µ–Ω—å –≥–æ–ª–æ–¥–µ–Ω. –ü–æ–∫–æ—Ä–º–∏ –µ–≥–æ —Å–∫–æ—Ä–µ–µ üç™`;
      } else if (mood < 30) {
        petNoteEl.textContent = `${petData.name} –≥—Ä—É—Å—Ç–∏—Ç. –ü–æ–∏–≥—Ä–∞–π —Å –Ω–∏–º –∏–ª–∏ –ø–æ–∫–æ—Ä–º–∏.`;
      } else if (energy < 30) {
        petNoteEl.textContent = `${petData.name} —É—Å—Ç–∞–ª. –û—Ç–ø—Ä–∞–≤—å –µ–≥–æ –ø–æ—Å–ø–∞—Ç—å üò¥`;
      } else {
        petNoteEl.textContent =
          `${petData.name} —á—É–≤—Å—Ç–≤—É–µ—Ç —Å–µ–±—è –æ—Ç–ª–∏—á–Ω–æ ‚ú® LVL ${petData.level}`;
      }
    }
  }

  // –≤—ã–±–æ—Ä –ø–æ–ª–∞
  if (petGenderBtns && petGenderBtns.length) {
    petGenderBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        petGenderBtns.forEach(b => b.classList.remove('pet-gender-active'));
        btn.classList.add('pet-gender-active');
        petData.gender = btn.dataset.gender || 'male';
      });
    });
  }

  // –≤—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
  if (petColorPills && petColorPills.length) {
    petColorPills.forEach(pill => {
      pill.addEventListener('click', () => {
        petColorPills.forEach(p => p.classList.remove('pet-color-active'));
        pill.classList.add('pet-color-active');
        petData.color = pill.dataset.color || 'purple';
      });
    });
  }

  // —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∏—Ç–æ–º—Ü–∞
if (petCreateBtn) {
  petCreateBtn.addEventListener('click', () => {
     const name = (petNameInput.value || '').trim();
    if (!name) {
      if (petNoteEl) petNoteEl.textContent = '–î–∞–π –∏–º—è —Å–≤–æ–µ–º—É Fluffie üôÇ';
      vibrate(40);
      return;
    }
    const now = Date.now();

    petData.name   = name;
    petData.mood   = 85;
    petData.energy = 85;
    petData.hunger = 80;
    petData.xp     = 0;
    petData.level  = 1;
    petData.createdAt    = now;
    petData.lastUpdateAt = now;

    savePet();
    updatePetUI();
    vibrate(70);
  });
}

  // –¥–µ–π—Å—Ç–≤–∏—è —Å –ø–∏—Ç–æ–º—Ü–µ–º
if (petActionBtns && petActionBtns.length) {
  petActionBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      if (!petData.name) return;

      const action = btn.dataset.action;

      if (action === 'feed') {
        petData.hunger = Math.min(100, (petData.hunger || 0) + 20);
        petData.mood   = Math.min(100, petData.mood + 8);
        petData.energy = Math.min(100, petData.energy + 10);
        petData.xp     = (petData.xp || 0) + 3;
      } else if (action === 'play') {
        // –¢–ï–ü–ï–†–¨ –¢–û–õ–¨–ö–û –û–¢–ö–†–´–í–ê–ï–ú –ú–ï–ù–Æ –ú–ò–ù–ò-–ò–ì–†
        openMiniOverlay();
        return; // –¥–∞–ª—å—à–µ –Ω–µ —Ç—Ä–æ–≥–∞–µ–º —Å—Ç–∞—Ç—ã –∏ savePet ‚Äî —Å–¥–µ–ª–∞–µ–º —ç—Ç–æ –ø–æ—Å–ª–µ –∏–≥—Ä—ã
      } else if (action === 'rest') {
        petData.energy = Math.min(100, petData.energy + 20);
        petData.mood   = Math.max(0,  petData.mood - 3);
        petData.hunger = Math.max(0,  (petData.hunger || 0) - 4);
        petData.xp     = (petData.xp || 0) + 2;
      }

      const info = calcPetLevelFromXp(petData.xp || 0);
      petData.level = info.level;
      petData.lastUpdateAt = Date.now();

      if (petImageEl) {
        petImageEl.classList.remove('pet-bounce');
        void petImageEl.offsetWidth;
        petImageEl.classList.add('pet-bounce');
      }

      savePet();
      updatePetUI();
      vibrate(40);
    });
  });
}

  function openPetShop() {
    if (!petShopOverlay) return;
    petShopOverlay.style.display = 'flex';
    if (petShopNoteEl) {
      petShopNoteEl.textContent = '–ö—É–ø–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å –≤–∫—É—Å–Ω–æ–µ –¥–ª—è Fluffie üç™';
    }
  }

  function closePetShop() {
    if (!petShopOverlay) return;
    petShopOverlay.style.display = 'none';
  }

  function handlePetShopBuy(item) {
    if (!petData.name) {
      if (petShopNoteEl) {
        petShopNoteEl.textContent =
          '–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π –ø–∏—Ç–æ–º—Ü–∞, –∞ –ø–æ—Ç–æ–º —É–∂–µ –±–∞–ª—É–π –µ–≥–æ –ø–æ–∫—É–ø–∫–∞–º–∏ üôÇ';
      }
      vibrate(40);
      return;
    }

    let cost = 0;
    let mood = 0, energy = 0, hunger = 0, xp = 0;
    let itemLabel = '';

    if (item === 'cookie') {
      cost = 20;
      hunger = +15;
      mood   = +5;
      xp     = 3;
      itemLabel = '–ø–µ—á–µ–Ω—å–∫—É';
    } else if (item === 'energy') {
      cost = 35;
      energy = +25;
      hunger = -5;
      xp     = 4;
      itemLabel = '—ç–Ω–µ—Ä–≥–µ—Ç–∏–∫';
    } else if (item === 'gift') {
      cost = 50;
      mood = +20;
      xp   = 8;
      itemLabel = '–ø–æ–¥–∞—Ä–æ–∫';
    } else {
      return;
    }

    if (demoBalance < cost) {
      if (petShopNoteEl) {
        petShopNoteEl.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ OWY –¥–ª—è —ç—Ç–æ–π –ø–æ–∫—É–ø–∫–∏ üòî';
      }
      vibrate(40);
      return;
    }

    // —Å–ø–∏—Å—ã–≤–∞–µ–º –¥–µ–º–æ-–±–∞–ª–∞–Ω—Å
    demoBalance -= cost;
    saveBalance();
    updateBalanceView();

    if (balanceEl && balancePopup) {
  balanceEl.parentElement.style.cursor = 'pointer'; // –≤—Å—è –ø–∏–ª—é–ª—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞
  balanceEl.parentElement.addEventListener('click', () => {
    balancePopup.style.display = 'flex';
  });
}

if (balancePopupClose && balancePopup) {
  balancePopupClose.addEventListener('click', () => {
    balancePopup.style.display = 'none';
  });

  // –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
  balancePopup.addEventListener('click', (e) => {
    if (e.target === balancePopup) {
      balancePopup.style.display = 'none';
    }
  });
}

    // –ø—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –∫ Fluffie
    petData.mood   = Math.max(0, Math.min(100, petData.mood + mood));
    petData.energy = Math.max(0, Math.min(100, petData.energy + energy));
    petData.hunger = Math.max(0, Math.min(100, (petData.hunger || 0) + hunger));
    petData.xp     = (petData.xp || 0) + xp;

    const lvlInfo = calcPetLevelFromXp(petData.xp || 0);
    petData.level      = lvlInfo.level;
    petData.lastUpdateAt = Date.now();

    savePet();
    updatePetUI();

    // –æ–±—â–∏–π XP –ø—Ä–æ—Ñ–∏–ª—è —Å–ª–µ–≥–∫–∞ –ø–æ–¥—Ä–∞—Å—Ç—ë—Ç —Ç–æ–∂–µ
    stats.xp += Math.max(1, xp);
    saveStats();
    updateStatsView();

    if (petShopNoteEl) {
      petShopNoteEl.textContent =
        `${petData.name} –ø–æ–ª—É—á–∏–ª ${itemLabel}! XP +${xp}, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ/—ç–Ω–µ—Ä–≥–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã ‚ú®`;
    }
    vibrate(60);
  }

// —Å–±—Ä–æ—Å –ø–∏—Ç–æ–º—Ü–∞
if (petResetBtn) {
  petResetBtn.addEventListener('click', () => {
    petData = {
      name: '',
      gender: 'male',
      color: 'purple',
      mood: 80,
      energy: 80,
      hunger: 70,
      xp: 0,
      level: 1,
      createdAt: null,
      lastUpdateAt: null
    };

    savePet();
    updatePetUI();
    if (petNoteEl) {
      petNoteEl.textContent = '–ü–∏—Ç–æ–º–µ—Ü —Å–±—Ä–æ—à–µ–Ω. –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ Fluffie.';
    }
  });
}

// –º–∞–≥–∞–∑–∏–Ω Fluffie
if (petShopOpenBtn) {
  petShopOpenBtn.addEventListener('click', () => {
    openPetShop();
    vibrate(30);
  });
}

if (petShopCloseBtn) {
  petShopCloseBtn.addEventListener('click', () => {
    closePetShop();
    vibrate(20);
  });
}

if (petShopBuyBtns && petShopBuyBtns.length) {
  petShopBuyBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const item = btn.dataset.item;
      handlePetShopBuy(item);
    });
  });
}

    // === NAV ===
  function setActiveTab(tab) {
    if (!homeScreen || !profileScreen || !petScreen) return;

    // —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–æ–≤
    [navCasino, navBets, navTasks, navPet].forEach(el => {
      if (!el) return;
      el.classList.remove('active');
    });

    // —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
    homeScreen.style.display    = 'none';   // Casino
    profileScreen.style.display = 'none';   // –≤—Ä–µ–º–µ–Ω–Ω–æ –∏ –¥–ª—è Bets, –∏ –¥–ª—è Tasks
    petScreen.style.display     = 'none';   // Fluffie

    if (tab === 'casino') {
      navCasino.classList.add('active');
      homeScreen.style.display = '';
    } else if (tab === 'bets') {
      navBets.classList.add('active');
      profileScreen.style.display = '';
    } else if (tab === 'tasks') {
      navTasks.classList.add('active');
      profileScreen.style.display = '';
    } else if (tab === 'pet') {
      navPet.classList.add('active');
      petScreen.style.display = '';
    }
  }

  if (navCasino) navCasino.addEventListener('click', () => setActiveTab('casino'));
  if (navBets) {
  navBets.addEventListener('click', () => {
    showComingSoon();
  });
}
  if (navTasks) {
  navTasks.addEventListener('click', () => {
    showComingSoon();
  });
}
  if (navPet)    navPet.addEventListener('click',    () => setActiveTab('pet'));

  // === HINTS ===
  const hintPhrases = [
    "ü§ñ OWY —Å–æ–≤–µ—Ç: –ø–æ–ø—Ä–æ–±—É–π Rush —Å –Ω–µ–±–æ–ª—å—à–∏–º –∞–≤—Ç–æ–≤—ã–≤–æ–¥–æ–º.",
    "ü§ñ OWY —Å–æ–≤–µ—Ç: Plinko High —Ä–∏—Å–∫ ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≥–æ—Ç–æ–≤ –∫ –±–æ–ª–∏.",
    "ü§ñ OWY —Å–æ–≤–µ—Ç: –Ω–∞—á–Ω–∏ —Å Mid Plinko –∏ –ø–æ—Å–º–æ—Ç—Ä–∏, –∫–∞–∫ —Å—ã–ø–µ—Ç.",
    "ü§ñ OWY —Å–æ–≤–µ—Ç: –Ω–µ –∑–∞–±—ã–≤–∞–π –∑–∞–±—Ä–∞—Ç—å —Ä–∞–Ω—å—à–µ –∫—Ä–∞—à–∞ üòâ",
    "ü§ñ OWY —Å–æ–≤–µ—Ç: —á–µ—Ä–µ–¥—É–π Rush –∏ Plinko, —á—Ç–æ–±—ã –ø—Ä–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏–∫—É."
  ];

function showComingSoon() {
  if (!hintTextEl) return;
  hintTextEl.textContent = '–†–∞–∑–¥–µ–ª —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è üëÄ';
  setTimeout(() => {
    if (hintTextEl.textContent === '–†–∞–∑–¥–µ–ª —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è üëÄ') {
      hintTextEl.textContent = '';
    }
  }, 2000);
}

  function initPhrases() {
    if (!hintTextEl) return;
    hintTextEl.textContent =
      hintPhrases[Math.floor(Math.random() * hintPhrases.length)];
  }

  // === DOUBLE GLOBAL ENGINE ===

    const DOUBLE_SLOTS = [
  'blue','green','blue','green','blue',
  'green','blue','green','blue','green',
  'blue','green','blue','green','orange' // –æ–¥–Ω–∞ –æ—Ä–∞–Ω–∂–µ–≤–∞—è
];

  const DOUBLE_LABELS = {
  blue: '2x',
  green: '2x',
  orange: '14x'
};

  const DOUBLE_MULTIS = {
    blue: 2,
    green: 2,
    orange: 14
  };

  const DOUBLE_BETTING_DURATION = 10; // 10—Å –Ω–∞ —Å—Ç–∞–≤–∫–∏
  const DOUBLE_SPIN_TIME        = 8; // ~10—Å –∫—Ä—É—á–µ–Ω–∏–µ
  const DOUBLE_AFTER_SPIN_DELAY = 3;  // –ø–∞—É–∑–∞ –ø–æ—Å–ª–µ

  let doubleRoundId      = 1;
  let doublePhase        = 'betting'; // betting | spinning | waiting
  let doublePhaseElapsed = 0;

  let doubleResultColor   = 'blue';
  let doubleHistory       = []; // [{color, multi}]
  let doubleHasBet        = false;

  // —Å—Ç–∞–≤–∫–∏ –ø–æ —Ü–≤–µ—Ç–∞–º (–º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ)
  let doubleBets = { blue: 0, green: 0, orange: 0 };

  // –≥–µ–æ–º–µ—Ç—Ä–∏—è –∫–æ–ª–µ—Å–∞
  let doubleCellWidth      = 64;
  let doubleCenterShift    = 0;
  let doubleCurrentIndex   = 20; // –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ –ª–µ–Ω—Ç–µ (float)
  let doubleSpinFromIndex  = doubleCurrentIndex;
  let doubleSpinTargetIndex= doubleCurrentIndex;

  const doubleStatusEl = document.getElementById('double-status');

let doubleWheelInited = false;

 function buildDoubleWheel() {
  if (!doubleWheelStrip) return;
  doubleWheelStrip.innerHTML = '';

  const repeats = 8; // –±—ã–ª–æ 5 ‚Äî –¥–µ–ª–∞–µ–º –ª–µ–Ω—Ç—É —á—É—Ç—å –¥–ª–∏–Ω–Ω–µ–µ
  for (let r = 0; r < repeats; r++) {
    DOUBLE_SLOTS.forEach(color => {
      const cell = document.createElement('div');
      cell.className = 'double-cell ' + color;
      cell.textContent = 'x' + DOUBLE_MULTIS[color];
      doubleWheelStrip.appendChild(cell);
    });
  }

// –ø–æ—Å—á–∏—Ç–∞–ª–∏ —Ä–∞–∑–º–µ—Ä—ã
recalcDoubleGeometry();

const loopLen = DOUBLE_SLOTS.length;

// –≤—Å–µ–≥–¥–∞ –¥–µ—Ä–∂–∏–º —Ç–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å –≤ —Ä–∞–π–æ–Ω–µ 2-–≥–æ –∫—Ä—É–≥–∞,
// —á—Ç–æ–±—ã –±—ã–ª–æ –º–µ—Å—Ç–æ –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å—Å—è –≤–ø–µ—Ä—ë–¥
doubleCurrentIndex    = loopLen * 2;
doubleSpinFromIndex   = doubleCurrentIndex;
doubleSpinTargetIndex = doubleCurrentIndex;
syncDoubleWheel();
 }

function normalizeDoubleIndexToMiddle(idx) {
  const loopLen = DOUBLE_SLOTS.length;
  const middleLoop = 2; // —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π, —á—Ç–æ –≤ buildDoubleWheel
  const local = ((idx % loopLen) + loopLen) % loopLen; // 0..loopLen
  return middleLoop * loopLen + local;
}

  function recalcDoubleGeometry() {
    if (!doubleWheelStrip) return;
    const first = doubleWheelStrip.querySelector('.double-cell');
    if (first) {
      const r = first.getBoundingClientRect();
      doubleCellWidth = r.width + 6; // 6px gap
    }
    const container = doubleWheelStrip.parentElement;
    if (container) {
      doubleCenterShift = container.clientWidth / 2 - doubleCellWidth / 2;
    } else {
      doubleCenterShift = 0;
    }
  }

  function syncDoubleWheel() {
  if (!doubleWheelStrip) return;
  const x = -doubleCurrentIndex * doubleCellWidth + doubleCenterShift;
  doubleWheelStrip.style.transform =
    `translateY(-50%) translateX(${x}px)`;
}

  function chooseRandomDoubleColor() {
    const i = Math.floor(Math.random() * DOUBLE_SLOTS.length);
    return DOUBLE_SLOTS[i];
  }

  function prepareSpinToResult(color) {
    const oneLoop = DOUBLE_SLOTS.length;

    // –≤—Å–µ –∏–Ω–¥–µ–∫—Å—ã —è—á–µ–µ–∫ –Ω—É–∂–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ –≤ –æ–¥–Ω–æ–º –∫—Ä—É–≥–µ
    const indices = [];
    DOUBLE_SLOTS.forEach((c, i) => {
      if (c === color) indices.push(i);
    });
    if (!indices.length) return;

    const localIndex = indices[Math.floor(Math.random() * indices.length)];
    const currentInLoop = ((doubleCurrentIndex % oneLoop) + oneLoop) % oneLoop;

    // —Ö–æ—Ç–∏–º –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –º–∏–Ω–∏–º—É–º 3 –ø–æ–ª–Ω—ã—Ö –∫—Ä—É–≥–∞ –≤–ø–µ—Ä—ë–¥
    const base = doubleCurrentIndex + oneLoop * 3;
    const correction = (localIndex - currentInLoop + oneLoop) % oneLoop;

    doubleSpinFromIndex   = doubleCurrentIndex;
    doubleSpinTargetIndex = base + correction;
  }

  function setDoublePhaseStatus() {
    if (!doubleTimerEl) return;

    if (doublePhase === 'betting') {
  const left = Math.max(0, DOUBLE_BETTING_DURATION - doublePhaseElapsed);
  doubleTimerEl.textContent = `–î–æ —Å–ø–∏–Ω–∞: ${Math.ceil(left)} c`;
    } else if (doublePhase === 'spinning') {
      doubleTimerEl.textContent = '–ö—Ä—É—Ç–∏—Ç—Å—è...';
    } else {
      doubleTimerEl.textContent = '–°–∫–æ—Ä–æ –Ω–æ–≤—ã–π —Ä–∞—É–Ω–¥';
    }
  }

  function updateDoubleButtonsBetsView() {
    if (doubleBtnBlue) {
      let html = DOUBLE_LABELS.blue;
      if (doubleBets.blue > 0) {
        html += `<div class="double-bet-pill">+${doubleBets.blue} OWY</div>`;
      }
      doubleBtnBlue.innerHTML = html;
      doubleBtnBlue.classList.toggle('active', doubleBets.blue > 0);
    }

    if (doubleBtnGreen) {
      let html = DOUBLE_LABELS.green;
      if (doubleBets.green > 0) {
        html += `<div class="double-bet-pill">+${doubleBets.green} OWY</div>`;
      }
      doubleBtnGreen.innerHTML = html;
      doubleBtnGreen.classList.toggle('active', doubleBets.green > 0);
    }

    if (doubleBtnOrange) {
      let html = DOUBLE_LABELS.orange;
      if (doubleBets.orange > 0) {
        html += `<div class="double-bet-pill">+${doubleBets.orange} OWY</div>`;
      }
      doubleBtnOrange.innerHTML = html;
      doubleBtnOrange.classList.toggle('active', doubleBets.orange > 0);
    }
  }

  function updateDoubleHistoryView() {
    if (!doubleHistoryEl) return;
    if (!doubleHistory.length) {
      doubleHistoryEl.textContent = '–ò—Å—Ç–æ—Ä–∏—è: ‚Äî';
      return;
    }
    const last = doubleHistory.slice(-12);
    let html = '–ò—Å—Ç–æ—Ä–∏—è: ';
    last.forEach(item => {
      const label = 'x' + item.multi;
      html += `<span class="double-history-chip ${item.color}">${label}</span>`;
    });
    doubleHistoryEl.innerHTML = html;
  }

  function startNewDoubleRound() {
  doubleRoundId++;
  doublePhase        = 'betting';
  doublePhaseElapsed = 0;
  doubleHasBet       = false;
  doubleBets         = { blue: 0, green: 0, orange: 0 };
  updateDoubleButtonsBetsView();
  setDoublePhaseStatus();
  if (doubleStatusEl) {
    doubleStatusEl.textContent = '–ù–æ–≤—ã–π —Ä–∞—É–Ω–¥ ‚Äî —Å—Ç–∞–≤—å –Ω–∞ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ü–≤–µ—Ç–æ–≤ üôÇ';
  }
}

  function placeDoubleBet(color) {
    if (doublePhase !== 'betting') return;

    const betVal = parseInt(doubleBetInput.value, 10);
    if (isNaN(betVal) || betVal < 10) {
      if (doubleStatusEl) {
        doubleStatusEl.textContent = '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ ‚Äî 10 OWY ü§®';
      }
      return;
    }
    if (betVal > demoBalance) {
      if (doubleStatusEl) {
        doubleStatusEl.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è —Ç–∞–∫–æ–π —Å—Ç–∞–≤–∫–∏ üòî';
      }
      return;
    }

    demoBalance -= betVal;
    saveBalance();
    updateBalanceView();

    doubleBets[color] += betVal;
    doubleHasBet = true;
    updateDoubleButtonsBetsView();

    if (doubleStatusEl) {
      doubleStatusEl.textContent = '–°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞. –ú–æ–∂–Ω–æ –¥–æ–∫–∏–Ω—É—Ç—å –Ω–∞ –¥—Ä—É–≥–∏–µ —Ü–≤–µ—Ç–∞ üëá';
    }
    vibrate(40);
  }

  if (doubleBtnBlue) {
    doubleBtnBlue.addEventListener('click', () => placeDoubleBet('blue'));
  }
  if (doubleBtnGreen) {
    doubleBtnGreen.addEventListener('click', () => placeDoubleBet('green'));
  }
  if (doubleBtnOrange) {
    doubleBtnOrange.addEventListener('click', () => placeDoubleBet('orange'));
  }

  function tickDouble(dt) {
    if (doublePhase === 'betting') {
      doublePhaseElapsed += dt;
      setDoublePhaseStatus();

      if (doublePhaseElapsed >= DOUBLE_BETTING_DURATION) {
        // –Ω–∞—á–∏–Ω–∞–µ–º —Å–ø–∏–Ω
        doublePhase        = 'spinning';
        doublePhaseElapsed = 0;
        doubleResultColor  = chooseRandomDoubleColor();
        prepareSpinToResult(doubleResultColor);
        setDoublePhaseStatus();
      }
      return;
    }

    if (doublePhase === 'spinning') {
      doublePhaseElapsed += dt;
      setDoublePhaseStatus();

      const t = Math.min(doublePhaseElapsed / DOUBLE_SPIN_TIME, 1);
      // easeOutCubic ‚Äî –±—ã—Å—Ç—Ä–æ –≤ –Ω–∞—á–∞–ª–µ, –º–µ–¥–ª–µ–Ω–Ω–æ –≤ –∫–æ–Ω—Ü–µ
      const eased = 1 - Math.pow(1 - t, 3);

      doubleCurrentIndex =
        doubleSpinFromIndex +
        (doubleSpinTargetIndex - doubleSpinFromIndex) * eased;

      syncDoubleWheel();

   if (t >= 1) {
  doublePhase        = 'waiting';
  doublePhaseElapsed = 0;

  const multi = DOUBLE_MULTIS[doubleResultColor];
  doubleHistory.push({ color: doubleResultColor, multi });
  if (doubleHistory.length > 50) doubleHistory.shift();
  updateDoubleHistoryView();

  let baseWin = 0;
  ['blue','green','orange'].forEach(color => {
    const bet = doubleBets[color];
    if (!bet) return;
    if (color === doubleResultColor) {
      baseWin += Math.floor(bet * DOUBLE_MULTIS[color]);
    }
  });

  if (doubleHasBet) {
    stats.xp += 3;
    if (multi > stats.bestMulti) stats.bestMulti = multi;
    saveStats();
    updateStatsView();
  }

  const colorName =
    doubleResultColor === 'orange'
      ? '–æ—Ä–∞–Ω–∂–µ–≤—ã–π'
      : (doubleResultColor === 'blue' ? '—Å–∏–Ω–∏–π' : '–∑–µ–ª—ë–Ω—ã–π');

  if (baseWin > 0) {
    const petBonus   = getPetBonus();
    const bonusWin   = Math.floor(baseWin * petBonus);
    const totalWin   = baseWin + bonusWin;

    demoBalance += totalWin;
    saveBalance();
    updateBalanceView();

    if (doubleStatusEl) {
      if (petBonus > 0) {
        doubleStatusEl.textContent =
          `–í—ã–ø–∞–ª ${colorName} x${multi}. –¢—ã –≤—ã–∏–≥—Ä–∞–ª +${totalWin} OWY (–≤–∫–ª—é—á–∞—è +${bonusWin} –æ—Ç Fluffie üßø)`;
      } else {
        doubleStatusEl.textContent =
          `–í—ã–ø–∞–ª ${colorName} x${multi}. –¢—ã –≤—ã–∏–≥—Ä–∞–ª +${totalWin} OWY üéâ`;
      }
    }
  } else if (doubleHasBet) {
    if (doubleStatusEl) {
      doubleStatusEl.textContent =
        `–í—ã–ø–∞–ª ${colorName} x${multi}. –í—Å–µ —Ç–≤–æ–∏ —Å—Ç–∞–≤–∫–∏ —Å–≥–æ—Ä–µ–ª–∏ üíÄ`;
    }
  } else {
    if (doubleStatusEl) {
      doubleStatusEl.textContent =
        `–í—ã–ø–∞–ª ${colorName} x${multi}. –í —ç—Ç–æ–º —Ä–∞—É–Ω–¥–µ —Ç—ã –Ω–µ —Å—Ç–∞–≤–∏–ª.`;
    }
  }

  // üëâ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∏–Ω–¥–µ–∫—Å, —á—Ç–æ–±—ã –∞–Ω–∏–º–∞—Ü–∏—è –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ä–∞—É–Ω–¥–µ –±—ã–ª–∞ –≥–ª–∞–¥–∫–æ–π
  doubleCurrentIndex    = normalizeDoubleIndexToMiddle(doubleSpinTargetIndex);
  doubleSpinFromIndex   = doubleCurrentIndex;
  doubleSpinTargetIndex = doubleCurrentIndex;
  syncDoubleWheel();

  // –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥ —á–∏—Å—Ç–∏–º —Å—Ç–∞–≤–∫–∏
  doubleBets   = { blue: 0, green: 0, orange: 0 };
  doubleHasBet = false;
  updateDoubleButtonsBetsView();
}
      return;
    }

    if (doublePhase === 'waiting') {
      doublePhaseElapsed += dt;
      setDoublePhaseStatus();
      if (doublePhaseElapsed >= DOUBLE_AFTER_SPIN_DELAY) {
        startNewDoubleRound();
      }
    }
  }

// === HILO ===

const hiloOverlay       = document.getElementById('hilo-overlay');
const hiloOpenBtn       = document.getElementById('hilo-open');   // –±–∞–Ω–Ω–µ—Ä –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
const hiloBackBtn       = document.getElementById('hilo-back');

const hiloRoundLabel    = document.getElementById('hilo-round-label');
const hiloCurrentCardEl = document.getElementById('hilo-current-card');
const hiloNextCardEl    = document.getElementById('hilo-next-card');
const hiloBetInput      = document.getElementById('hilo-bet');
const hiloStatusEl      = document.getElementById('hilo-status');
const hiloOddsLabelEl   = document.getElementById('hilo-odds-label');

const hiloLowBtn        = document.getElementById('hilo-low-btn');
const hiloHighBtn       = document.getElementById('hilo-high-btn');
const hiloCashoutBtn    = document.getElementById('hilo-cashout-btn');

const HILO_RANKS = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
const HILO_SUITS = ['‚ô†','‚ô•','‚ô¶','‚ô£'];

let hiloDeck = [];

function buildHiloDeck() {
  hiloDeck = [];
  for (const suit of HILO_SUITS) {
    for (const rank of HILO_RANKS) {
      hiloDeck.push({ rank, suit });
    }
  }
  // —Ç–∞—Å—É–µ–º –§–∏—à–µ—Ä–æ–º‚Äì–ô–µ–π—Ç—Å–æ–º
  for (let i = hiloDeck.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [hiloDeck[i], hiloDeck[j]] = [hiloDeck[j], hiloDeck[i]];
  }
}

function drawHiloCard() {
  if (!hiloDeck.length) buildHiloDeck();
  return hiloDeck.pop();
}

function rankIndex(card) {
  // –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç ‚Äî —Å–µ—Ä–µ–¥–∏–Ω–∞ –∫–æ–ª–æ–¥—ã (7)
  if (!card) return Math.floor(HILO_RANKS.length / 2);

  const rank = typeof card === 'string' ? card : card.rank;
  const idx = HILO_RANKS.indexOf(rank);

  // –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å—Ç—Ä–∞–Ω–Ω–æ–µ ‚Äî —Ç–æ–∂–µ —Å–µ—Ä–µ–¥–∏–Ω–∞
  return idx === -1 ? Math.floor(HILO_RANKS.length / 2) : idx;
}

function formatHiloCard(card) {
  return card.rank + card.suit;
}

// —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–∏–∏
let hiloCurrentCard = null;
let hiloNextCard    = null;

let hiloInRound     = false;  // –∏–¥—ë—Ç —Å–µ—Ä–∏—è –∏–ª–∏ –Ω–µ—Ç
let hiloIsBusy      = false;  // –∞–Ω–∏–º–∞—Ü–∏—è/—Ö–æ–¥ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
let hiloRound       = 1;      // –Ω–æ–º–µ—Ä —à–∞–≥–∞ –≤ —Å–µ—Ä–∏–∏
let hiloBaseBet     = 0;      // –±–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ —Å–µ—Ä–∏–∏
let hiloTotalMulti  = 1.0;    // –æ–±—â–∏–π –º–Ω–æ–∂–∏—Ç–µ–ª—å —Å–µ—Ä–∏–∏

// === –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–ª—è –∫–Ω–æ–ø–æ–∫ ===

function calcHiloStepMultipliers(rank) {
  const idx = HILO_RANKS.indexOf(rank);
  if (idx === -1) {
    return { low: 1.0, high: 1.0 };
  }

  const total = HILO_RANKS.length; // 13

  // –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å, —á—Ç–æ —Å–ª–µ–¥—É—é—â–∞—è –∫–∞—Ä—Ç–∞ –±—É–¥–µ—Ç <= —Ç–µ–∫—É—â–µ–π
  const pLow  = (idx + 1) / total;
  // –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å, —á—Ç–æ >= —Ç–µ–∫—É—â–µ–π
  const pHigh = (total - idx) / total;

  const edge = 0.96; // house edge

  const lowMulti  = Math.max(1.01, edge / pLow);
  const highMulti = Math.max(1.01, edge / pHigh);

  return { low: lowMulti, high: highMulti };
}

function updateHiloButtonsOdds(currentRank) {
  if (!hiloLowBtn || !hiloHighBtn) return;

  const { low, high } = calcHiloStepMultipliers(currentRank);
  const lowStr  = low.toFixed(2);
  const highStr = high.toFixed(2);

  hiloLowBtn.innerHTML  =
    `–ù–∏–∂–µ / —Ä–∞–≤–Ω–æ<span class="hilo-odd">~x${lowStr}</span>`;
  hiloHighBtn.innerHTML =
    `–í—ã—à–µ / —Ä–∞–≤–Ω–æ<span class="hilo-odd">~x${highStr}</span>`;

  if (hiloOddsLabelEl) {
    hiloOddsLabelEl.textContent =
      `–¢–µ–∫—É—â–∏–π —à–∞–≥: ~x${Math.max(low, high).toFixed(2)} –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –æ—Ç–≤–µ—Ç–µ.`;
  }
}

// —à–∞–≥–æ–≤—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ (high / low)
// –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ —Ç–µ –∂–µ —Ä–∞—Å—á—ë—Ç—ã, —á—Ç–æ –∏ –∫–Ω–æ–ø–∫–∏
function getHiloStepMulti(prediction, card) {
  const rank = card && card.rank ? card.rank : null;
  const { low, high } = calcHiloStepMultipliers(rank || '7'); // –¥–µ—Ñ–æ–ª—Ç ‚Äî —Å–µ—Ä–µ–¥–∏–Ω–∞

  return prediction === 'high' ? high : low;
}

// === UI helper'—ã ===

function updateHiloRoundLabel() {
  if (!hiloRoundLabel) return;
  if (!hiloInRound) {
    hiloRoundLabel.textContent = '–ù–æ–≤—ã–π —Ä–∞—É–Ω–¥';
  } else {
    hiloRoundLabel.textContent = `–†–∞—É–Ω–¥ ${hiloRound}`;
  }
}

function updateHiloCardsUI() {
  if (hiloCurrentCardEl) {
    if (hiloCurrentCard) {
      hiloCurrentCardEl.textContent = formatHiloCard(hiloCurrentCard);
    } else {
      hiloCurrentCardEl.textContent = '‚Äî';
    }
  }
  if (hiloNextCardEl) {
    hiloNextCardEl.textContent = '‚ùî';
  }
}

function updateHiloCashoutBtnLabel() {
  if (!hiloCashoutBtn) return;

  if (!hiloInRound || !hiloBaseBet || hiloTotalMulti <= 1.0) {
    hiloCashoutBtn.textContent = '–ö—ç—à–∞—É—Ç';
    return;
  }

  const baseWin  = Math.floor(hiloBaseBet * hiloTotalMulti);
  const petBonus = typeof getPetBonus === 'function' ? getPetBonus() : 0;
  const bonusWin = Math.floor(baseWin * petBonus);
  const totalWin = baseWin + bonusWin;

  hiloCashoutBtn.textContent = `–ó–∞–±—Ä–∞—Ç—å +${totalWin} OWY`;
}

function resetHiloRoundState() {
  hiloInRound     = false;
  hiloIsBusy      = false;
  hiloRound       = 1;
  hiloBaseBet     = 0;
  hiloTotalMulti  = 1.0;

  // –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –∫–æ–ª–æ–¥–∞ –ø—É—Å—Ç–∞ ‚Äî –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º
  if (!hiloDeck.length) {
    buildHiloDeck();
  }

  // –±–µ—Ä—ë–º –Ω–æ–≤—É—é —Å—Ç–∞—Ä—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É
  hiloCurrentCard = drawHiloCard();
  hiloNextCard = null;

  updateHiloRoundLabel();
  updateHiloCardsUI();

  // –æ–±–Ω–æ–≤–ª—è–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö –ø–æ–¥ –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É
  if (hiloCurrentCard) {
    updateHiloButtonsOdds(hiloCurrentCard.rank);
  }

  updateHiloCashoutBtnLabel();
  if (hiloCashoutBtn) hiloCashoutBtn.disabled = true;
}

// === open / close ===

function openHilo() {
  if (!hiloOverlay) return;
  resetHiloRoundState();
  hiloOverlay.style.display = 'flex';
  if (hiloStatusEl) {
    hiloStatusEl.textContent =
      '–°–¥–µ–ª–∞–π —Å—Ç–∞–≤–∫—É –æ–¥–∏–Ω —Ä–∞–∑, —É–≥–∞–¥—ã–≤–∞–π –∫–∞—Ä—Ç—ã –ø–æ–¥—Ä—è–¥ –∏ –∑–∞–±–µ—Ä–∏ –≤—ã–∏–≥—Ä—ã—à –∫—ç—à–∞—É—Ç–æ–º.';
  }
}

function closeHilo() {
  if (hiloOverlay) hiloOverlay.style.display = 'none';
}

if (hiloOpenBtn) hiloOpenBtn.addEventListener('click', openHilo);
if (hiloBackBtn) hiloBackBtn.addEventListener('click', closeHilo);

// === –æ—Å–Ω–æ–≤–Ω–æ–π —Ö–æ–¥ ===

function playHilo(prediction) {
  if (hiloIsBusy) return;

  let betVal;

  // === —Å—Ç–∞—Ä—Ç –Ω–æ–≤–æ–π —Å–µ—Ä–∏–∏ ===
  if (!hiloInRound) {
    betVal = parseInt(hiloBetInput.value, 10);

    if (isNaN(betVal) || betVal < 10) {
      if (hiloStatusEl) {
        hiloStatusEl.textContent = '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ ‚Äî 10 OWY ü§®';
      }
      return;
    }
    if (betVal > demoBalance) {
      if (hiloStatusEl) {
        hiloStatusEl.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è —ç—Ç–æ–π —Å—Ç–∞–≤–∫–∏ üòî';
      }
      return;
    }

    demoBalance -= betVal;
    saveBalance();
    updateBalanceView();

    hiloBaseBet    = betVal;
    hiloTotalMulti = 1.0;
    hiloRound      = 1;
    hiloInRound    = true;

    if (hiloStatusEl) {
      hiloStatusEl.textContent =
        '–°–µ—Ä–∏—è –Ω–∞—á–∞–ª–∞—Å—å. –£–≥–∞–¥–∞–π, –≤—ã—à–µ –∏–ª–∏ –Ω–∏–∂–µ –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∞—è –∫–∞—Ä—Ç–∞.';
    }
    if (hiloCashoutBtn) hiloCashoutBtn.disabled = true;
  } else {
    // –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å–µ—Ä–∏—é ‚Äî —Å—Ç–∞–≤–∫–∞ —Ç–∞ –∂–µ
    betVal = hiloBaseBet;
  }

  hiloIsBusy = true;

  // –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –µ—Å—Ç—å —Ç–µ–∫—É—â–∞—è –∫–∞—Ä—Ç–∞
  if (!hiloCurrentCard) {
    if (!hiloDeck.length) buildHiloDeck();
    hiloCurrentCard = drawHiloCard();
    updateHiloCardsUI();
  }

  // —Å—á–∏—Ç–∞–µ–º –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä —à–∞–≥–∞
  const stepMulti = getHiloStepMulti(prediction, hiloCurrentCard);
  if (hiloOddsLabelEl) {
    hiloOddsLabelEl.textContent =
      `–¢–µ–∫—É—â–∏–π —à–∞–≥: ~x${stepMulti.toFixed(2)} –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –æ—Ç–≤–µ—Ç–µ.`;
  }
  if (hiloCurrentCard) {
    updateHiloButtonsOdds(hiloCurrentCard.rank);
  }

  // —Ç—è–Ω–µ–º —Å–ª–µ–¥—É—é—â—É—é –∫–∞—Ä—Ç—É
  hiloNextCard = drawHiloCard();

  if (hiloNextCardEl) {
    hiloNextCardEl.classList.add('hilo-card-flip');
    setTimeout(() => {
      hiloNextCardEl.textContent = formatHiloCard(hiloNextCard);
      hiloNextCardEl.classList.remove('hilo-card-flip');
    }, 120);
  }

  // –ø–æ—Å–ª–µ –∫–æ—Ä–æ—Ç–∫–æ–π "–∞–Ω–∏–º–∞—Ü–∏–∏" —Å—á–∏—Ç–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  setTimeout(() => {
    const curIdx  = rankIndex(hiloCurrentCard);
    const nextIdx = rankIndex(hiloNextCard);

    let isWin;
    if (prediction === 'high') {
      isWin = nextIdx >= curIdx; // –≤—ã—à–µ / —Ä–∞–≤–Ω–æ
    } else {
      isWin = nextIdx <= curIdx; // –Ω–∏–∂–µ / —Ä–∞–≤–Ω–æ
    }

    if (isWin) {
      // —Å–µ—Ä–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
      hiloTotalMulti *= stepMulti;
      hiloRound += 1;

      if (hiloStatusEl) {
        hiloStatusEl.textContent =
          `–£–≥–∞–¥–∞–ª! –¢–µ–∫—É—â–∏–π –º–Ω–æ–∂–∏—Ç–µ–ª—å —Å–µ—Ä–∏–∏: x${hiloTotalMulti.toFixed(2)}. ` +
          `–ú–æ–∂–µ—à—å –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∏–ª–∏ –∑–∞–±—Ä–∞—Ç—å.`;
      }

      if (hiloCashoutBtn) {
        hiloCashoutBtn.disabled = false;
      }
      updateHiloCashoutBtnLabel();

      // —Ç–µ–∫—É—â–∞—è –∫–∞—Ä—Ç–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ —á—Ç–æ –æ—Ç–∫—Ä—ã—Ç–æ–π
      hiloCurrentCard = hiloNextCard;
      updateHiloCardsUI();
      if (hiloCurrentCard) {
        updateHiloButtonsOdds(hiloCurrentCard.rank);
      }
    } else {
      // –ø—Ä–æ–∏–≥—Ä—ã—à ‚Äî —Å—Ç–∞–≤–∫–∞ —Å–≥–æ—Ä–µ–ª–∞, —Å–µ—Ä–∏—è –æ–±–Ω—É–ª—è–µ—Ç—Å—è
      if (hiloStatusEl) {
        hiloStatusEl.textContent =
          `–ü—Ä–æ–º–∞—Ö. –°—Ç–∞–≤–∫–∞ ${betVal} OWY —Å–≥–æ—Ä–µ–ª–∞. –ù–∞—á–Ω–∏ –Ω–æ–≤—É—é —Å–µ—Ä–∏—é, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –µ—â—ë —Ä–∞–∑.`;
      }

      stats.xp += 2;
      saveStats();
      updateStatsView();

      // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–∏–≥—Ä—ã—à–Ω—É—é –∫–∞—Ä—Ç—É
      hiloCurrentCard = hiloNextCard;
      updateHiloCardsUI();
      if (hiloCurrentCard) {
        updateHiloButtonsOdds(hiloCurrentCard.rank);
      }

      // —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à–æ–π —Ç–∞–π–º–∞—É—Ç –≥–æ—Ç–æ–≤–∏–º —á–∏—Å—Ç—ã–π –Ω–æ–≤—ã–π —Ä–∞—É–Ω–¥
      setTimeout(() => {
        resetHiloRoundState();
      }, 400);
    }

    hiloIsBusy = false;
  }, 600);
}

// === –∫—ç—à–∞—É—Ç ===

function hiloCashout() {
  if (!hiloInRound || !hiloBaseBet || hiloTotalMulti <= 1.0) return;

  const baseWin  = Math.floor(hiloBaseBet * hiloTotalMulti);
  const petBonus = typeof getPetBonus === 'function' ? getPetBonus() : 0;
  const bonusWin = Math.floor(baseWin * petBonus);
  const totalWin = baseWin + bonusWin;

  demoBalance += totalWin;
  saveBalance();
  updateBalanceView();

  stats.xp += 5;
  if (hiloTotalMulti > stats.bestMulti) {
    stats.bestMulti = hiloTotalMulti;
  }
  saveStats();
  updateStatsView();

  if (hiloStatusEl) {
    if (petBonus > 0 && bonusWin > 0) {
      hiloStatusEl.textContent =
        `–ö—ç—à–∞—É—Ç x${hiloTotalMulti.toFixed(2)} ‚Äî –Ω–∞ –±–∞–ª–∞–Ω—Å +${totalWin} OWY ` +
        `(–≤–∫–ª—é—á–∞—è +${bonusWin} –æ—Ç Fluffie üßø).`;
    } else {
      hiloStatusEl.textContent =
        `–ö—ç—à–∞—É—Ç x${hiloTotalMulti.toFixed(2)} ‚Äî –Ω–∞ –±–∞–ª–∞–Ω—Å +${totalWin} OWY.`;
    }
  }

  resetHiloRoundState();
}

if (hiloLowBtn)  hiloLowBtn.addEventListener('click', () => playHilo('low'));
if (hiloHighBtn) hiloHighBtn.addEventListener('click', () => playHilo('high'));
if (hiloCashoutBtn) hiloCashoutBtn.addEventListener('click', hiloCashout);

// === END HILO ===

  // === RUSH GLOBAL ENGINE ===
  const RUSH_PATH_MAX_MULTI = 10;
  const RUSH_PATH_MAX_X = 220;
  const RUSH_PATH_MAX_Y = 70;

  const RUSH_BETTING_DURATION  = 10; // 10c —Å—Ç–∞–≤–æ–∫
  const RUSH_AFTER_CRASH_DELAY = 3;  // –ø–∞—É–∑–∞ –º–µ–∂–¥—É —Ä–∞—É–Ω–¥–∞–º–∏

  let rushRoundId      = 1;
  let rushPhase        = 'betting'; // betting | running | crashed
  let rushPhaseElapsed = 0;

  let currentMulti = 1.0;
  let crashMulti   = 1.0;

  // —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
  let rushHasActiveBet = false;
  let rushBet          = 0;
  let autoCashout      = null;
  let hasCashedOut     = false;
  let cashedOutAt      = null;

  let crashHistory = [];

  function formatMulti(m) { return 'x' + m.toFixed(2); }

  function resetRushVisual() {
    if (!rushOwyEl) return;
    rushOwyEl.classList.remove('rush-running');
    rushOwyEl.style.transition = 'none';
    rushOwyEl.style.transform  = 'translate(0px, 0px) rotate(0deg)';
    requestAnimationFrame(() => {
      rushOwyEl.style.transition = 'transform 0.07s linear';
    });
  }

  function updateRushVisual() {
    if (!rushOwyEl) return;
    const t = Math.min(currentMulti / RUSH_PATH_MAX_MULTI, 1);
    const x = RUSH_PATH_MAX_X * t;
    const y = RUSH_PATH_MAX_Y * t;
    rushOwyEl.style.transform = `translate(${x}px, -${y}px) rotate(0deg)`;
  }

  function crashRushVisual() {
    const scene = document.querySelector('.rush-scene');
    if (scene) {
      scene.classList.add('flash');
      setTimeout(() => scene.classList.remove('flash'), 400);
    }
    if (!rushOwyEl) return;

    rushOwyEl.classList.remove('rush-running');
    rushOwyEl.style.transition = 'transform 0.35s ease-in';

    const t = Math.min(currentMulti / RUSH_PATH_MAX_MULTI, 1);
    const x = RUSH_PATH_MAX_X * t;
    rushOwyEl.style.transform = `translate(${x}px, 120px) rotate(40deg)`;
  }

  function generateCrashMultiplier() {
    const r = Math.random();
    if (r < 0.05)   return 1.0;
    if (r < 0.25)   return +(Math.random() * (1.25 - 1.01) + 1.01).toFixed(2);
    if (r < 0.60)   return +(Math.random() * (2.5  - 1.25) + 1.25).toFixed(2);
    if (r < 0.85)   return +(Math.random() * (5.0  - 2.5)  + 2.5 ).toFixed(2);
    if (r < 0.95)   return +(Math.random() * (15.0 - 5.0)  + 5.0 ).toFixed(2);
    if (r < 0.985)  return +(Math.random() * (40.0 - 15.0) + 15.0).toFixed(2);
    if (r < 0.998)  return +(Math.random() * (70.0 - 40.0) + 40.0).toFixed(2);
    return            +(Math.random() * (100.0 - 70.0) + 70.0).toFixed(2);
  }

  // —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–æ—Å—Ç–∞ –º–Ω–æ–∂–∏—Ç–µ–ª—è, –∑–∞–≤—è–∑–∞–Ω–Ω–∞—è –Ω–∞ dt (—Å–µ–∫—É–Ω–¥—ã)
// —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–æ—Å—Ç–∞ –º–Ω–æ–∂–∏—Ç–µ–ª—è, –∑–∞–≤—è–∑–∞–Ω–Ω–∞—è –Ω–∞ dt (—Å–µ–∫—É–Ω–¥—ã)
function calcStepDelta(dt) {
  const basePerSec = 0.05;  // –±–∞–∑–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
  const accelPerSec = 0.12; // —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ –Ω–∞—á–∞–ª–µ
  const slowAfter25 = 0.04; // –º—è–≥–∫–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ—Å–ª–µ 2.5
  const slowAfter5  = 0.015; // –ø–æ—á—Ç–∏ —Å—Ç–æ–ø –ø–æ—Å–ª–µ 5
  const maxPerSec   = 0.25; // –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å

  let perSec;

  if (currentMulti <= 1.3) {
    // —Ä–∞–Ω–Ω–∏–π —ç—Ç–∞–ø ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ
    perSec = basePerSec + accelPerSec * (currentMulti - 1.0);
  } else if (currentMulti <= 2.5) {
    // –º–µ–∂–¥—É 1.3 –∏ 2.5 ‚Äî –∑–∞–º–µ–¥–ª—è–µ–º –ø—Ä–∏—Ä–æ—Å—Ç
    const extra = currentMulti - 1.3;
    perSec = basePerSec + 0.08 + slowAfter25 * extra;
  } else if (currentMulti <= 5) {
    // –º–µ–∂–¥—É 2.5 –∏ 5 ‚Äî –∏–¥—ë–º –µ—â—ë –ø–ª–∞–≤–Ω–µ–µ
    const extra = currentMulti - 2.5;
    perSec = basePerSec + 0.10 + slowAfter5 * extra;
  } else {
    // –ø–æ—Å–ª–µ 5x ‚Äî –ø–æ—á—Ç–∏ —Å—Ç–æ–ø, –≤–∏–∑—É–∞–ª—å–Ω–æ —Ç—è–Ω–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–æ
    perSec = basePerSec + 0.02;
  }

  if (perSec > maxPerSec) perSec = maxPerSec;
  if (perSec < 0) perSec = 0;

  return perSec * dt;
}

 function updateRushHistory() {
  if (!rushHistoryEl) return;
  if (!crashHistory.length) {
    rushHistoryEl.textContent = "–ò—Å—Ç–æ—Ä–∏—è: ‚Äî";
    return;
  }
  const last = crashHistory.slice(-10);
  let html = '–ò—Å—Ç–æ—Ä–∏—è: ';
  last.forEach(v => {
    let cls = 'low';
    if (v >= 5)      cls = 'high';
    else if (v >= 2) cls = 'mid';
    html += `<span class="rush-history-chip ${cls}">x${v.toFixed(2)}</span>`;
  });
  rushHistoryEl.innerHTML = html;
}

function updateRushTimer() {
  if (!rushTimerEl) return;

  if (rushPhase === 'betting') {
    const left = Math.max(0, RUSH_BETTING_DURATION - rushPhaseElapsed);
    rushTimerEl.textContent = `–î–æ —Å—Ç–∞—Ä—Ç–∞: ${Math.ceil(left)} c`;
  } else if (rushPhase === 'running') {
    rushTimerEl.textContent = '–ò–≥—Ä–∞ –∏–¥—ë—Ç‚Ä¶';
  } else if (rushPhase === 'crashed') {
    rushTimerEl.textContent = '–°–∫–æ—Ä–æ –Ω–æ–≤—ã–π —Ä–∞—É–Ω–¥‚Ä¶';
  }
}
  function resetRushPlayerState() {
    rushHasActiveBet = false;
    rushBet          = 0;
    autoCashout      = null;
    hasCashedOut     = false;
    cashedOutAt      = null;
    if (rushCashoutBtn) rushCashoutBtn.disabled = true;
  }

  function startNewRushRound() {
    rushRoundId++;
    rushPhase        = 'betting';
    rushPhaseElapsed = 0;
    currentMulti     = 1.0;
    crashMulti       = generateCrashMultiplier();

    if (rushMultEl)   rushMultEl.textContent = formatMulti(currentMulti);
    if (rushRocketEl) rushRocketEl.style.width = '0%';
    resetRushVisual();
    resetRushPlayerState();

    if (rushStatusEl) {
      rushStatusEl.textContent = "–ù–æ–≤—ã–π —Ä–∞—É–Ω–¥. –£ —Ç–µ–±—è ~10 —Å–µ–∫—É–Ω–¥, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É.";
    }

    updateRushTimer();

    if (rushBetInput)    rushBetInput.disabled    = false;
    if (rushAutoInput)   rushAutoInput.disabled   = false;
    if (rushAutoEnabled) rushAutoEnabled.disabled = false;
    if (rushStartBtn)    rushStartBtn.disabled    = false;
  }

  function onRushCrash() {
    rushPhase        = 'crashed';
    rushPhaseElapsed = 0;

    crashHistory.push(crashMulti);
    if (crashHistory.length > 50) crashHistory.shift();
    updateRushHistory();

    if (crashMulti > stats.bestMulti) {
      stats.bestMulti = crashMulti;
      saveStats();
      updateStatsView();
    }

    crashRushVisual();

    if (rushStatusEl) {
      if (rushHasActiveBet) {
        if (hasCashedOut) {
          const show = cashedOutAt || crashMulti;
          rushStatusEl.textContent =
            `üí• –†–∞—É–Ω–¥ —É–ø–∞–ª –Ω–∞ ${formatMulti(crashMulti)}. –¢—ã –∑–∞–±—Ä–∞–ª –Ω–∞ ${formatMulti(show)}.`;
        } else {
          rushStatusEl.textContent =
            `üí• –ö—Ä–∞—à –Ω–∞ ${formatMulti(crashMulti)}. –°—Ç–∞–≤–∫–∞ ${rushBet} OWY —Å–≥–æ—Ä–µ–ª–∞.`;
        }
      } else {
        rushStatusEl.textContent =
          `–†–∞—É–Ω–¥ —É–ø–∞–ª –Ω–∞ ${formatMulti(crashMulti)}. –í —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ —É—Å–ø–µ–π –≤–æ–π—Ç–∏ –ø–æ—Ä–∞–Ω—å—à–µ üòâ`;
      }
    }

    rushHasActiveBet = false;
    if (rushOwyEl) rushOwyEl.classList.remove('rush-running');
    if (rushCashoutBtn) rushCashoutBtn.disabled = true;
    vibrate(90);
  }

  function tickRush(dt) {
    if (rushPhase === 'betting') {
      rushPhaseElapsed += dt;
      updateRushTimer();
      
      if (rushPhaseElapsed >= RUSH_BETTING_DURATION) {
        rushPhase        = 'running';
        rushPhaseElapsed = 0;

        if (rushStatusEl) {
          rushStatusEl.textContent = rushHasActiveBet
            ? "Rush –ø–æ—à—ë–ª! –°–ª–µ–¥–∏ –∑–∞ –º–Ω–æ–∂–∏—Ç–µ–ª–µ–º –∏ –∑–∞–±–∏—Ä–∞–π –≤–æ–≤—Ä–µ–º—è."
            : "Rush –∏–¥—ë—Ç. –í —Å–ª–µ–¥—É—é—â–µ–º —Ä–∞—É–Ω–¥–µ —É—Å–ø–µ–π —Å–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É üòâ";
        }

        if (rushOwyEl) rushOwyEl.classList.add('rush-running');

        if (rushBetInput)    rushBetInput.disabled    = true;
        if (rushAutoInput)   rushAutoInput.disabled   = true;
        if (rushAutoEnabled) rushAutoEnabled.disabled = true;

        if (rushCashoutBtn) rushCashoutBtn.disabled = !rushHasActiveBet;
        if (rushStartBtn)   rushStartBtn.disabled   = true;
      }
      return;
    }

    if (rushPhase === 'running') {
      currentMulti += calcStepDelta(dt);

      if (rushMultEl)   rushMultEl.textContent = formatMulti(currentMulti);
      if (rushRocketEl) {
        const progress = Math.min(currentMulti / 10, 1) * 100;
        rushRocketEl.style.width = progress + '%';
      }

      updateRushVisual();
      updateRushTimer();

      if (rushHasActiveBet && !hasCashedOut && autoCashout && currentMulti >= autoCashout) {
        cashoutRush();
      }

      if (currentMulti >= crashMulti) onRushCrash();
      return;
    }

    if (rushPhase === 'crashed') {
      rushPhaseElapsed += dt;
      updateRushTimer();
      if (rushPhaseElapsed >= RUSH_AFTER_CRASH_DELAY) {
        startNewRushRound();
      }
    }
  }

  function startRush() {
    if (rushPhase !== 'betting') {
      if (rushStatusEl) rushStatusEl.textContent = "–°—Ç–∞–≤–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–æ —Å—Ç–∞—Ä—Ç–∞ —Ä–∞—É–Ω–¥–∞. –ñ–¥–∏ —Å–ª–µ–¥—É—é—â–∏–π üôÇ";
      return;
    }

    if (rushHasActiveBet) {
      if (rushStatusEl) rushStatusEl.textContent = "–£ —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å —Å—Ç–∞–≤–∫–∞ –≤ —ç—Ç–æ–º —Ä–∞—É–Ω–¥–µ.";
      return;
    }

    const betValue = parseInt(rushBetInput.value, 10);
    if (isNaN(betValue) || betValue < 10) {
      if (rushStatusEl) rushStatusEl.textContent = "–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ ‚Äî 10 OWY ü§®";
      return;
    }
    if (betValue > demoBalance) {
      if (rushStatusEl) rushStatusEl.textContent = "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è —Ç–∞–∫–æ–π —Å—Ç–∞–≤–∫–∏ üòî";
      return;
    }

    const isAutoOn   = rushAutoEnabled && rushAutoEnabled.checked;
    const autoValRaw = parseFloat(rushAutoInput.value);
    if (isAutoOn && !isNaN(autoValRaw) && autoValRaw > 1.01) {
      autoCashout = autoValRaw;
    } else {
      autoCashout = null;
    }

    rushHasActiveBet = true;
    rushBet          = betValue;
    hasCashedOut     = false;
    cashedOutAt      = null;

    demoBalance -= rushBet;
    saveBalance();
    updateBalanceView();

    stats.rushPlays += 1;
    stats.xp        += 5;
    saveStats();
    updateStatsView();

    if (rushStatusEl) rushStatusEl.textContent = "–°—Ç–∞–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞. –ñ–¥—ë–º —Å—Ç–∞—Ä—Ç–∞ Rush üöÄ";
    vibrate(40);
  }

  function cashoutRush() {
  if (!rushHasActiveBet || hasCashedOut || rushPhase !== 'running') return;

  hasCashedOut = true;
  cashedOutAt  = currentMulti;
  if (rushCashoutBtn) rushCashoutBtn.disabled = true;

  const baseWin   = Math.floor(rushBet * cashedOutAt);
  const petBonus  = getPetBonus();
  const bonusWin  = Math.floor(baseWin * petBonus);
  const winAmount = baseWin + bonusWin;

  demoBalance += winAmount;
  saveBalance();
  updateBalanceView();

  if (cashedOutAt > stats.bestMulti) stats.bestMulti = cashedOutAt;
  stats.xp += 8;
  saveStats();
  updateStatsView();

  if (rushStatusEl) {
    if (petBonus > 0) {
      rushStatusEl.textContent =
        `‚úÖ –ó–∞–±—Ä–∞–ª –Ω–∞ ${formatMulti(cashedOutAt)}! +${winAmount} OWY (–≤–∫–ª—é—á–∞—è +${bonusWin} –æ—Ç Fluffie üßø)`;
    } else {
      rushStatusEl.textContent =
        `‚úÖ –ó–∞–±—Ä–∞–ª –Ω–∞ ${formatMulti(cashedOutAt)}! –í—ã–∏–≥—Ä—ã—à +${winAmount} OWY.`;
    }
  }
  vibrate(70);
}

  function openRush()  { if (rushOverlay) rushOverlay.style.display = 'flex'; }
  function closeRush() { if (rushOverlay) rushOverlay.style.display = 'none'; }

  if (rushOpenBtn)    rushOpenBtn.addEventListener('click', openRush);
  if (rushBackBtn)    rushBackBtn.addEventListener('click', closeRush);
  if (rushStartBtn)   rushStartBtn.addEventListener('click', startRush);
  if (rushCashoutBtn) rushCashoutBtn.addEventListener('click', cashoutRush);

function openMiniOverlay() {
  if (!miniOverlay) return;
  miniOverlay.style.display = 'flex';
}

function closeMiniOverlay() {
  if (!miniOverlay) return;
  miniOverlay.style.display = 'none';
}

if (miniBackBtn) {
  miniBackBtn.addEventListener('click', closeMiniOverlay);
}

if (miniOpenMatch3Btn) {
  miniOpenMatch3Btn.addEventListener('click', () => {
    closeMiniOverlay();
    openMatch3Overlay(); // —Ñ—É–Ω–∫—Ü–∏—é –æ–±—ä—è–≤–∏–º –≤ —Å–µ–∫—Ü–∏–∏ –∏–≥—Ä—ã
  });
}
if (miniOpenTapTapBtn) {
  miniOpenTapTapBtn.addEventListener('click', () => {
    closeMiniOverlay();
    openTapTapOverlay();
  });
}

if (taptapBackBtn) {
  taptapBackBtn.addEventListener('click', () => {
    endTapTapGame(true); // –≤—ã—Ö–æ–¥–∏–º –±–µ–∑ –Ω–∞–≥—Ä–∞–¥—ã
  });
}

// === TAP-TAP GAME LOGIC ===

let taptapScore = 0;
let taptapTimeLeft = 30;
let taptapTimerId = null;
let taptapSpawnId = null;
let taptapRunning = false;

function resetTapTap() {
  taptapScore = 0;
  taptapTimeLeft = 30;
  taptapRunning = false;

  if (taptapScoreEl) taptapScoreEl.textContent = '–û—á–∫–∏: 0';
  if (taptapTimerEl) taptapTimerEl.textContent = '–û—Å—Ç–∞–ª–æ—Å—å: 30 c';
  if (taptapStatusEl) {
    taptapStatusEl.textContent =
      '–£—Å–ø–µ–π —Ç–∞–ø–Ω—É—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ —Ü–µ–ª–µ–π –∑–∞ 30 —Å–µ–∫—É–Ω–¥.';
  }

  if (taptapBoardEl) taptapBoardEl.innerHTML = '';

  if (taptapTimerId) {
    clearInterval(taptapTimerId);
    taptapTimerId = null;
  }
  if (taptapSpawnId) {
    clearInterval(taptapSpawnId);
    taptapSpawnId = null;
  }
}

function spawnTapTapTarget() {
  if (!taptapBoardEl || !taptapRunning) return;

  const rect = taptapBoardEl.getBoundingClientRect();
  const size = 54;
  const padding = 8;

  const maxX = rect.width - size - padding * 2;
  const maxY = rect.height - size - padding * 2;

  if (maxX <= 0 || maxY <= 0) return;

  const x = padding + Math.random() * maxX;
  const y = padding + Math.random() * maxY;

  const el = document.createElement('div');
  el.className = 'taptap-target';
  el.style.left = x + 'px';
  el.style.top  = y + 'px';
  el.textContent = '+1';

  // –∞–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
  requestAnimationFrame(() => {
    el.classList.add('taptap-target--alive');
  });

  // —Ç–∞–ø –ø–æ –∫—Ä—É–∂–∫—É
  el.addEventListener('click', () => {
    if (!taptapRunning) return;
    taptapScore++;
    if (taptapScoreEl) taptapScoreEl.textContent = '–û—á–∫–∏: ' + taptapScore;

    el.classList.remove('taptap-target--alive');
    el.classList.add('taptap-target--hit');
    vibrate(30);

    setTimeout(() => {
      el.remove();
    }, 120);
  }, { once: true });

  taptapBoardEl.appendChild(el);

  // –∞–≤—Ç–æ—É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ —Ç–∞–ø–Ω—É–ª–∏
  setTimeout(() => {
    if (!el.parentNode) return;
    el.classList.remove('taptap-target--alive');
    el.classList.add('taptap-target--hit');
    setTimeout(() => el.remove(), 150);
  }, 1000);
}

function startTapTapGame() {
  resetTapTap();
  taptapRunning = true;

  // —Ç–∞–π–º–µ—Ä
  taptapTimerId = setInterval(() => {
    taptapTimeLeft--;
    if (taptapTimerEl) {
      taptapTimerEl.textContent = '–û—Å—Ç–∞–ª–æ—Å—å: ' + taptapTimeLeft + ' c';
    }
    if (taptapTimeLeft <= 0) {
      endTapTapGame();
    }
  }, 1000);

  // —Å–ø–∞–≤–Ω–∏–º —Ü–µ–ª—å –∫–∞–∂–¥—ã–µ ~700–º—Å
  taptapSpawnId = setInterval(() => {
    spawnTapTapTarget();
  }, 700);
}

function endTapTapGame(skipReward) {
  taptapRunning = false;

  if (taptapTimerId) {
    clearInterval(taptapTimerId);
    taptapTimerId = null;
  }
  if (taptapSpawnId) {
    clearInterval(taptapSpawnId);
    taptapSpawnId = null;
  }

  if (!skipReward && petData && petData.name) {
    // –ø—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º—É–ª–∞: XP –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
    const xpGain   = Math.max(1, Math.floor(taptapScore / 5));
    const moodGain = Math.min(20, Math.floor(taptapScore / 4));

    petData.xp     = (petData.xp || 0) + xpGain;
    petData.mood   = Math.min(100, petData.mood + moodGain);
    petData.energy = Math.max(0,  petData.energy - 8);
    petData.hunger = Math.max(0,  (petData.hunger || 0) - 5);
    petData.lastUpdateAt = Date.now();

    const info = calcPetLevelFromXp(petData.xp || 0);
    petData.level = info.level;
    savePet();
    updatePetUI();

    if (taptapStatusEl) {
      taptapStatusEl.textContent =
        `–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞: ${taptapScore} –æ—á–∫–æ–≤. Fluffie –ø–æ–ª—É—á–∏–ª +${xpGain} XP –∏ +${moodGain} –∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é üéØ`;
    }
  } else {
    if (taptapStatusEl) {
      taptapStatusEl.textContent = `–ò–≥—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞. –†–µ–∑—É–ª—å—Ç–∞—Ç: ${taptapScore} –æ—á–∫–æ–≤.`;
    }
  }

  // –∑–∞–∫—Ä—ã–≤–∞–µ–º overlay —á—É—Ç—å –ø–æ–∑–∂–µ, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç —É—Å–ø–µ–ª–∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å
  setTimeout(() => {
    closeTapTapOverlay();
  }, 700);
}

function openTapTapOverlay() {
  if (!taptapOverlay) return;
  taptapOverlay.style.display = 'flex';
  startTapTapGame();
}

function closeTapTapOverlay() {
  if (!taptapOverlay) return;
  resetTapTap();
  taptapOverlay.style.display = 'none';
}

 // === PLINKO ===
const PLINKO_COLS = 9;
const PLINKO_ROWS = 16;
let plinkoBallsPerShot = 1; // –ø–æ–∫–∞ 1 —à–∞—Ä; —Ö–æ—á–µ—à—å —Å—Ä–∞–∑—É 5 ‚Äî –ø–æ—Å—Ç–∞–≤—å 5

const PLINKO_CONFIGS = {
  low: {
    multipliers: [5.3, 1.9, 1.1, 1.0, 0.5, 1.0, 1.1, 1.9, 5.3]
  },
  mid: {
    multipliers: [12.8, 2.8, 1.3, 0.7, 0.4, 0.7, 1.3, 2.8, 12.8]
  },
  high: {
    multipliers: [28.2, 4.2, 1.4, 0.3, 0.2, 0.3, 1.4, 4.2, 28.2]
  }
};

let plinkoSelectedRisk = 'mid';
let plinkoHistory      = [];
let plinkoIsRunning    = false;
let plinkoStartLocked  = false;
let plinkoActiveBalls  = 0;

if (plinkoRiskBtns && plinkoRiskBtns.length) {
  plinkoRiskBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      // –µ—Å–ª–∏ —à–∞—Ä–∏–∫–∏ —Å–µ–π—á–∞—Å –ª–µ—Ç—è—Ç ‚Äî –º–µ–Ω—è—Ç—å —Ä–∏—Å–∫ –Ω–µ–ª—å–∑—è
      if (plinkoIsRunning) return;

      // —Å–Ω—è—Ç—å –∞–∫—Ç–∏–≤ —Å –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
      plinkoRiskBtns.forEach(b => b.classList.remove('plinko-risk-active'));

      // –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é
      btn.classList.add('plinko-risk-active');

      // —Å–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥
      plinkoSelectedRisk = btn.dataset.risk || 'mid';
      renderPlinkoConfig();
    });
  });
}

function updatePlinkoHistory() {
  if (!plinkoHistoryEl) return;
  if (!plinkoHistory.length) {
    plinkoHistoryEl.textContent = "–ò—Å—Ç–æ—Ä–∏—è: ‚Äî";
    return;
  }
  const last = plinkoHistory.slice(-10);
  plinkoHistoryEl.textContent =
    "–ò—Å—Ç–æ—Ä–∏—è: " + last.map(v => "x" + v.toFixed(1)).join("   ");
}

function renderPlinkoPegs() {
  if (!plinkoPegsLayer) return;
  plinkoPegsLayer.innerHTML = "";
  for (let r = 0; r < PLINKO_ROWS; r++) {
    const yPerc = 5 + (r / (PLINKO_ROWS - 1)) * 80;
    const isOdd  = r % 2 === 1;
    const count  = isOdd ? PLINKO_COLS - 1 : PLINKO_COLS;
    const offset = isOdd ? 0.5 : 0;
    for (let i = 0; i < count; i++) {
      const peg = document.createElement("div");
      peg.className = "plinko-peg";
      const colPos   = i + offset;
      const maxIndex = PLINKO_COLS - 1;
      const xPerc    = (colPos / maxIndex) * 100;
      peg.style.top  = yPerc + "%";
      peg.style.left = xPerc + "%";
      plinkoPegsLayer.appendChild(peg);
    }
  }
}

function renderPlinkoConfig() {
  const config = PLINKO_CONFIGS[plinkoSelectedRisk];
  if (!config || !plinkoMultsRow) return;

  plinkoMultsRow.innerHTML = "";

  const max = Math.max(...config.multipliers);

  config.multipliers.forEach(m => {
    let cls = "plinko-slot";

    if (m >= max * 0.65) {
      cls += " plinko-slot-hot";
    } else if (m >= 1) {
      cls += " plinko-slot-warm";
    } else {
      cls += " plinko-slot-cool";
    }

    const slot = document.createElement("div");
    slot.className = cls;
    slot.textContent = "x" + m.toFixed(1);
    plinkoMultsRow.appendChild(slot);
  });

  if (plinkoBoardEl) {
    plinkoBoardEl.classList.remove("low", "mid", "high");
    plinkoBoardEl.classList.add(plinkoSelectedRisk);
  }
}

function findAllMatches(board) {
  const rows = board.length;
  const cols = board[0].length;
  const toClear = Array.from({ length: rows }, () =>
    Array(cols).fill(false)
  );
  let hasMatches = false;

  // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏
  for (let r = 0; r < rows; r++) {
    let runColor = board[r][0];
    let runStart = 0;

    for (let c = 1; c <= cols; c++) {
      const color = c < cols ? board[r][c] : null; // sentinel –≤ –∫–æ–Ω—Ü–µ
      if (color === runColor) continue;

      // –ó–∞–∫–æ–Ω—á–∏–ª–∞—Å—å —Å–µ—Ä–∏—è —Ü–≤–µ—Ç–∞ runColor
      const runLen = c - runStart;
      if (runColor != null && runLen >= 3) {
        hasMatches = true;
        for (let k = runStart; k < c; k++) {
          toClear[r][k] = true;
        }
      }

      runColor = color;
      runStart = c;
    }
  }

  // –í–µ—Ä—Ç–∏–∫–∞–ª–∏
  for (let c = 0; c < cols; c++) {
    let runColor = board[0][c];
    let runStart = 0;

    for (let r = 1; r <= rows; r++) {
      const color = r < rows ? board[r][c] : null;
      if (color === runColor) continue;

      const runLen = r - runStart;
      if (runColor != null && runLen >= 3) {
        hasMatches = true;
        for (let k = runStart; k < r; k++) {
          toClear[k][c] = true;
        }
      }

      runColor = color;
      runStart = r;
    }
  }

  return hasMatches ? toClear : null;
}

function clearMatches(board, mask) {
  const rows = board.length;
  const cols = board[0].length;
  let cleared = 0;

  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      if (mask[r][c]) {
        board[r][c] = null; // –ø—É—Å—Ç–æ
        cleared++;
      }
    }
  }
  return cleared; // –º–æ–∂–Ω–æ —É–º–Ω–æ–∂–∞—Ç—å –Ω–∞ –æ—á–∫–∏
}

function dropTiles(board) {
  const rows = board.length;
  const cols = board[0].length;

  for (let c = 0; c < cols; c++) {
    let writeRow = rows - 1; // –∫—É–¥–∞ –±—É–¥–µ–º "—Ä–æ–Ω—è—Ç—å"
    for (let r = rows - 1; r >= 0; r--) {
      if (board[r][c] != null) {
        board[writeRow][c] = board[r][c];
        if (writeRow !== r) board[r][c] = null;
        writeRow--;
      }
    }
    // –≥–µ–Ω–µ—Ä–∏–º –Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É
    for (let r = writeRow; r >= 0; r--) {
      board[r][c] = randomGemType(); // —Å–≤–æ—è —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–Ω–¥–æ–º–∞
    }
  }
}

function resolveBoardLoop() {
  while (true) {
    const mask = findAllMatches(board);
    if (!mask) break;

    const cleared = clearMatches(board, mask);
    // —Ç—É—Ç –¥–æ–±–∞–≤–ª—è–µ–º –æ—á–∫–∏: score += cleared * 10;
    dropTiles(board);
  }

  // –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–∞–¥–µ–Ω–∏–π ‚Äî –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º DOM
  renderBoard();
}

// —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π —Ä–∞–Ω–¥–æ–º–Ω—ã–π –ø—É—Ç—å, –≤–Ω–∏–∑—É –±–µ–∑ –¥—ë—Ä–≥–∞–Ω–∏–π
function generatePlinkoPath(cols, rows) {
  const center = Math.floor(cols / 2);
  let col = center;

  const path = [];
  const lastStraightRows = 2;

  for (let r = 0; r <= rows; r++) {
    path.push({ col, row: r });
    if (r === rows) break;

    if (rows - r <= lastStraightRows) {
      continue; // –≤–Ω–∏–∑—É –ø–æ–ª—ë—Ç —Å—Ç—Ä–æ–≥–æ –≤–Ω–∏–∑
    }

    let dir = 0;
    const rnd = Math.random();

    if (rnd < 0.42) {
      dir = -1; // –≤–ª–µ–≤–æ
    } else if (rnd < 0.84) {
      dir = 1;  // –≤–ø—Ä–∞–≤–æ
    } else {
      dir = 0;  // –ø—Ä—è–º–æ
    }

    if (col === 0 && dir === -1) dir = 0;
    if (col === cols - 1 && dir === 1) dir = 0;

    col += dir;
  }

  return path;
}

// –≥–µ–Ω–µ—Ä–∏–º –ø—É—Ç—å + —Å–∏–ª—å–Ω–æ —Ä–µ–∂–µ–º —à–∞–Ω—Å —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —è—á–µ–π–∫–∏ –ø–æ –∫—Ä–∞—è–º

function generatePlinkoOutcome(config) {
  const cols = config.multipliers.length;
  let path, finalCol;
  let tries = 0;

  // —á–µ–º –≤—ã—à–µ PROB –∏ MAX_REROLLS ‚Äî —Ç–µ–º —Ä–µ–∂–µ –±—É–¥—É—Ç –≤—ã–ø–∞–¥–∞—Ç—å –∫—Ä–∞–π–Ω–∏–µ —è—á–µ–π–∫–∏
  const EDGE_REROLL_PROB  = 0.9; // 90% –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ –ø–æ–ø–∞–ª–∏ –Ω–∞ –∫—Ä–∞–π
  const EDGE_MAX_REROLLS  = 6;   // –º–∞–∫—Å–∏–º—É–º 6 –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–π

  while (true) {
    path     = generatePlinkoPath(cols, PLINKO_ROWS);
    finalCol = path[path.length - 1].col;

    const isEdge = (finalCol === 0 || finalCol === cols - 1);

    // –Ω–µ –∫—Ä–∞–π ‚Äî —Å—Ä–∞–∑—É –±–µ—Ä—ë–º
    if (!isEdge) break;

    // –∫—Ä–∞–π: –ø—ã—Ç–∞–µ–º—Å—è ¬´—É–∫–ª–æ–Ω–∏—Ç—å—Å—è¬ª –æ—Ç –Ω–µ–≥–æ
    if (tries >= EDGE_MAX_REROLLS) {
      // —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å (–∏–Ω–æ–≥–¥–∞ –≤—Å—ë-—Ç–∞–∫–∏ –¥–∞—ë–º –∫—Ä–∞—é –≤—ã–ø–∞—Å—Ç—å)
      break;
    }

    tries++;

    // —Å —à–∞–Ω—Å–æ–º 90% –∫—Ä—É—Ç–∏–º –µ—â—ë —Ä–∞–∑, —Å 10% ‚Äî –≤—Å—ë-—Ç–∞–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º —ç—Ç–æ—Ç –∫—Ä–∞–π
    if (Math.random() >= EDGE_REROLL_PROB) {
      break;
    }
    // –∏–Ω–∞—á–µ –ø—Ä–æ—Å—Ç–æ –∏–¥—ë–º –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ü–∏–∫–ª –∏ –≥–µ–Ω–µ—Ä–∏–º –Ω–æ–≤—ã–π –ø—É—Ç—å
  }

  return { path, finalCol };
}

function runOnePlinkoBall(bet, config, slots, slotCenters, slotY) {
  if (!plinkoBallsLayer) return;

  const layerRect = plinkoBallsLayer.getBoundingClientRect();

  const { path, finalCol } = generatePlinkoOutcome(config);
  const multiplier = config.multipliers[finalCol];

  const ball = document.createElement("div");
  ball.className = "plinko-ball";
  plinkoBallsLayer.appendChild(ball);

  const startX = layerRect.width / 2;
  ball.style.left = (startX - 5) + "px";
  ball.style.top  = "0px";

  const totalRows      = PLINKO_ROWS;
  const stepDelayStart = 360;
  const stepDelayEnd   = 240;

  path.forEach((step, index) => {
    const rowRatio = step.row / totalRows;
    const y        = slotY * rowRatio;
    const colIndex = step.col;
    const x        = slotCenters[colIndex];

    const t = index / path.length;
    const stepDelay = stepDelayStart + (stepDelayEnd - stepDelayStart) * t;
    const delay = stepDelay * index;

    setTimeout(() => {
      ball.style.top  = y + "px";
      ball.style.left = (x - 5) + "px";
    }, delay);
  });

  const approxTotalTime =
    (stepDelayStart + stepDelayEnd) / 2 * path.length + 120;

  plinkoActiveBalls++;

  setTimeout(() => {
    if (slots[finalCol]) {
      slots.forEach(s => s.classList.remove("active"));
      slots[finalCol].classList.add("active");
    }

    const baseWin   = Math.floor(bet * multiplier);
const petBonus  = getPetBonus();
const bonusWin  = Math.floor(baseWin * petBonus);
const winAmount = baseWin + bonusWin;

demoBalance += winAmount;
saveBalance();
updateBalanceView();

    plinkoHistory.push(multiplier);
    updatePlinkoHistory();

    if (multiplier > stats.bestMulti) {
      stats.bestMulti = multiplier;
      saveStats();
      updateStatsView();
    }

    vibrate(60);
    setTimeout(() => ball.remove(), 1000);

    plinkoActiveBalls--;
    if (plinkoActiveBalls === 0) {
      plinkoIsRunning = false;
      if (plinkoBetInput) plinkoBetInput.disabled = false;
      if (plinkoRiskBtns && plinkoRiskBtns.length) {
        plinkoRiskBtns.forEach(btn => btn.disabled = false);
      }
     if (plinkoStatusEl) {
  if (petBonus > 0 && winAmount > 0) {
    plinkoStatusEl.textContent =
      `–†–∞—É–Ω–¥ –∑–∞–≤–µ—Ä—à—ë–Ω. –¢—ã –ø–æ–ª—É—á–∏–ª +${winAmount} OWY (–≤–∫–ª—é—á–∞—è +${bonusWin} –æ—Ç Fluffie üßø)`;
  } else {
    plinkoStatusEl.textContent = "–†–∞—É–Ω–¥ –∑–∞–≤–µ—Ä—à—ë–Ω. –ó–∞–ø—É—Å–∫–∞–π –µ—â—ë üòâ";
  }
}
    }
  }, approxTotalTime);
}

function playPlinko() {
  // –∞–Ω—Ç–∏-–¥–∞–±–ª–∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ
  if (plinkoStartLocked) return;
  plinkoStartLocked = true;
  setTimeout(() => { plinkoStartLocked = false; }, 250);

  const bet = parseInt(plinkoBetInput.value, 10);
  if (isNaN(bet) || bet < 10) {
    if (plinkoStatusEl) plinkoStatusEl.textContent = "–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ ‚Äî 10 OWY ü§®";
    return;
  }

  if (bet > demoBalance) {
    if (plinkoStatusEl) {
      plinkoStatusEl.textContent = "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è —ç—Ç–æ–π —Å—Ç–∞–≤–∫–∏ üòî";
    }
    return;
  }

  const config = PLINKO_CONFIGS[plinkoSelectedRisk];
  if (!config) return;

  const slots = plinkoMultsRow
    ? plinkoMultsRow.querySelectorAll(".plinko-slot")
    : [];
  if (!slots.length || slots.length !== config.multipliers.length) return;

  const layerRect   = plinkoBallsLayer.getBoundingClientRect();
  const slotRects   = Array.from(slots).map(s => s.getBoundingClientRect());
  const slotCenters = slotRects.map(r => r.left + r.width / 2 - layerRect.left);
  const slotY       = slotRects[0].top - layerRect.top - 8;

  // —Å–Ω–∏–º–∞–µ–º —Å—Ç–∞—Ä—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É
  slots.forEach(s => s.classList.remove("active"));

  // —Å–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É –∑–∞ –û–î–ò–ù —à–∞—Ä
  demoBalance -= bet;
  saveBalance();
  updateBalanceView();

  // —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Äî –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —à–∞—Ä–æ–≤
  stats.plinkoPlays += 1;
  stats.xp          += 4;
  saveStats();
  updateStatsView();

  // –µ—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π —à–∞—Ä –≤ —Ç–µ–∫—É—â–µ–º ‚Äú—Ä–∞—É–Ω–¥–µ‚Äù ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  if (!plinkoIsRunning) {
    plinkoIsRunning = true;
    if (plinkoBetInput) plinkoBetInput.disabled = true;
    if (plinkoRiskBtns && plinkoRiskBtns.length) {
      plinkoRiskBtns.forEach(btn => btn.disabled = true);
    }
  }

  if (plinkoStatusEl) {
    plinkoStatusEl.textContent = "–®–∞—Ä–∏–∫ –ø–∞–¥–∞–µ—Ç... üéØ";
  }

  // –∑–∞–ø—É—Å–∫–∞–µ–º —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —à–∞—Ä–∏–∫
  runOnePlinkoBall(bet, config, slots, slotCenters, slotY);
}

  function openPlinko() {
    if (plinkoOverlay) plinkoOverlay.style.display = 'flex';
    if (plinkoStatusEl) plinkoStatusEl.textContent = "–í—ã–±–∏—Ä–∞–π —Ä–∏—Å–∫ –∏ –∑–∞–ø—É—Å–∫–∞–π —à–∞—Ä üòâ";
  }

  function closePlinko() {
    if (plinkoOverlay) plinkoOverlay.style.display = 'none';
    if (plinkoStatusEl) plinkoStatusEl.textContent = "–í—ã–±–∏—Ä–∞–π —Ä–∏—Å–∫ –∏ –∑–∞–ø—É—Å–∫–∞–π —à–∞—Ä üòâ";
  }

  if (plinkoOpenBtn)  plinkoOpenBtn.addEventListener('click', openPlinko);
  if (plinkoBackBtn)  plinkoBackBtn.addEventListener('click', closePlinko);
  if (plinkoStartBtn) plinkoStartBtn.addEventListener('click', playPlinko);

function openDouble() {
  if (!doubleOverlay) return;

  doubleOverlay.style.display = 'flex';

  // –ø–µ—Ä–≤—ã–π –∑–∞—Ö–æ–¥ ‚Äî —Å—Ç—Ä–æ–∏–º –∫–æ–ª–µ—Å–æ
  if (!doubleWheelInited) {
    buildDoubleWheel();
    doubleWheelInited = true;
  } else {
    // –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –ø–µ—Ä–µ—Å—á—ë—Ç —Ä–∞–∑–º–µ—Ä–æ–≤
    recalcDoubleGeometry();
    syncDoubleWheel();
  }
}

function closeDouble() {
  if (doubleOverlay) doubleOverlay.style.display = 'none';
}

if (doubleOpenBtn) doubleOpenBtn.addEventListener('click', openDouble);
if (doubleBackBtn) doubleBackBtn.addEventListener('click', closeDouble);




// === INIT ===
loadBalance();
loadCurrency();
loadProfileInfo();
loadStats();
initProfile();
updateBalanceView();
updateStatsView();
loadPet();
applyPetDecay();


for (let i = 0; i < 15; i++) {
  crashHistory.push(generateCrashMultiplier());
}
updateRushHistory();
updatePlinkoHistory();

setActiveTab('casino');
renderPlinkoPegs();
renderPlinkoConfig();
initPhrases();

// –∏—Å—Ç–æ—Ä–∏–∏ —Ö–≤–∞—Ç–∞–µ—Ç, —Å–∞–º–æ –∫–æ–ª–µ—Å–æ —Å—Ç—Ä–æ–∏–º –ø—Ä–∏ –ø–µ—Ä–≤–æ–º openDouble
updateDoubleHistoryView();
startNewDoubleRound();

let lastTs = performance.now();
startNewRushRound();

// –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª Rush + Double
setInterval(() => {
  const now  = performance.now();
  const dtMs = now - lastTs;
  lastTs     = now;

  const dt = dtMs / 1000;

  tickRush(dt);
  tickDouble(dt);
}, 16);

// –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è/—ç–Ω–µ—Ä–≥–∏–∏ Fluffie —Ä–∞–∑ –≤ 3 –º–∏–Ω—É—Ç—ã
setInterval(() => {
  applyPetDecay();
}, 180000);

</script>
</body>
</html>